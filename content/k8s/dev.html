
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>开发 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="admin.html" />
    
    
    <link rel="prev" href="net.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    INTRODUCTION
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../linux/">
            
                <a href="../linux/">
            
                    
                    INFRA
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../linux/rhel/readme.html">
            
                <a href="../linux/rhel/readme.html">
            
                    
                    安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../linux/rhel/pre-install.html">
            
                <a href="../linux/rhel/pre-install.html">
            
                    
                    安装 DVD 制作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../linux/rhel/install-img-usb.html">
            
                <a href="../linux/rhel/install-img-usb.html">
            
                    
                    生成 USB 介质
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../linux/rhel/install.html">
            
                <a href="../linux/rhel/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../linux/rhel/kvm.html">
            
                <a href="../linux/rhel/kvm.html">
            
                    
                    KVM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../linux/basic/basic.html">
            
                <a href="../linux/basic/basic.html">
            
                    
                    基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../linux/basic/local-remote-login.html">
            
                <a href="../linux/basic/local-remote-login.html">
            
                    
                    本地及远程登录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../linux/basic/user-group.html">
            
                <a href="../linux/basic/user-group.html">
            
                    
                    用户和组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../linux/basic/packages-update.html">
            
                <a href="../linux/basic/packages-update.html">
            
                    
                    软件包的安装与更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../linux/basic/syslog.html">
            
                <a href="../linux/basic/syslog.html">
            
                    
                    系统日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../linux/basic/ntp.html">
            
                <a href="../linux/basic/ntp.html">
            
                    
                    NTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../linux/basic/ex.html">
            
                <a href="../linux/basic/ex.html">
            
                    
                    QA
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../linux/networking/">
            
                <a href="../linux/networking/">
            
                    
                    网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../linux/networking/fundamentals.html">
            
                <a href="../linux/networking/fundamentals.html">
            
                    
                    网络基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1.1" data-path="../linux/networking/tcp_debug.html">
            
                <a href="../linux/networking/tcp_debug.html">
            
                    
                    TCP 调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../linux/networking/ifcfg.html">
            
                <a href="../linux/networking/ifcfg.html">
            
                    
                    网络配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../linux/networking/ipv6cfg.html">
            
                <a href="../linux/networking/ipv6cfg.html">
            
                    
                    IPv6 网络配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../linux/networking/netns.html">
            
                <a href="../linux/networking/netns.html">
            
                    
                    namespace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../linux/networking/teaming.html">
            
                <a href="../linux/networking/teaming.html">
            
                    
                    teaming
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.6" data-path="../linux/networking/bridge.html">
            
                <a href="../linux/networking/bridge.html">
            
                    
                    bridge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.7" data-path="../linux/networking/dns.html">
            
                <a href="../linux/networking/dns.html">
            
                    
                    DNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.8" data-path="../linux/networking/monitor.html">
            
                <a href="../linux/networking/monitor.html">
            
                    
                    网络监控
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.9" data-path="../linux/networking/programming.html">
            
                <a href="../linux/networking/programming.html">
            
                    
                    网络编程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../linux/fs.html">
            
                <a href="../linux/fs.html">
            
                    
                    文件系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../linux/stoarges/readme.html">
            
                <a href="../linux/stoarges/readme.html">
            
                    
                    存储
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../linux/stoarges/lvm.html">
            
                <a href="../linux/stoarges/lvm.html">
            
                    
                    LVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../linux/stoarges/nfs.html">
            
                <a href="../linux/stoarges/nfs.html">
            
                    
                    NFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../linux/stoarges/file-storage.html">
            
                <a href="../linux/stoarges/file-storage.html">
            
                    
                    文件存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" data-path="../linux/stoarges/block-storage.html">
            
                <a href="../linux/stoarges/block-storage.html">
            
                    
                    块存储
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../linux/security/">
            
                <a href="../linux/security/">
            
                    
                    安全
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../linux/security/file-permissions.html">
            
                <a href="../linux/security/file-permissions.html">
            
                    
                    文件权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.2" data-path="../linux/security/SELinux.html">
            
                <a href="../linux/security/SELinux.html">
            
                    
                    SELinux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.3" data-path="../linux/security/firewall.html">
            
                <a href="../linux/security/firewall.html">
            
                    
                    防火墙
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.4" data-path="../linux/security/openssl.html">
            
                <a href="../linux/security/openssl.html">
            
                    
                    OpenSSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.5" data-path="../linux/security/ldap.html">
            
                <a href="../linux/security/ldap.html">
            
                    
                    LDAP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../linux/process/">
            
                <a href="../linux/process/">
            
                    
                    进程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.7.1" data-path="../linux/process/management.html">
            
                <a href="../linux/process/management.html">
            
                    
                    进程管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.2" data-path="../linux/process/service.html">
            
                <a href="../linux/process/service.html">
            
                    
                    服务管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.3" data-path="../linux/process/schedule.html">
            
                <a href="../linux/process/schedule.html">
            
                    
                    周期性运行进程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.4" data-path="../linux/process/bash.html">
            
                <a href="../linux/process/bash.html">
            
                    
                    bash
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../linux/svc/">
            
                <a href="../linux/svc/">
            
                    
                    常用服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.8.1" data-path="../linux/svc/openssh.html">
            
                <a href="../linux/svc/openssh.html">
            
                    
                    OpenSSH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.2" data-path="../linux/svc/postfix.html">
            
                <a href="../linux/svc/postfix.html">
            
                    
                    Email
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.3" data-path="../linux/svc/mariadb.html">
            
                <a href="../linux/svc/mariadb.html">
            
                    
                    MariaDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.4" data-path="../linux/svc/httpd.html">
            
                <a href="../linux/svc/httpd.html">
            
                    
                    HTTPD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.5" data-path="../linux/svc/zabbix.html">
            
                <a href="../linux/svc/zabbix.html">
            
                    
                    Zabbix
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../linux/perf/">
            
                <a href="../linux/perf/">
            
                    
                    性能调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../docker/docker.html">
            
                <a href="../docker/docker.html">
            
                    
                    DOCKER
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../docker/svc/svc.html">
            
                <a href="../docker/svc/svc.html">
            
                    
                    容器化服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../docker/svc/mysql.html">
            
                <a href="../docker/svc/mysql.html">
            
                    
                    mysql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../docker/svc/httpd.html">
            
                <a href="../docker/svc/httpd.html">
            
                    
                    httpd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../docker/container.html">
            
                <a href="../docker/container.html">
            
                    
                    容器管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../docker/images.html">
            
                <a href="../docker/images.html">
            
                    
                    容器镜像
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../openshift/openshift.html">
            
                <a href="../openshift/openshift.html">
            
                    
                    OPENSHIFT
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../openshift/concepts/">
            
                <a href="../openshift/concepts/">
            
                    
                    概念
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../openshift/install/">
            
                <a href="../openshift/install/">
            
                    
                    安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../openshift/install/yum.html">
            
                <a href="../openshift/install/yum.html">
            
                    
                    本地 yum 源配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../openshift/install/docker-dist.html">
            
                <a href="../openshift/install/docker-dist.html">
            
                    
                    本地 docker 镜像仓库配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../openshift/install/dns.html">
            
                <a href="../openshift/install/dns.html">
            
                    
                    DNS 服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="../openshift/install/pre-install.html">
            
                <a href="../openshift/install/pre-install.html">
            
                    
                    前续安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.5" data-path="../openshift/install/install.html">
            
                <a href="../openshift/install/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.6" data-path="../openshift/install/post-install.html">
            
                <a href="../openshift/install/post-install.html">
            
                    
                    后续安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.7" data-path="../openshift/install/add-nodes.html">
            
                <a href="../openshift/install/add-nodes.html">
            
                    
                    节点扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.8" data-path="../openshift/install/qa.html">
            
                <a href="../openshift/install/qa.html">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../openshift/advanced-deployment.html">
            
                <a href="../openshift/advanced-deployment.html">
            
                    
                    高级部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../openshift/devops.html">
            
                <a href="../openshift/devops.html">
            
                    
                    DEVOPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../openshift/secure.html">
            
                <a href="../openshift/secure.html">
            
                    
                    安全
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../openshift/samples/samples.html">
            
                <a href="../openshift/samples/samples.html">
            
                    
                    示例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.6.1" data-path="../openshift/samples/rc.html">
            
                <a href="../openshift/samples/rc.html">
            
                    
                    RC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.2" data-path="../openshift/samples/dc.html">
            
                <a href="../openshift/samples/dc.html">
            
                    
                    DC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.3" data-path="../openshift/samples/s2i.html">
            
                <a href="../openshift/samples/s2i.html">
            
                    
                    S2I
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.4" data-path="../openshift/samples/configmap.html">
            
                <a href="../openshift/samples/configmap.html">
            
                    
                    ConfigMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.5" data-path="../openshift/samples/elastic-spark.html">
            
                <a href="../openshift/samples/elastic-spark.html">
            
                    
                    elasticsearch and spark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.6" data-path="../openshift/samples/vdb-data-svc.html">
            
                <a href="../openshift/samples/vdb-data-svc.html">
            
                    
                    Teiid Data Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../openshift/labs/">
            
                <a href="../openshift/labs/">
            
                    
                    LABS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.1" data-path="../openshift/labs/sdn.html">
            
                <a href="../openshift/labs/sdn.html">
            
                    
                    Software-Defined Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.2" data-path="../openshift/labs/edge-route.html">
            
                <a href="../openshift/labs/edge-route.html">
            
                    
                    Route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.3" data-path="../openshift/labs/web-console.html">
            
                <a href="../openshift/labs/web-console.html">
            
                    
                    Web Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4" data-path="../openshift/labs/projects-accounts.html">
            
                <a href="../openshift/labs/projects-accounts.html">
            
                    
                    项目用户安全管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.5" data-path="../openshift/labs/secure-secrets.html">
            
                <a href="../openshift/labs/secure-secrets.html">
            
                    
                    数据库连接信息保护
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.6" data-path="../openshift/labs/db-persist.html">
            
                <a href="../openshift/labs/db-persist.html">
            
                    
                    持久化数据库存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.7" data-path="../openshift/labs/wordpress.html">
            
                <a href="../openshift/labs/wordpress.html">
            
                    
                    部署 wordpress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.8" data-path="../openshift/labs/scaling.html">
            
                <a href="../openshift/labs/scaling.html">
            
                    
                    扩展应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.9" data-path="../openshift/labs/hpa.html">
            
                <a href="../openshift/labs/hpa.html">
            
                    
                    弹性扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.10" data-path="../openshift/labs/010.html">
            
                <a href="../openshift/labs/010.html">
            
                    
                    Blue-Green Deployments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.11" data-path="../openshift/labs/011.html">
            
                <a href="../openshift/labs/011.html">
            
                    
                    SCM Web Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.12" data-path="../openshift/labs/012.html">
            
                <a href="../openshift/labs/012.html">
            
                    
                    Rollback Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.13" data-path="../openshift/labs/deploy-an-operator.html">
            
                <a href="../openshift/labs/deploy-an-operator.html">
            
                    
                    Operator 部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.14" data-path="../openshift/labs/014.html">
            
                <a href="../openshift/labs/014.html">
            
                    
                    JBoss Developer Studio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.15" data-path="../openshift/labs/015.html">
            
                <a href="../openshift/labs/015.html">
            
                    
                    Deploy a SpringBoot Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../openshift/case.html">
            
                <a href="../openshift/case.html">
            
                    
                    用例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    KUBERNETES
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="install.html">
            
                <a href="install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="case.html">
            
                <a href="case.html">
            
                    
                    概念
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="net.html">
            
                <a href="net.html">
            
                    
                    网络
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.4" data-path="dev.html">
            
                <a href="dev.html">
            
                    
                    开发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="admin.html">
            
                <a href="admin.html">
            
                    
                    管理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../ansible/">
            
                <a href="../ansible/">
            
                    
                    ANSIBLE
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../ansible/basic-usage.html">
            
                <a href="../ansible/basic-usage.html">
            
                    
                    基本使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../jboss/readme.html">
            
                <a href="../jboss/readme.html">
            
                    
                    APPDEV
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../jboss/api/readme.html">
            
                <a href="../jboss/api/readme.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../jboss/mesh.html">
            
                <a href="../jboss/mesh.html">
            
                    
                    Mesh
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../jboss/faas/openwhisk.html">
            
                <a href="../jboss/faas/openwhisk.html">
            
                    
                    Serverless
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../jboss/coolstore/">
            
                <a href="../jboss/coolstore/">
            
                    
                    CoolStore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../jboss/rhte18/redhat-msa.html">
            
                <a href="../jboss/rhte18/redhat-msa.html">
            
                    
                    微服务及红帽产品集成实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" >
            
                <a target="_blank" href="http://ksoong.org/drools-examples/content/">
            
                    
                    规则引擎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../jboss/amq/amq.html">
            
                <a href="../jboss/amq/amq.html">
            
                    
                    A-MQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../jboss/amq/streams.html">
            
                <a href="../jboss/amq/streams.html">
            
                    
                    AMQ Streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../jboss/amq/install.html">
            
                <a href="../jboss/amq/install.html">
            
                    
                    AMQ 6.3 安装测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.8" >
            
                <a target="_blank" href="http://ksoong.org/agile-integration/">
            
                    
                    敏捷集成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../jboss/bpm/bpm.html">
            
                <a href="../jboss/bpm/bpm.html">
            
                    
                    BPM
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.9.1" data-path="../jboss/bpm/install.html">
            
                <a href="../jboss/bpm/install.html">
            
                    
                    安装测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../jboss/adc/adc.html">
            
                <a href="../jboss/adc/adc.html">
            
                    
                    应用交付网络
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" >
            
                <a target="_blank" href="https://realtimeinsights.github.io">
            
                    
                    数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../jboss/datavirt/datavirt.html">
            
                <a href="../jboss/datavirt/datavirt.html">
            
                    
                    数据虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.12.1" data-path="../jboss/datavirt/software-list.html">
            
                <a href="../jboss/datavirt/software-list.html">
            
                    
                    软件版本号对照表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.2" data-path="../jboss/datavirt/changelog.html">
            
                <a href="../jboss/datavirt/changelog.html">
            
                    
                    修订记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.3" data-path="../jboss/datavirt/download.html">
            
                <a href="../jboss/datavirt/download.html">
            
                    
                    下载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.4" data-path="../jboss/datavirt/install.html">
            
                <a href="../jboss/datavirt/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.5" data-path="../jboss/datavirt/start.html">
            
                <a href="../jboss/datavirt/start.html">
            
                    
                    启动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.6" data-path="../jboss/datavirt/deploy-vdbs.html">
            
                <a href="../jboss/datavirt/deploy-vdbs.html">
            
                    
                    部署测试 VDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.7" data-path="../jboss/datavirt/meta.html">
            
                <a href="../jboss/datavirt/meta.html">
            
                    
                    元数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.8" data-path="../jboss/datavirt/jbds-jdv.html">
            
                <a href="../jboss/datavirt/jbds-jdv.html">
            
                    
                    JBDS 创建虚拟数据库操作示例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../solutions/">
            
                <a href="../solutions/">
            
                    
                    SOLUTIONS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../solutions/abc-distribute-arch.html">
            
                <a href="../solutions/abc-distribute-arch.html">
            
                    
                    核心银行系统分布式架构转型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../about/">
            
                <a href="../about/">
            
                    
                    BUSINESS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../about/data.html">
            
                <a href="../about/data.html">
            
                    
                    数据洞见未来
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../about/it-professions.html">
            
                <a href="../about/it-professions.html">
            
                    
                    PROFESSIONS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../about/softskills.html">
            
                <a href="../about/softskills.html">
            
                    
                    SKILLS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >开发</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x5F00;&#x53D1;">&#x5F00;&#x53D1;</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_core_concepts">Core Concepts</a>
<ul class="sectlevel2">
<li><a href="#__kubernets">&#x83B7;&#x53D6; Kubernets &#x6240;&#x6709;&#x5BF9;&#x8C61;</a></li>
<li><a href="#__namespace">&#x5728; namespace &#x4E0B;&#x521B;&#x5EFA;&#x5BB9;&#x5668;</a></li>
<li><a href="#__yaml_pod">&#x4F7F;&#x7528; yaml &#x6587;&#x4EF6;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664; POD</a></li>
<li><a href="#__pod_pod">&#x521B;&#x5EFA; POD &#x5E76;&#x67E5;&#x770B; POD &#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li>
<li><a href="#__busybox_pod_pod">&#x521B;&#x5EFA; busybox POD &#x5E76;&#x786E;&#x4FDD; POD &#x4E00;&#x76F4;&#x8FD0;&#x884C;</a></li>
<li><a href="#__pod_echo">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; POD &#x6267;&#x884C; echo &#x547D;&#x4EE4;&#x540E;&#x9000;&#x51FA;</a></li>
<li><a href="#__pod_echo_2">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; POD &#x6267;&#x884C; echo &#x547D;&#x4EE4;&#x540E;&#x5220;&#x9664;</a></li>
<li><a href="#__resourcequota_default_1gb_1_cpu_2_pod">&#x521B;&#x5EFA; ResourceQuota &#x9650;&#x5236; default &#x4E0B;&#x6700;&#x591A;&#x4F7F;&#x7528; 1GB &#x5185;&#x5B58; 1 CPU&#xFF0C;&#x6700;&#x591A;&#x8FD0;&#x884C; 2 POD</a></li>
<li><a href="#__pod_nginx_containerport_80_nginx_nginx_code_g_daemon_off_q_code_pod_web_namespace">&#x521B;&#x5EFA; POD&#xFF0C;&#x4F7F;&#x7528; nginx &#x955C;&#x50CF;&#xFF0C;&#x8BBE;&#x5B9A; containerPort &#x4E3A; 80&#xFF0C;&#x6267;&#x884C; nginx &#x547D;&#x4EE4;&#xFF0C;nginx &#x547D;&#x4EE4;&#x4F20;&#x9012;&#x53C2;&#x6570; <code>-g daemon off; -q</code>&#xFF0C;POD &#x5728; web namespace &#x4E0B;</a></li>
<li><a href="#__node">&#x67E5;&#x770B; Node</a></li>
</ul>
</li>
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#__configmap_foo_love_bar_puppy">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B;&#x4E24;&#x4E2A;&#x952E;&#x503C;&#x5BF9;(foo=love, bar=puppy)</a></li>
<li><a href="#__configmap_uat_prod">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B; UAT &#x548C; PROD &#x914D;&#x7F6E;&#x6587;&#x4EF6;</a></li>
<li><a href="#__configmap_foo_love_bar_puppy_busybox_pod">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B;&#x4E24;&#x4E2A;&#x952E;&#x503C;&#x5BF9;(foo=love, bar=puppy) &#x5E76;&#x4EE5;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x7ED9; busybox POD</a></li>
<li><a href="#__configmap_foo_love_bar_puppy_pod">&#x5C06; ConfigMap &#x4E24;&#x4E2A;&#x952E;&#x503C;&#x5BF9;(foo=love, bar=puppy) &#x76F4;&#x63A5;&#x4F5C;&#x4E3A; POD &#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li>
<li><a href="#__configmap_uat_prod_pod_etc_data">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B; UAT &#x548C; PROD &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x6302;&#x8F7D;&#x5230; POD /etc/data &#x76EE;&#x5F55;</a></li>
<li><a href="#__configmap_uat_prod_pod_etc_data_uat_etc_data_prod">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B; UAT &#x548C; PROD &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5206;&#x522B;&#x6302;&#x8F7D;&#x5230; POD &#x7684; /etc/data/uat &#x548C; /etc/data/prod &#x76EE;&#x5F55;</a></li>
<li><a href="#_redis_volume_configmap">Redis &#x914D;&#x7F6E;&#x6587;&#x4EF6;(Volume &#x5BF9;&#x63A5; ConfigMap)</a></li>
<li><a href="#_ngnix_env_configmap">Ngnix &#x8FD0;&#x884C;&#x53C2;&#x6570;(ENV &#x53C2;&#x6570;&#x5BF9;&#x63A5; ConfigMap)</a></li>
<li><a href="#_securitycontexts">SecurityContexts &#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x8BBF;&#x95EE;&#x5E95;&#x5C42;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x6743;&#x9650;</a></li>
<li><a href="#__yaml_pod_id_101_nginx">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; YAML &#x90E8;&#x7F72;&#x4E00;&#x4E2A; POD&#xFF0C;&#x4EE5; ID &#x4E3A; 101 &#x7684;&#x7528;&#x6237;&#x8FD0;&#x884C; nginx</a></li>
<li><a href="#__yaml_pod_net_admin_sys_time">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; YAML &#x90E8;&#x7F72;&#x4E00;&#x4E2A; POD&#xFF0C;&#x552F;&#x4E00;&#x7684;&#x5BB9;&#x5668;&#x5177;&#x6709; NET_ADMIN &#x548C; SYS_TIME &#x80FD;&#x529B;</a></li>
<li><a href="#_resource_requests_resource_limits">Resource Requests &#x548C; Resource Limits &#x7684;&#x533A;&#x522B;</a></li>
<li><a href="#__busybox_64_mb_cpu_250_m_128_mb_cpu_500_m">&#x547D;&#x4EE4;&#x884C;&#x90E8;&#x7F72; busybox &#x5BB9;&#x5668;&#xFF0C;&#x8BBE;&#x5B9A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x6240;&#x9700;&#x5185;&#x5B58; 64 MB CPU &#x4E3A; 250 m&#xFF0C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x6700;&#x5927;&#x5185;&#x5B58;&#x4E3A; 128 MB&#xFF0C;CPU &#x4E3A; 500 m</a></li>
<li><a href="#_yaml_busybox_64_mb_cpu_250_m_128_mb_cpu_500_m">YAML &#x90E8;&#x7F72; busybox &#x5BB9;&#x5668;&#xFF0C;&#x8BBE;&#x5B9A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x6240;&#x9700;&#x5185;&#x5B58; 64 MB CPU &#x4E3A; 250 m&#xFF0C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x6700;&#x5927;&#x5185;&#x5B58;&#x4E3A; 128 MB&#xFF0C;CPU &#x4E3A; 500 m</a></li>
<li><a href="#__secret_password_mypass">&#x521B;&#x5EFA; Secret &#x5185;&#x5BB9;&#x4E3A; password=mypass</a></li>
<li><a href="#__secret_password_password">&#x521B;&#x5EFA; Secret &#x5185;&#x5BB9;&#x4E3A; password&#xFF0C; password &#x4FDD;&#x5B58;&#x5728;&#x6587;&#x4EF6;&#x4E0A;</a></li>
<li><a href="#__secret_etc_foo">&#x5C06; Secret &#x6302;&#x8F7D;&#x5230;&#x5BB9;&#x5668;&#xFF0C;&#x8DEF;&#x5F84;&#x4E3A; /etc/foo</a></li>
<li><a href="#__secret_my_secret_test_username_my_secret_test_password">&#x5C06; Secret &#x4EE5;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x7ED9;&#x5BB9;&#x5668;&#xFF0C;&#x53D8;&#x91CF;&#x540D;&#x4E3A; MY_SECRET_TEST_USERNAME &#x548C; MY_SECRET_TEST_PASSWORD</a></li>
<li><a href="#__serviceaccounts">&#x67E5;&#x770B;&#x96C6;&#x7FA4;&#x4E2D;&#x6240;&#x6709;&#x7684; ServiceAccounts</a></li>
<li><a href="#__serviceaccounts_myuser">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; ServiceAccounts &#x540D;&#x4E3A; myuser</a></li>
<li><a href="#_pod_serviceaccounts">POD &#x4E2D;&#x4F7F;&#x7528; ServiceAccounts</a></li>
<li><a href="#__candy_themed">&#x5BB9;&#x5668;&#x5316;&#x90E8;&#x7F72; candy-themed &#x6E38;&#x620F;</a></li>
</ul>
</li>
<li><a href="#_multi_container_pods">Multi-Container Pods</a>
<ul class="sectlevel2">
<li><a href="#_multi_container">Multi-Container &#x4E09;&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;</a></li>
<li><a href="#_haproxy_ambassador_haproxy_svc">HAproxy Ambassador &#x6A21;&#x5F0F; - HAproxy &#x5BB9;&#x5668;&#x4F4D;&#x4E8E; SVC &#x5BB9;&#x5668;&#x4E4B;&#x524D;</a></li>
<li><a href="#_fluentd_adapter_fluentd_svc">fluentd Adapter &#x6A21;&#x5F0F; - fluentd &#x6536;&#x96C6; SVC &#x5BB9;&#x5668;&#x65E5;&#x5FD7;</a></li>
</ul>
</li>
<li><a href="#_observability">Observability</a>
<ul class="sectlevel2">
<li><a href="#__livenessprobe_echo_test_5_10">&#x521B;&#x5EFA; livenessProbe&#xFF0C;&#x6267;&#x884C; echo test &#x547D;&#x4EE4;&#xFF0C;&#x521D;&#x6B21;&#x5EF6;&#x8FDF;&#x4E3A; 5 &#x79D2;&#xFF0C;&#x5468;&#x671F;&#x4E3A; 10 &#x79D2;</a></li>
<li><a href="#__readinessprobe_http_get_80_5_10">&#x521B;&#x5EFA; readinessProbe&#xFF0C;&#x6267;&#x884C; HTTP GET&#xFF0C;&#x8DEF;&#x5F84; /&#xFF0C;&#x7AEF;&#x53E3; 80&#xFF0C;&#x521D;&#x6B21;&#x5EF6;&#x8FDF;&#x4E3A; 5 &#x79D2;&#xFF0C;&#x5468;&#x671F; 10 &#x79D2;</a></li>
<li><a href="#__busybox_pod_code_i_0_while_true_do_echo_i_date_i_i_1_sleep_1_done_code">&#x521B;&#x5EFA; busybox POD&#xFF0C;&#x6267;&#x884C; <code>i=0; while true; do echo &quot;$i: $(date)&quot;; i=$i+1; sleep 1; done</code>&#xFF0C;&#x67E5;&#x770B;&#x65E5;&#x5FD7;</a></li>
<li><a href="#__">&#x68C0;&#x6D4B;&#x5E94;&#x7528;&#x662F;&#x5426;&#x91CD;&#x542F;&#xFF0C;&#x4EE5;&#x53CA;&#x5E94;&#x7528;&#x662F;&#x5426;&#x5C31;&#x7EEA;</a></li>
<li><a href="#__metrics_server">&#x5B89;&#x88C5; Metrics Server</a></li>
<li><a href="#___2">&#x5E38;&#x89C1;&#x5E94;&#x7528;&#x76D1;&#x63A7;&#x573A;&#x666F;</a></li>
<li><a href="#__troubleshooting">&#x57FA;&#x672C; Troubleshooting &#x6B65;&#x9AA4;</a></li>
</ul>
</li>
<li><a href="#_pod_design">Pod Design</a>
<ul class="sectlevel2">
<li><a href="#__labels_selectors">&#x5E38;&#x89C1; Labels, Selectors &#x64CD;&#x4F5C;</a></li>
<li><a href="#__pod_label_app_v1">&#x521B;&#x5EFA;&#x4E09;&#x4E2A; POD &#xFF0C;Label &#x90FD;&#x5305;&#x542B; app=v1</a></li>
<li><a href="#__pod_label">&#x67E5;&#x770B;&#x5E76;&#x4FEE;&#x6539; POD &#x7684; Label</a></li>
<li><a href="#__pod_description_my_description_annotation">&#x7ED9;&#x8FD0;&#x884C;&#x7684; POD &#x6DFB;&#x52A0;&quot;description=&apos;my description&apos;&quot; &#x7684; Annotation</a></li>
<li><a href="#__pod_annotation">&#x5220;&#x9664;&#x8FD0;&#x884C; POD &#x7684; Annotation</a></li>
<li><a href="#__deployments">&#x5E38;&#x89C1; Deployments &#x64CD;&#x4F5C;</a></li>
<li><a href="#___3">&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#xFF0C;&#x7248;&#x672C;&#x56DE;&#x6EDA;</a></li>
<li><a href="#__statefulset_nginx_pod_3">&#x90E8;&#x7F72; StatefulSet&#xFF0C; &#x4F7F;&#x7528; nginx &#x955C;&#x50CF;&#xFF0C;POD &#x526F;&#x672C;&#x6570;&#x4E3A; 3</a></li>
<li><a href="#_jobs_cronjobs">Jobs &#x548C; CronJobs &#x6BD4;&#x8F83;</a></li>
<li><a href="#__job_2000">&#x521B;&#x5EFA; Job &#x8BA1;&#x7B97; &#x3C0; &#x540E; 2000 &#x4F4D;&#x8F93;&#x51FA;&#x5230;&#x65E5;&#x5FD7;</a></li>
<li><a href="#__job_20_5">&#x521B;&#x5EFA; Job &#x8BA1;&#x7B97; &#x3C0; &#x540E; 20 &#x4F4D;&#x8F93;&#x51FA;&#x5230;&#x65E5;&#x5FD7;&#xFF0C;&#x5E76;&#x8F93;&#x51FA; 5 &#x6B21;</a></li>
<li><a href="#__job_20_5_2">&#x521B;&#x5EFA; Job &#x8BA1;&#x7B97; &#x3C0; &#x540E; 20 &#x4F4D;&#x8F93;&#x51FA;&#x5230;&#x65E5;&#x5FD7;&#xFF0C;&#x5E76;&#x5E76;&#x884C;&#x8F93;&#x51FA; 5 &#x6B21;</a></li>
<li><a href="#__job_busybox_echo_sleep">&#x521B;&#x5EFA; Job &#x8FD0;&#x884C; busybox &#x6267;&#x884C; echo, sleep &#x547D;&#x4EE4;</a></li>
<li><a href="#__cronjob">&#x521B;&#x5EFA; CronJob &#x6BCF;&#x9694;&#x4E00;&#x5206;&#x949F;&#x8F93;&#x51FA;&#x65F6;&#x95F4;&#x53CA;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;</a></li>
<li><a href="#_pizza">pizza &#x670D;&#x52A1;&#x90E8;&#x7F72;</a></li>
</ul>
</li>
<li><a href="#_services_and_networking">Services and Networking</a>
<ul class="sectlevel2">
<li><a href="#__nginx_pod_80">&#x57FA;&#x4E8E; nginx &#x955C;&#x50CF;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; POD&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x66B4;&#x9732;&#x5728; 80 &#x7AEF;&#x53E3;</a></li>
<li><a href="#__nginx_deployment_80">&#x57FA;&#x4E8E; nginx &#x955C;&#x50CF;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Deployment&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x66B4;&#x9732;&#x5728; 80 &#x7AEF;&#x53E3;</a></li>
<li><a href="#_nginx">Nginx &#x8BBF;&#x95EE;&#x7B56;&#x7565;&#x5B9A;&#x5236;</a></li>
<li><a href="#___4">&#x7F51;&#x5173;&#x57FA;&#x4E8E;&#x4E0D;&#x540C;&#x7B56;&#x7565;&#x8BBF;&#x95EE;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;</a></li>
</ul>
</li>
<li><a href="#_state_persistence">State Persistence</a>
<ul class="sectlevel2">
<li><a href="#_redis">Redis &#x6301;&#x4E45;&#x5316;</a></li>
<li><a href="#_mysql">Mysql &#x6301;&#x4E45;&#x5316;</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_core_concepts">Core Concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__kubernets">&#x83B7;&#x53D6; Kubernets &#x6240;&#x6709;&#x5BF9;&#x8C61;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl api-resources --sort-by=name -o name | wc <span class="hljs-_">-l</span>
67

$ kubectl api-resources --sort-by=name -o name
apiservices.apiregistration.k8s.io
bgpconfigurations.crd.projectcalico.org
bgppeers.crd.projectcalico.org
bindings
blockaffinities.crd.projectcalico.org
certificatesigningrequests.certificates.k8s.io
clusterinformations.crd.projectcalico.org
clusterrolebindings.rbac.authorization.k8s.io
clusterroles.rbac.authorization.k8s.io
componentstatuses
configmaps
controllerrevisions.apps
cronjobs.batch
csidrivers.storage.k8s.io
csinodes.storage.k8s.io
customresourcedefinitions.apiextensions.k8s.io
daemonsets.apps
deployments.apps
endpoints
endpointslices.discovery.k8s.io
events
events.events.k8s.io
felixconfigurations.crd.projectcalico.org
globalnetworkpolicies.crd.projectcalico.org
globalnetworksets.crd.projectcalico.org
horizontalpodautoscalers.autoscaling
hostendpoints.crd.projectcalico.org
ingresses.extensions
ingresses.networking.k8s.io
ipamblocks.crd.projectcalico.org
ipamconfigs.crd.projectcalico.org
ipamhandles.crd.projectcalico.org
ippools.crd.projectcalico.org
jobs.batch
leases.coordination.k8s.io
limitranges
localsubjectaccessreviews.authorization.k8s.io
mutatingwebhookconfigurations.admissionregistration.k8s.io
namespaces
networkpolicies.networking.k8s.io
networkpolicies.crd.projectcalico.org
networksets.crd.projectcalico.org
nodes
persistentvolumeclaims
persistentvolumes
poddisruptionbudgets.policy
pods
podsecuritypolicies.policy
podtemplates
priorityclasses.scheduling.k8s.io
replicasets.apps
replicationcontrollers
resourcequotas
rolebindings.rbac.authorization.k8s.io
roles.rbac.authorization.k8s.io
runtimeclasses.node.k8s.io
secrets
selfsubjectaccessreviews.authorization.k8s.io
selfsubjectrulesreviews.authorization.k8s.io
serviceaccounts
services
statefulsets.apps
storageclasses.storage.k8s.io
subjectaccessreviews.authorization.k8s.io
tokenreviews.authentication.k8s.io
validatingwebhookconfigurations.admissionregistration.k8s.io
volumeattachments.storage.k8s.io</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__namespace">&#x5728; namespace &#x4E0B;&#x521B;&#x5EFA;&#x5BB9;&#x5668;</h3>
<div class="paragraph">
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; namespace&#xFF0C;&#x540D;&#x79F0;&#x4E3A; mynamespace&#xFF0C;&#x5E76;&#x5728;&#x8BE5; namespace &#x4E0B;&#x521B;&#x5EFA; POD&#xFF0C;POD &#x4E2D;&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x955C;&#x50CF;&#x4E3A; nginx&#xFF0C;POD &#x7684;&#x540D;&#x79F0;&#x4E3A; nginx</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create ns mynamespace
kubectl run nginx --image=nginx --generator=run-pod/v1 -n mynamespace
kubectl delete ns mynamespace</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__yaml_pod">&#x4F7F;&#x7528; yaml &#x6587;&#x4EF6;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664; POD</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run nginx --image=nginx --generator=run-pod/v1 --dry-run -o yaml &gt; pod.yaml
kubectl create <span class="hljs-_">-f</span> pod.yaml
kubectl delete <span class="hljs-_">-f</span> pod.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pod_pod">&#x521B;&#x5EFA; POD &#x5E76;&#x67E5;&#x770B; POD &#x73AF;&#x5883;&#x53D8;&#x91CF;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run busybox --image=busybox --generator=run-pod/v1 --command -- env
kubectl logs busybox &gt; env.log</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__busybox_pod_pod">&#x521B;&#x5EFA; busybox POD &#x5E76;&#x786E;&#x4FDD; POD &#x4E00;&#x76F4;&#x8FD0;&#x884C;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// create pod
kubectl run busybox --image=busybox:1.28 --generator=run-pod/v1 --command -- sh -c <span class="hljs-string">&quot;echo Hello Kubernetes! &amp;&amp; sleep 3600&quot;</span>

// get pod
kubectl get pods -o wide</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pod_echo">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; POD &#x6267;&#x884C; echo &#x547D;&#x4EE4;&#x540E;&#x9000;&#x51FA;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run busybox --image=busybox --generator=run-pod/v1 --restart=Never --command -- <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello World&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pod_echo_2">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; POD &#x6267;&#x884C; echo &#x547D;&#x4EE4;&#x540E;&#x5220;&#x9664;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run busybox --image=busybox -it --rm --generator=run-pod/v1 --restart=Never --command -- <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello World&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__resourcequota_default_1gb_1_cpu_2_pod">&#x521B;&#x5EFA; ResourceQuota &#x9650;&#x5236; default &#x4E0B;&#x6700;&#x591A;&#x4F7F;&#x7528; 1GB &#x5185;&#x5B58; 1 CPU&#xFF0C;&#x6700;&#x591A;&#x8FD0;&#x884C; 2 POD</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create quota myrq --hard=cpu=1,memory=1G,pods=2
kubectl delete quota myrq</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pod_nginx_containerport_80_nginx_nginx_code_g_daemon_off_q_code_pod_web_namespace">&#x521B;&#x5EFA; POD&#xFF0C;&#x4F7F;&#x7528; nginx &#x955C;&#x50CF;&#xFF0C;&#x8BBE;&#x5B9A; containerPort &#x4E3A; 80&#xFF0C;&#x6267;&#x884C; nginx &#x547D;&#x4EE4;&#xFF0C;nginx &#x547D;&#x4EE4;&#x4F20;&#x9012;&#x53C2;&#x6570; <code>-g daemon off; -q</code>&#xFF0C;POD &#x5728; web namespace &#x4E0B;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// yaml
cat &lt;&lt;EOF &gt; ./pod-nginx.yaml
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: nginx
  name: nginx
spec:
  containers:
  - <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;nginx&quot;</span>]
    args: [<span class="hljs-string">&quot;-g&quot;</span>, <span class="hljs-string">&quot;daemon off;&quot;</span>, <span class="hljs-string">&quot;-q&quot;</span>]
    image: nginx
    name: nginx
    ports:
    - containerPort: 80
EOF

// create
kubectl create <span class="hljs-_">-f</span> pod-nginx.yaml -n web

// verify
kubectl get pods -n web</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__node">&#x67E5;&#x770B; Node</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// get node
kubectl get nodes

// view details
kubectl describe nodes</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__configmap_foo_love_bar_puppy">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B;&#x4E24;&#x4E2A;&#x952E;&#x503C;&#x5BF9;(foo=love, bar=puppy)</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create configmap my-config --from-literal=foo=love --from-literal=bar=puppy
kubectl get cm
kubectl get cm my-config -o yaml
kubectl delete cm my-config</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__configmap_uat_prod">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B; UAT &#x548C; PROD &#x914D;&#x7F6E;&#x6587;&#x4EF6;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// prepare config
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;{state: 101, config: {cur: 12, weight: 25}}&quot;</span> &gt; configmap/UAT.config
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;{state: 102, config: {cur: 12, weight: 25}}&quot;</span> &gt; configmap/PROD.config

// ConfigMap
kubectl create configmap my-config --from-file=configmap/
kubectl get cm
kubectl describe cm my-config
kubectl get cm my-config -o yaml
kubectl delete cm my-config</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__configmap_foo_love_bar_puppy_busybox_pod">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B;&#x4E24;&#x4E2A;&#x952E;&#x503C;&#x5BF9;(foo=love, bar=puppy) &#x5E76;&#x4EE5;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x7ED9; busybox POD</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create configmap my-config --from-literal=foo=love --from-literal=bar=puppy

cat &lt;&lt;EOF &gt; ./busybox.yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: busybox
  name: busybox
spec:
  containers:
  - image: busybox
    name: busybox
    <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;env&quot;</span>]
    env:
    - name: CM_VALUE_FOO
      valueFrom:
        configMapKeyRef:
          name: my-config
          key: foo
    - name: CM_VALUE_BAR
      valueFrom:
        configMapKeyRef:
          name: my-config
          key: bar
  restartPolicy: Never
EOF

kubectl create <span class="hljs-_">-f</span> busybox.yaml

kubectl logs busybox | grep CM_VALUE</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__configmap_foo_love_bar_puppy_pod">&#x5C06; ConfigMap &#x4E24;&#x4E2A;&#x952E;&#x503C;&#x5BF9;(foo=love, bar=puppy) &#x76F4;&#x63A5;&#x4F5C;&#x4E3A; POD &#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create configmap my-config --from-literal=foo=love --from-literal=bar=puppy

cat &lt;&lt;EOF &gt; ./busybox.yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: busybox
  name: busybox
spec:
  containers:
  - image: busybox
    name: busybox
    <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;env&quot;</span>]
    envFrom:
    - configMapRef:
        name: my-config
  restartPolicy: Never
EOF

kubectl create <span class="hljs-_">-f</span> busybox.yaml

kubectl logs busybox | grep foo
kubectl logs busybox | grep bar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__configmap_uat_prod_pod_etc_data">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B; UAT &#x548C; PROD &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x6302;&#x8F7D;&#x5230; POD /etc/data &#x76EE;&#x5F55;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// prepare config
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;{state: 101, config: {cur: 12, weight: 25}}&quot;</span> &gt; configmap/UAT.config
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;{state: 102, config: {cur: 12, weight: 25}}&quot;</span> &gt; configmap/PROD.config

// ConfigMap
kubectl create configmap my-config --from-file=configmap/

// pod
cat &lt;&lt;EOF &gt; ./busybox.yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: busybox
  name: busybox
spec:
  containers:
  - image: busybox
    name: busybox
    <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;sleep 3600&quot;</span>]
    volumeMounts:
    - name: config-volume
      mountPath: /etc/data
  volumes:
  - name: config-volume
    configMap:
      name: my-config
EOF

kubectl create <span class="hljs-_">-f</span> busybox.yaml

// view
kubectl <span class="hljs-built_in">exec</span> busybox -- cat /etc/data/UAT.config
kubectl <span class="hljs-built_in">exec</span> busybox -- cat /etc/data/PROD.config</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__configmap_uat_prod_pod_etc_data_uat_etc_data_prod">&#x521B;&#x5EFA; ConfigMap &#x5305;&#x542B; UAT &#x548C; PROD &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5206;&#x522B;&#x6302;&#x8F7D;&#x5230; POD &#x7684; /etc/data/uat &#x548C; /etc/data/prod &#x76EE;&#x5F55;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// prepare config
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;{state: 101, config: {cur: 12, weight: 25}}&quot;</span> &gt; configmap/UAT.config
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;{state: 102, config: {cur: 12, weight: 25}}&quot;</span> &gt; configmap/PROD.config

// ConfigMap
kubectl create configmap my-config --from-file=configmap/

// pod
cat &lt;&lt;EOF &gt; ./busybox.yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: busybox
  name: busybox
spec:
  containers:
  - image: busybox
    name: busybox
    <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;sleep 3600&quot;</span>]
    volumeMounts:
    - name: prod-config-volume
      mountPath: /etc/data/prod
    - name: uat-config-volume
      mountPath: /etc/data/uat
  volumes:
  - name: prod-config-volume
    configMap:
      name: my-config
      items:
      - key: PROD.config
        path: PROD.config
  - name: uat-config-volume
    configMap:
      name: my-config
      items:
      - key: UAT.config
        path: UAT.config
EOF

kubectl create <span class="hljs-_">-f</span> busybox.yaml

// view
kubectl <span class="hljs-built_in">exec</span> busybox -- cat /etc/data/uat/UAT.config
kubectl <span class="hljs-built_in">exec</span> busybox -- cat /etc/data/prod/PROD.config</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_redis_volume_configmap">Redis &#x914D;&#x7F6E;&#x6587;&#x4EF6;(Volume &#x5BF9;&#x63A5; ConfigMap)</h3>
<div class="paragraph">
<p>&#x672C;&#x90E8;&#x5206;&#x6F14;&#x793A;&#x5C06; Redis &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x901A;&#x8FC7; ConfigMap &#x4F20;&#x9012;&#x3002;</p>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; redis-config</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// prepare files
cat &lt;&lt;EOF &gt; ./redis-config
maxmemory <span class="hljs-number">2</span>mb
maxmemory-policy allkeys-lru
EOF

// create configMap
kubectl create configmap redis-config --from-file=redis-config</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA;&#x4E00;&#x4E2A; POD</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// prepare yaml files
cat &lt;&lt;EOF &gt; ./pod.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> redis
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> redis
<span class="hljs-attr">    image:</span> redis:<span class="hljs-number">5.0</span><span class="hljs-number">.4</span>
<span class="hljs-attr">    command:</span>
<span class="hljs-bullet">      -</span> redis-server
<span class="hljs-bullet">      -</span> <span class="hljs-string">&quot;/redis-master/redis.conf&quot;</span>
<span class="hljs-attr">    env:</span>
<span class="hljs-attr">    - name:</span> MASTER
<span class="hljs-attr">      value:</span> <span class="hljs-string">&quot;true&quot;</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">6379</span>
<span class="hljs-attr">    resources:</span>
<span class="hljs-attr">      limits:</span>
<span class="hljs-attr">        cpu:</span> <span class="hljs-string">&quot;0.1&quot;</span>
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - mountPath:</span> /redis-master-data
<span class="hljs-attr">      name:</span> data
<span class="hljs-attr">    - mountPath:</span> /redis-master
<span class="hljs-attr">      name:</span> config
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">    - name:</span> data
<span class="hljs-attr">      emptyDir:</span> {}
<span class="hljs-attr">    - name:</span> config
<span class="hljs-attr">      configMap:</span>
<span class="hljs-attr">        name:</span> redis-config
<span class="hljs-attr">        items:</span>
<span class="hljs-attr">        - key:</span> redis-config
<span class="hljs-attr">          path:</span> redis.conf
EOF

// create pod
kubectl create -f pod.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x9A8C;&#x8BC1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-comment"># kubectl exec -it redis redis-cli</span>
<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; CONFIG GET maxmemory
<span class="hljs-number">1</span>) <span class="hljs-string">&quot;maxmemory&quot;</span>
<span class="hljs-number">2</span>) <span class="hljs-string">&quot;2097152&quot;</span>
<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; CONFIG GET maxmemory-policy
<span class="hljs-number">1</span>) <span class="hljs-string">&quot;maxmemory-policy&quot;</span>
<span class="hljs-number">2</span>) <span class="hljs-string">&quot;allkeys-lru&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ngnix_env_configmap">Ngnix &#x8FD0;&#x884C;&#x53C2;&#x6570;(ENV &#x53C2;&#x6570;&#x5BF9;&#x63A5; ConfigMap)</h3>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; nginx-config</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create configmap nginx-config --from-literal=username=kylin --from-literal=password=password</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA;&#x4E00;&#x4E2A; POD</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// prepare yaml files
cat &lt;&lt;EOF &gt; ./pod-nginx.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> nginx
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> nginx
<span class="hljs-attr">    name:</span> nginx
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    resources:</span> {}
<span class="hljs-attr">    env:</span>
<span class="hljs-attr">    - name:</span> NGINX_USERNAME
<span class="hljs-attr">      valueFrom:</span>
<span class="hljs-attr">        configMapKeyRef:</span>
<span class="hljs-attr">          name:</span> nginx-config
<span class="hljs-attr">          key:</span> username
<span class="hljs-attr">    - name:</span> NGINX_PASSWORD
<span class="hljs-attr">      valueFrom:</span>
<span class="hljs-attr">        configMapKeyRef:</span>
<span class="hljs-attr">          name:</span> nginx-config
<span class="hljs-attr">          key:</span> password
<span class="hljs-attr">  dnsPolicy:</span> ClusterFirst
<span class="hljs-attr">  restartPolicy:</span> Always
EOF

// create pod
kubectl create -f pod-nginx.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x9A8C;&#x8BC1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-comment"># kubectl exec nginx env</span>
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=nginx
NGINX_PASSWORD=password
NGINX_USERNAME=kylin</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securitycontexts">SecurityContexts &#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x8BBF;&#x95EE;&#x5E95;&#x5C42;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x6743;&#x9650;</h3>
<div class="paragraph">
<p>SecurityContexts &#x7528;&#x6765;&#x5B9A;&#x4E49; Pod &#x6216;&#x5BB9;&#x5668;&#x5982;&#x4F55;&#x548C;&#x5E95;&#x5C42;&#x7684;&#x5B89;&#x5168;&#x673A;&#x5236;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF0C;&#x672C;&#x90E8;&#x5206;&#x90E8;&#x7F72;&#x7684;&#x5BB9;&#x5668;&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x5E95;&#x5C42;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x7279;&#x5B9A;&#x7528;&#x6237;&#x548C;&#x7EC4;&#x6743;&#x9650;&#x7684;&#x6587;&#x4EF6;&#x3002;</p>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x67E5;&#x770B; Node &#x4E0A;&#x6587;&#x4EF6;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// a. init users, groups, and files on both worker nodes
<span class="hljs-comment"># for i in 2 3 ; do ssh root@machine0$i &quot;useradd -u 2000 container-user-0; groupadd -g 3000 container-group-0 ; useradd -u 2001 container-user-1 ; groupadd -g 3001 container-group-1&quot;; done</span>

// b. check created users
<span class="hljs-comment"># for i in 2 3 ; do ssh root@machine0$i &quot;grep container /etc/passwd&quot;; done;</span>
container-user-0:x:2000:2000::/home/container-user-0:/bin/sh
container-user-1:x:2001:2001::/home/container-user-1:/bin/sh
container-user-0:x:2000:2000::/home/container-user-0:/bin/sh
container-user-1:x:2001:2001::/home/container-user-1:/bin/sh

// c. check created groups
<span class="hljs-comment"># for i in 2 3 ; do ssh root@machine0$i &quot;grep container /etc/group&quot;; done;</span>
container-user-0:x:2000:
container-group-0:x:3000:
container-user-1:x:2001:
container-group-1:x:3001:
container-user-0:x:2000:
container-group-0:x:3000:
container-user-1:x:2001:
container-group-1:x:3001:

// d. create file and grant rights
<span class="hljs-comment"># for i in 2 3 ; do ssh root@machine0$i &quot;mkdir -p /etc/message/&quot;; done</span>
<span class="hljs-comment"># for i in 2 3 ; do ssh root@machine0$i &quot;echo &apos;Hello, World&apos; | tee -a /etc/message/message.txt &quot;; done</span>
<span class="hljs-comment"># for i in 2 3 ; do ssh root@machine0$i &quot;chown 2000:3000 /etc/message/message.txt ; chmod 640 /etc/message/message.txt&quot;; done</span>

// e. check files grants
<span class="hljs-comment"># for i in 2 3 ; do ssh root@machine0$i &quot;ls -l /etc/message/message.txt&quot;; done;</span>
-rw-r----- 1 container-user-0 container-group-0 13 Mar  9 00:16 /etc/message/message.txt
-rw-r----- 1 container-user-0 container-group-0 13 Mar  9 00:16 /etc/message/message.txt

// f. check the content
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> 2 3 ; <span class="hljs-keyword">do</span> ssh root@machine0<span class="hljs-variable">$i</span> <span class="hljs-string">&quot;cat /etc/message/message.txt&quot;</span>; <span class="hljs-keyword">done</span>;
Hello, World
Hello, World</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x65E0; securityContext&#xFF0C;&#x9ED8;&#x8BA4; root &#x7528;&#x6237;&#x8BBF;&#x95EE;&#x5E95;&#x5C42;&#x6587;&#x4EF6;&#xFF0C;&#x8BBF;&#x95EE;&#x6210;&#x529F;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./securitycontext-test<span class="hljs-bullet">-1.</span>yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> securitycontext-test<span class="hljs-bullet">-1</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> app
<span class="hljs-attr">    image:</span> busybox
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&apos;sh&apos;</span>, <span class="hljs-string">&apos;-c&apos;</span>, <span class="hljs-string">&quot;id &amp;&amp; cat /message/message.txt &amp;&amp; sleep 3600&quot;</span>]
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> message-volume
<span class="hljs-attr">      mountPath:</span> /message
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> message-volume
<span class="hljs-attr">    hostPath:</span>
<span class="hljs-attr">      path:</span> /etc/message
EOF

// create
kubectl create -f securitycontext-test<span class="hljs-bullet">-1.</span>yaml

// verify
<span class="hljs-comment"># kubectl logs securitycontext-test-1</span>
uid=<span class="hljs-number">0</span>(root) gid=<span class="hljs-number">0</span>(root) groups=<span class="hljs-number">10</span>(wheel)
Hello, World</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. securityContext &#x6307;&#x5B9A;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x5E95;&#x5C42;&#x6587;&#x4EF6;&#xFF0C;&#x8BBF;&#x95EE;&#x4E0D;&#x6210;&#x529F;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./securitycontext-test<span class="hljs-bullet">-2.</span>yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> securitycontext-test<span class="hljs-bullet">-2</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  securityContext:</span>
<span class="hljs-attr">    runAsUser:</span> <span class="hljs-number">2001</span>
<span class="hljs-attr">    fsGroup:</span> <span class="hljs-number">3001</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> app
<span class="hljs-attr">    image:</span> busybox
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&apos;sh&apos;</span>, <span class="hljs-string">&apos;-c&apos;</span>, <span class="hljs-string">&quot;id &amp;&amp; cat /message/message.txt &amp;&amp; sleep 3600&quot;</span>]
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> message-volume
<span class="hljs-attr">      mountPath:</span> /message
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> message-volume
<span class="hljs-attr">    hostPath:</span>
<span class="hljs-attr">      path:</span> /etc/message
EOF

// create
kubectl create -f securitycontext-test<span class="hljs-bullet">-2.</span>yaml

// verify
<span class="hljs-comment"># kubectl get pods securitycontext-test-2 --no-headers</span>
securitycontext-test<span class="hljs-bullet">-2</span>   <span class="hljs-number">0</span>/<span class="hljs-number">1</span>   CrashLoopBackOff   <span class="hljs-number">3</span>     <span class="hljs-number">2</span>m17s

<span class="hljs-comment"># kubectl logs securitycontext-test-2</span>
<span class="hljs-attr">cat:</span> can<span class="hljs-string">&apos;t open &apos;</span>/message/message.txt<span class="hljs-string">&apos;: Permission denied
uid=2001 gid=0(root) groups=300</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. securityContext &#x6307;&#x5B9A;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x5E95;&#x5C42;&#x6587;&#x4EF6;&#xFF0C;&#x8BBF;&#x95EE;&#x6210;&#x529F;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./securitycontext-test<span class="hljs-bullet">-3.</span>yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> securitycontext-test<span class="hljs-bullet">-3</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  securityContext:</span>
<span class="hljs-attr">    runAsUser:</span> <span class="hljs-number">2000</span>
<span class="hljs-attr">    fsGroup:</span> <span class="hljs-number">3000</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> app
<span class="hljs-attr">    image:</span> busybox
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&apos;sh&apos;</span>, <span class="hljs-string">&apos;-c&apos;</span>, <span class="hljs-string">&quot;id &amp;&amp; cat /message/message.txt &amp;&amp; sleep 3600&quot;</span>]
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> message-volume
<span class="hljs-attr">      mountPath:</span> /message
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> message-volume
<span class="hljs-attr">    hostPath:</span>
<span class="hljs-attr">      path:</span> /etc/message
EOF

// create
kubectl create -f securitycontext-test<span class="hljs-bullet">-3.</span>yaml

// verify
<span class="hljs-comment"># kubectl logs securitycontext-test-3</span>
uid=<span class="hljs-number">2000</span> gid=<span class="hljs-number">0</span>(root) groups=<span class="hljs-number">3000</span>
Hello, World</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. Clean up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl delete pod $(kubectl get pods --<span class="hljs-literal">no</span>-headers | awk <span class="hljs-string">&apos;{print $1}&apos;</span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__yaml_pod_id_101_nginx">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; YAML &#x90E8;&#x7F72;&#x4E00;&#x4E2A; POD&#xFF0C;&#x4EE5; ID &#x4E3A; 101 &#x7684;&#x7528;&#x6237;&#x8FD0;&#x884C; nginx</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./securitycontext-nginx.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> nginx
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  securityContext:</span>
<span class="hljs-attr">    runAsUser:</span> <span class="hljs-number">101</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> nginx
<span class="hljs-attr">    name:</span> nginx
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
EOF

// create
kubectl create -f securitycontext-nginx.yaml

// verify
<span class="hljs-comment"># kubectl logs nginx</span>
<span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">12</span> <span class="hljs-number">03</span>:<span class="hljs-number">20</span>:<span class="hljs-number">55</span> [warn] <span class="hljs-number">1</span><span class="hljs-comment">#1: the &quot;user&quot; directive makes sense only if the master process runs with super-user privileges, ignored in /etc/nginx/nginx.conf:2</span>
<span class="hljs-attr">nginx:</span> [warn] the <span class="hljs-string">&quot;user&quot;</span> directive makes sense only if the master process runs with super-user privileges, ignored in /etc/nginx/nginx.conf:<span class="hljs-number">2</span>
<span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">12</span> <span class="hljs-number">03</span>:<span class="hljs-number">20</span>:<span class="hljs-number">55</span> [emerg] <span class="hljs-number">1</span><span class="hljs-comment">#1: mkdir() &quot;/var/cache/nginx/client_temp&quot; failed (13: Permission denied)</span>
<span class="hljs-attr">nginx:</span> [emerg] mkdir() <span class="hljs-string">&quot;/var/cache/nginx/client_temp&quot;</span> failed (<span class="hljs-number">13</span>: Permission denied)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__yaml_pod_net_admin_sys_time">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; YAML &#x90E8;&#x7F72;&#x4E00;&#x4E2A; POD&#xFF0C;&#x552F;&#x4E00;&#x7684;&#x5BB9;&#x5668;&#x5177;&#x6709; NET_ADMIN &#x548C; SYS_TIME &#x80FD;&#x529B;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./securitycontext-capability.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> nginx
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> nginx
<span class="hljs-attr">    name:</span> nginx
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    securityContext:</span>
<span class="hljs-attr">      capabilities:</span>
<span class="hljs-attr">        add:</span> [<span class="hljs-string">&quot;NET_ADMIN&quot;</span>, <span class="hljs-string">&quot;SYS_TIME&quot;</span>]
EOF

// create
kubectl create -f securitycontext-capability.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_requests_resource_limits">Resource Requests &#x548C; Resource Limits &#x7684;&#x533A;&#x522B;</h3>
<div class="paragraph">
<p>Kubernets allow us to specify the resource requirements of a container in the pod spec. A container&#x2019;s memory and CPU requirements are defined in term of <code>resource requests</code> and <code>resource limits</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Resource request</strong> - The amount of resources necessary to run a container. A pod will only be a run on a node that has enough avalilable resources to run pod&#x2019;s containers</p>
</li>
<li>
<p><strong>Resource limit</strong> - A maximum value of the resource usage of a container.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="__busybox_64_mb_cpu_250_m_128_mb_cpu_500_m">&#x547D;&#x4EE4;&#x884C;&#x90E8;&#x7F72; busybox &#x5BB9;&#x5668;&#xFF0C;&#x8BBE;&#x5B9A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x6240;&#x9700;&#x5185;&#x5B58; 64 MB CPU &#x4E3A; 250 m&#xFF0C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x6700;&#x5927;&#x5185;&#x5B58;&#x4E3A; 128 MB&#xFF0C;CPU &#x4E3A; 500 m</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run busybox --image=busybox --limits=<span class="hljs-string">&apos;cpu=500m,memory=128Mi&apos;</span> --requests=<span class="hljs-string">&apos;cpu=250m,memory=64Mi&apos;</span> --generator=run-pod/v1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_yaml_busybox_64_mb_cpu_250_m_128_mb_cpu_500_m">YAML &#x90E8;&#x7F72; busybox &#x5BB9;&#x5668;&#xFF0C;&#x8BBE;&#x5B9A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x6240;&#x9700;&#x5185;&#x5B58; 64 MB CPU &#x4E3A; 250 m&#xFF0C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x6700;&#x5927;&#x5185;&#x5B58;&#x4E3A; 128 MB&#xFF0C;CPU &#x4E3A; 500 m</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// yaml
cat &lt;&lt;EOF &gt; ./resource-limits.yaml
apiVersion: v1
kind: Pod
metadata:
  name: busybox
spec:
  containers:
  - name: busybox
    image: busybox
    <span class="hljs-built_in">command</span>: [<span class="hljs-string">&apos;sh&apos;</span>, <span class="hljs-string">&apos;-c&apos;</span>, <span class="hljs-string">&apos;echo Hello Kubernetes! &amp;&amp; sleep 3600&apos;</span>]
    resources:
      requests:
        memory: <span class="hljs-string">&quot;64Mi&quot;</span>
        cpu: <span class="hljs-string">&quot;250m&quot;</span>
      limits:
        memory: <span class="hljs-string">&quot;128Mi&quot;</span>
        cpu: <span class="hljs-string">&quot;500m&quot;</span>
EOF

// run
kubectl create <span class="hljs-_">-f</span> resource-limits.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__secret_password_mypass">&#x521B;&#x5EFA; Secret &#x5185;&#x5BB9;&#x4E3A; password=mypass</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create secret generic my-secret --from-literal=password=mypass
kubectl get secret my-secret -o yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__secret_password_password">&#x521B;&#x5EFA; Secret &#x5185;&#x5BB9;&#x4E3A; password&#xFF0C; password &#x4FDD;&#x5B58;&#x5728;&#x6587;&#x4EF6;&#x4E0A;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;myPassord&quot;</span> &gt; password
kubectl create secret generic my-secret --from-file=password
kubectl get secret my-secret -o yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__secret_etc_foo">&#x5C06; Secret &#x6302;&#x8F7D;&#x5230;&#x5BB9;&#x5668;&#xFF0C;&#x8DEF;&#x5F84;&#x4E3A; /etc/foo</h3>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; my-secret</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">echo <span class="hljs-string">&quot;This is a password&quot;</span> &gt; password
echo <span class="hljs-string">&quot;This is a username&quot;</span> &gt; username

kubectl create secret generic my-secret --from-file=username --from-file=password
kubectl get secret my-secret -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x90E8;&#x7F72;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./secret-volumes.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> secret-volumes
<span class="hljs-attr">  name:</span> secret-volumes
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> busybox
<span class="hljs-attr">    name:</span> secret-volumes
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;ls -l /etc/foo &amp;&amp; cat /etc/foo/username &amp;&amp; cat /etc/foo/password&quot;</span>]
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> secret-volume
<span class="hljs-attr">      mountPath:</span> /etc/foo
<span class="hljs-attr">      readOnly:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> secret-volume
<span class="hljs-attr">    secret:</span>
<span class="hljs-attr">      secretName:</span> my-secret
<span class="hljs-attr">  restartPolicy:</span> Never
EOF

// create
kubectl create -f secret-volumes.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x9A8C;&#x8BC1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-comment"># kubectl logs secret-volumes</span>
total <span class="hljs-number">0</span>
lrwxrwxrwx    <span class="hljs-number">1</span> root     root            <span class="hljs-number">15</span> Mar <span class="hljs-number">12</span> <span class="hljs-number">09</span>:<span class="hljs-number">09</span> password -&gt; ..data/password
lrwxrwxrwx    <span class="hljs-number">1</span> root     root            <span class="hljs-number">15</span> Mar <span class="hljs-number">12</span> <span class="hljs-number">09</span>:<span class="hljs-number">09</span> username -&gt; ..data/username
This is a username
This is a password</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__secret_my_secret_test_username_my_secret_test_password">&#x5C06; Secret &#x4EE5;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x7ED9;&#x5BB9;&#x5668;&#xFF0C;&#x53D8;&#x91CF;&#x540D;&#x4E3A; MY_SECRET_TEST_USERNAME &#x548C; MY_SECRET_TEST_PASSWORD</h3>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; my-secret</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">echo <span class="hljs-string">&quot;This is a password&quot;</span> &gt; password
echo <span class="hljs-string">&quot;This is a username&quot;</span> &gt; username

kubectl create secret generic my-secret --from-file=username --from-file=password
kubectl get secret my-secret -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x90E8;&#x7F72;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./secret-envs.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> secret-envs
<span class="hljs-attr">  name:</span> secret-envs
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> busybox
<span class="hljs-attr">    name:</span> secret-envs
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;env | grep MY_SECRET_TEST&quot;</span>]
<span class="hljs-attr">    env:</span>
<span class="hljs-attr">    - name:</span> MY_SECRET_TEST_USERNAME
<span class="hljs-attr">      valueFrom:</span>
<span class="hljs-attr">        secretKeyRef:</span>
<span class="hljs-attr">          name:</span> my-secret
<span class="hljs-attr">          key:</span> username
<span class="hljs-attr">    - name:</span> MY_SECRET_TEST_PASSWORD
<span class="hljs-attr">      valueFrom:</span>
<span class="hljs-attr">        secretKeyRef:</span>
<span class="hljs-attr">          name:</span> my-secret
<span class="hljs-attr">          key:</span> password
<span class="hljs-attr">  restartPolicy:</span> Never
EOF

// create
kubectl create -f secret-envs.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x9A8C;&#x8BC1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-comment"># kubectl logs secret-envs</span>
MY_SECRET_TEST_PASSWORD=This is a password
MY_SECRET_TEST_USERNAME=This is a username</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__serviceaccounts">&#x67E5;&#x770B;&#x96C6;&#x7FA4;&#x4E2D;&#x6240;&#x6709;&#x7684; ServiceAccounts</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get serviceaccount --all-namespaces
kubectl get serviceaccount default -o yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__serviceaccounts_myuser">&#x521B;&#x5EFA;&#x4E00;&#x4E2A; ServiceAccounts &#x540D;&#x4E3A; myuser</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create sa myuser</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pod_serviceaccounts">POD &#x4E2D;&#x4F7F;&#x7528; ServiceAccounts</h3>
<div class="paragraph">
<p>ServiceAccounts &#x53EF;&#x4EE5;&#x4F7F;&#x67D0;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5185;&#x8C03;&#x8FD0; Kubernetes API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./sa.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> serviceaccount-pod
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  serviceAccountName:</span> myuser
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> myapp
<span class="hljs-attr">    image:</span> busybox
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&apos;sh&apos;</span>, <span class="hljs-string">&apos;-c&apos;</span>, <span class="hljs-string">&quot;echo Hello, Kubernetes! &amp;&amp; sleep 3600&quot;</span>]
EOF

// create
kubectl create -f sa.yaml

// verify
kubectl get pod serviceaccount-pod  -o yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__candy_themed">&#x5BB9;&#x5668;&#x5316;&#x90E8;&#x7F72; candy-themed &#x6E38;&#x620F;</h3>
<div class="paragraph">
<p>&#x5BB9;&#x5668;&#x5316;&#x90E8;&#x7F72; candy-themed &#x6E38;&#x620F;&#x6EE1;&#x8DB3;&#x5982;&#x4E0B;&#x8981;&#x6C42;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x955C;&#x50CF; <code>linuxacademycontent/candy-service:1</code></p>
</li>
<li>
<p>candy-themed &#x6E38;&#x620F;&#x8FD0;&#x884C;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>/etc/candy-service/candy.cfg</code>&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x901A;&#x8FC7; ConfigMap &#x6302;&#x8F7D;&#x9053;&#x5BB9;&#x5668;&#xFF0C;ConfigMap &#x7684;&#x540D;&#x79F0;&#x4E3A; <code>candy-service-config</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">candy.peppermint.power=<span class="hljs-number">100000000</span>
candy.nougat-armor.strength=<span class="hljs-number">10</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>&#x5BB9;&#x5668;&#x9700;&#x8981;&#x4EE5; group ID 2000 &#x8FD0;&#x884C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x901A;&#x8FC7; securityContext &#x8BBE;&#x5B9A;</p>
</li>
<li>
<p>&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x9700;&#x8981; 64MiB &#x5185;&#x5B58;&#xFF0C;250m CPU</p>
</li>
<li>
<p>&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x6700;&#x5927;&#x5141;&#x8BB8;&#x7684;&#x5185;&#x5B58;&#x4E3A; 128MiB&#xFF0C;CPU &#x4E3A; 500m</p>
</li>
<li>
<p>&#x5BB9;&#x5668;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x540E;&#x53F0;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5BC6;&#x7801;&#x4E3A; <code>Kub3rn3t3sRul3s!</code>&#xFF0C;&#x5BC6;&#x7801;&#x9700;&#x8981;&#x4EE5; secret &#x7684;&#x65B9;&#x5F0F;&#x4FDD;&#x5B58;&#xFF0C;secret &#x7684;&#x540D;&#x79F0;&#x4E3A; <code>db-password</code>&#xFF0C;&#x901A;&#x8FC7; DB_PASSWORD &#x53D8;&#x91CF;&#x4F20;&#x9012;&#x5230;&#x5BB9;&#x5668;</p>
</li>
<li>
<p>&#x5BB9;&#x5668;&#x9700;&#x8981; ServiceAccount <code>candy-svc</code> &#x6765;&#x8BBF;&#x95EE; Kubernetes API</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; candy.cfg</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF &gt; ./candy.cfg
candy.peppermint.power=<span class="hljs-number">100000000</span>
candy.nougat-armor.strength=<span class="hljs-number">10</span>
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA; ConfigMap candy-service-config</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create configmap candy-service-config --from-file=candy.cfg</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x521B;&#x5EFA; Secret db-password</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create secret generic db-password --from-literal=password=Kub3rn3t3sRul3s!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x521B;&#x5EFA; ServiceAccount candy-svc</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create sa candy-svc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. candy.yaml</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF &gt; ./candy.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> candy
<span class="hljs-attr">  name:</span> candy
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  securityContext:</span>
<span class="hljs-attr">    fsGroup:</span> <span class="hljs-number">2000</span>
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> config-volume
<span class="hljs-attr">    configMap:</span>
<span class="hljs-attr">      name:</span> candy-service-config
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> linuxacademycontent/candy-service:<span class="hljs-number">1</span>
<span class="hljs-attr">    name:</span> candy
<span class="hljs-attr">    env:</span>
<span class="hljs-attr">    - name:</span> DB_PASSWORD
<span class="hljs-attr">      valueFrom:</span>
<span class="hljs-attr">        secretKeyRef:</span>
<span class="hljs-attr">          name:</span> db-password
<span class="hljs-attr">          key:</span> password
<span class="hljs-attr">    resources:</span>
<span class="hljs-attr">      limits:</span>
<span class="hljs-attr">        cpu:</span> <span class="hljs-number">500</span>m
<span class="hljs-attr">        memory:</span> <span class="hljs-number">128</span>Mi
<span class="hljs-attr">      requests:</span>
<span class="hljs-attr">        cpu:</span> <span class="hljs-number">250</span>m
<span class="hljs-attr">        memory:</span> <span class="hljs-number">64</span>Mi
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> config-volume
<span class="hljs-attr">      mountPath:</span> /etc/candy-service
<span class="hljs-attr">  dnsPolicy:</span> ClusterFirst
<span class="hljs-attr">  restartPolicy:</span> Always
<span class="hljs-attr">  serviceAccountName:</span> candy-svc
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. &#x521B;&#x5EFA; candy &#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create -f candy.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>7. &#x90E8;&#x7F72;&#x9A8C;&#x8BC1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl get pods

kubectl exec candy -- cat /etc/candy-service/candy.cfg

kubectl exec candy -- env | grep DB_PASSWORD

kubectl exec candy -- id

kubectl describe pod candy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>7. Clean up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl delete pod candy
kubectl delete cm candy-service-config
kubectl delete secret db-password
kubectl delete sa candy-svc</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multi_container_pods">Multi-Container Pods</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_multi_container">Multi-Container &#x4E09;&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;</h3>
<div class="paragraph">
<p>&#x4E00;&#x4E2A; Pod &#x4E2D;&#x7684;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#x5171;&#x4EAB;&#x7F51;&#x7EDC;</p>
</li>
<li>
<p>&#x5171;&#x4EAB;&#x5B58;&#x50A8;</p>
</li>
<li>
<p>&#x5171;&#x4EAB; Process Namespace</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&#x4E09;&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Sidecar</strong> - Sidecar &#x5BB9;&#x5668;&#x5BF9;&#x4E3B;&#x5BB9;&#x5668;&#x7684;&#x80FD;&#x529B;&#x548C;&#x901A;&#x8FC7;&#x7684;&#x65B9;&#x6CD5;&#x505A;&#x4E00;&#x8865;&#x5145;</p>
</li>
<li>
<p><strong>Ambassador</strong> - &#x7F51;&#x7EDC;&#x5165;&#x53E3;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF0C;&#x8FDB;&#x5165;&#x4E3B;&#x5BB9;&#x5668;&#x7684;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x4E0A;&#x9650;&#x8FDB;&#x5165; Ambassador &#x5BB9;&#x5668;</p>
</li>
<li>
<p><strong>Adapter</strong> - &#x5B9A;&#x5236;&#x4E3B;&#x5BB9;&#x5668;&#x7684;&#x8F93;&#x51FA;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_haproxy_ambassador_haproxy_svc">HAproxy Ambassador &#x6A21;&#x5F0F; - HAproxy &#x5BB9;&#x5668;&#x4F4D;&#x4E8E; SVC &#x5BB9;&#x5668;&#x4E4B;&#x524D;</h3>
<div class="paragraph">
<p>&#x9057;&#x7559;&#x4E0B;&#x6765;&#x7684; fruit-service &#x53EA;&#x80FD;&#x63D0;&#x4F9B; 8775 &#x7AEF;&#x53E3;&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x901A;&#x8FC7; 80 &#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#xFF0C;&#x672C;&#x90E8;&#x5206;&#x4F7F;&#x7528;&#x591A;&#x5BB9;&#x5668; Ambassador &#x6A21;&#x5F0F;&#xFF0C;HAproxy &#x5BB9;&#x5668;&#x4F4D;&#x4E8E; SVC &#x5BB9;&#x5668;&#x4E4B;&#x524D;&#xFF0C;&#x901A;&#x8FC7; 80 &#x7AEF;&#x53E3;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF0C;&#x6D41;&#x91CF;&#x7ECF; HAproxy &#x5BB9;&#x5668; 80 &#x7AEF;&#x53E3;&#x5230; fruit-service 8775 &#x7AEF;&#x53E3;&#xFF0C;&#x5177;&#x4F53;&#x8981;&#x6C42;&#x5982;&#x4E0B;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POD &#x540D;&#x79F0;&#x4E3A; fruit-service</p>
</li>
<li>
<p>POD &#x4E2D;&#x540D;&#x4E3A; fruit-service &#x7684;&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x955C;&#x50CF;&#x4E3A;&#xFF1A;linuxacademycontent/legacy-fruit-service:1</p>
</li>
<li>
<p>Ambassador HAproxy &#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x7684;&#x955C;&#x50CF;&#x4E3A; haproxy:1.7&#xFF0C;&#x4EE3;&#x7406;&#x5728;80 &#x7AEF;&#x53E3;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;&#x540E;&#x53F0; 8775&#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x7167;&#x5982;&#x4E0B; HAProxy &#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">global
    daemon
    maxconn <span class="hljs-number">256</span>

defaults
    mode http
    timeout connect <span class="hljs-number">5000</span>ms
    timeout client <span class="hljs-number">50000</span>ms
    timeout server <span class="hljs-number">50000</span>ms

listen http-in
    bind *:<span class="hljs-number">80</span>
    server server1 <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8775</span> maxconn <span class="hljs-number">32</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>HAProxy &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x9700;&#x8981;&#x901A;&#x8FC7; ConfigMap &#x4F20;&#x9012;&#xFF0C;HAProxy &#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84;&#x4E3A; /usr/local/etc/haproxy/haproxy.cfg</p>
</li>
<li>
<p>busybox POD&#x7528;&#x6765;&#x6D4B;&#x8BD5;&#xFF0C;yaml &#x6587;&#x4EF6;&#x5982;&#x4E0B;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> busybox
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> myapp-container
<span class="hljs-attr">    image:</span> radial/busyboxplus:curl
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&apos;sh&apos;</span>, <span class="hljs-string">&apos;-c&apos;</span>, <span class="hljs-string">&apos;while true; do sleep 3600; done&apos;</span>]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; HAProxy &#x914D;&#x7F6E;&#x6587;&#x4EF6;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF &gt; ./haproxy.cfg
global
    daemon
    maxconn <span class="hljs-number">256</span>

defaults
    mode http
    timeout connect <span class="hljs-number">5000</span>ms
    timeout client <span class="hljs-number">50000</span>ms
    timeout server <span class="hljs-number">50000</span>ms

listen http-in
    bind *:<span class="hljs-number">80</span>
    server server1 <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8775</span> maxconn <span class="hljs-number">32</span>
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA; ConfigMap &#x4FDD;&#x5B58; haproxy.cfg</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create configmap haproxy-cfg --from-file=haproxy.cfg</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. HAproxy Ambassador &#x6A21;&#x5F0F; POD YAML</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF &gt; ./service.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> fruit-service
<span class="hljs-attr">  name:</span> fruit-service
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> linuxacademycontent/legacy-fruit-service:<span class="hljs-number">1</span>
<span class="hljs-attr">    name:</span> fruit-service
<span class="hljs-attr">    resources:</span> {}
<span class="hljs-attr">  - name:</span> haproxy
<span class="hljs-attr">    image:</span> haproxy:<span class="hljs-number">1.7</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> cfg-volume
<span class="hljs-attr">      mountPath:</span> /usr/local/etc/haproxy
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> cfg-volume
<span class="hljs-attr">    configMap:</span>
<span class="hljs-attr">      name:</span> haproxy-cfg
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x521B;&#x5EFA; HAproxy Ambassador &#x6A21;&#x5F0F; POD</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create -f service.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x6D4B;&#x8BD5;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl run busybox --image=radial/busyboxplus:curl --generator=run-pod/v1 --command -- sh -c <span class="hljs-string">&quot;sleep 3600&quot;</span>
kubectl exec busybox -- curl http://$(kubectl get pod fruit-service -o=custom-columns=IP:.status.podIP --<span class="hljs-literal">no</span>-headers):<span class="hljs-number">80</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. Clean up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl delete all --all
kubectl delete cm haproxy-cfg</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fluentd_adapter_fluentd_svc">fluentd Adapter &#x6A21;&#x5F0F; - fluentd &#x6536;&#x96C6; SVC &#x5BB9;&#x5668;&#x65E5;&#x5FD7;</h3>
<div class="paragraph">
<p>&#x521B;&#x5EFA; fluentd Adapter &#x6A21;&#x5F0F;&#x5BB9;&#x5668;&#xFF0C;&#x5177;&#x4F53;&#x8981;&#x6C42;&#x5982;&#x4E0B;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#x5C06; POD &#x7684;&#x63CF;&#x8FF0;&#x4FDD;&#x5B58;&#x5230; adapter-pod.yml</p>
</li>
<li>
<p>POD &#x540D;&#x79F0; counter</p>
</li>
<li>
<p>&#x5BB9;&#x5668; count &#x4F7F;&#x7528; busybox &#x955C;&#x50CF;&#xFF0C;&#x63D0;&#x4F9B;&#x65E5;&#x5FD7;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x53C2;&#x6570;&#x4E3A;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-bullet">-</span> /bin/sh
<span class="hljs-bullet">-</span> -c
<span class="hljs-bullet">-</span> <span class="hljs-string">&gt;
  i=0;
  while true;
  do
    echo &quot;$i: $(date)&quot; &gt;&gt; /var/log/1.log;
    echo &quot;$(date) INFO $i&quot; &gt;&gt; /var/log/2.log;
    i=$((i+1));
    sleep 1;
  done</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>adapter &#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x955C;&#x50CF; k8s.gcr.io/fluentd-gcp:1.30&#xFF0C;&#x540D;&#x79F0;&#x4E5F;&#x4E3A; adapter</p>
</li>
<li>
<p>fluentd &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x540D;&#x4E3A; fluentd-config &#x7684; ConfigMap &#x52A0;&#x8F7D;&#xFF0C;ConfigMap &#x9700;&#x8981;&#x6302;&#x8F7D;&#x5230; adapter &#x5BB9;&#x5668;&#xFF0C;&#x6302;&#x8F7D;&#x7684;&#x8DEF;&#x5F84;&#x4E3A; /fluentd/etc/fluent.conf</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">&lt;source<span class="hljs-string">&gt;
  type tail
  format none
  path /var/log/1.log
  pos_file /var/log/1.log.pos
  tag count.format1
&lt;/source&gt;

&lt;source&gt;
  type tail
  format none
  path /var/log/2.log
  pos_file /var/log/2.log.pos
  tag count.format2
&lt;/source&gt;

&lt;match **&gt;
  @type file
  path /var/logout/count
  time_slice_format %Y%m%d%H%M%S
  flush_interval 5s
  log_level trace
&lt;/match&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>adapter &#x5BB9;&#x5668;&#x6DFB;&#x52A0;&#x73AF;&#x5883;&#x53D8;&#x91CF; FLUENTD_ARGS&#xFF0C;&#x8BE5;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x4E3A; &#x201C;-c /fluentd/etc/fluent.conf&#x201D;</p>
</li>
<li>
<p>&#x7ED9; POD &#x521B;&#x5EFA;&#x4E00;&#x4E2A; volume&#xFF0C;&#x4F7F; POD &#x9000;&#x51FA;&#x540E;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5C06; volume &#x6302;&#x8F7D;&#x5230;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x6302;&#x8F7D;&#x7684;&#x8DEF;&#x5F84;&#x90FD;&#x662F; /var/log&#xFF0C;&#x8FD9;&#x6837; count &#x5BB9;&#x5668;&#x5199;&#xFF0C;adapter &#x5BB9;&#x5668;&#x8BFB;</p>
</li>
<li>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; hostPath &#x7684; volume&#xFF0C;adapter &#x5C06;&#x6570;&#x636E;&#x8F93;&#x51FA;&#x5230; /tmp/count_output&#xFF0C;adapter &#x5BB9;&#x5668;&#x7684;&#x6302;&#x8F7D;&#x8DEF;&#x5F84;&#x4E3A; /var/logout</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; fluentd-config</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create configmap fluentd-config --from-file=fluent.conf

kubectl get cm fluentd-config -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x7F16;&#x8F91; adapter-pod.yaml</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> counter
<span class="hljs-attr">  name:</span> counter
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> busybox
<span class="hljs-attr">    name:</span> count
<span class="hljs-attr">    command:</span>
<span class="hljs-bullet">    -</span> /bin/sh
<span class="hljs-bullet">    -</span> -c
<span class="hljs-bullet">    -</span> <span class="hljs-string">&gt;
      i=0;
      while true;
      do
        echo &quot;$i: $(date)&quot; &gt;&gt; /var/log/1.log;
        echo &quot;$(date) INFO $i&quot; &gt;&gt; /var/log/2.log;
        i=$((i+1));
        sleep 1;
      done
</span><span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> share-volume
<span class="hljs-attr">      mountPath:</span> /var/log
<span class="hljs-attr">  - image:</span> k8s.gcr.io/fluentd-gcp:<span class="hljs-number">1.30</span>
<span class="hljs-attr">    name:</span> adapter
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> config-volume
<span class="hljs-attr">      mountPath:</span> /fluentd/etc
<span class="hljs-attr">    - name:</span> share-volume
<span class="hljs-attr">      mountPath:</span> /var/log
<span class="hljs-attr">    - name:</span> output-volume
<span class="hljs-attr">      mountPath:</span> /var/logout
<span class="hljs-attr">    env:</span>
<span class="hljs-attr">    - name:</span> FLUENTD_ARGS
<span class="hljs-attr">      value:</span> <span class="hljs-string">&quot;-c /fluentd/etc/fluent.conf&quot;</span>
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> config-volume
<span class="hljs-attr">    configMap:</span>
<span class="hljs-attr">      name:</span> fluentd-config
<span class="hljs-attr">  - name:</span> share-volume
<span class="hljs-attr">    emptyDir:</span> {}
<span class="hljs-attr">  - name:</span> output-volume
<span class="hljs-attr">    hostPath:</span>
<span class="hljs-attr">      path:</span> /tmp/count_output</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x521B;&#x5EFA;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create -f adapter-pod.yml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x9A8C;&#x8BC1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// make sure pod is running
kubectl get pods

// check count log
kubectl exec counter -c count -- cat /var/log/<span class="hljs-number">1.</span>log
kubectl exec counter -c count -- cat /var/log/<span class="hljs-number">2.</span>log

// check adapter log &amp; files
<span class="hljs-comment"># kubectl exec counter -c adapter -- cat /fluentd/etc/fluent.conf</span>
<span class="hljs-comment"># kubectl exec counter -c adapter -- ls /var/logout | wc -l</span>
<span class="hljs-number">65</span>
<span class="hljs-comment">#kubectl exec counter -c adapter -- cat /var/logout/count.20200311092543_0.log</span>
<span class="hljs-number">2020</span><span class="hljs-bullet">-03</span><span class="hljs-bullet">-11</span>T09:<span class="hljs-number">25</span>:<span class="hljs-number">43</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>	count.format1	{<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;89: Wed Mar 11 09:25:43 UTC 2020&quot;</span>}
<span class="hljs-number">2020</span><span class="hljs-bullet">-03</span><span class="hljs-bullet">-11</span>T09:<span class="hljs-number">25</span>:<span class="hljs-number">43</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>	count.format2	{<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;Wed Mar 11 09:25:43 UTC 2020 INFO 89&quot;</span>}

// check from host path
<span class="hljs-comment"># ssh $(kubectl get pod -o wide --no-headers | awk &apos;{print $7}&apos;)</span>
<span class="hljs-comment"># ls -l /tmp/count_output | wc -l</span>
<span class="hljs-number">82</span>
<span class="hljs-comment"># cat /tmp/count_output/count.20200311092918_0.log</span>
<span class="hljs-number">2020</span><span class="hljs-bullet">-03</span><span class="hljs-bullet">-11</span>T09:<span class="hljs-number">29</span>:<span class="hljs-number">18</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>	count.format2	{<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;Wed Mar 11 09:29:18 UTC 2020 INFO 132&quot;</span>}
<span class="hljs-number">2020</span><span class="hljs-bullet">-03</span><span class="hljs-bullet">-11</span>T09:<span class="hljs-number">29</span>:<span class="hljs-number">18</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>	count.format1	{<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;132: Wed Mar 11 09:29:18 UTC 2020&quot;</span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. Clean Up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl delete all --all
kubectl delete cm fluentd-config</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. &#x9A8C;&#x8BC1; hostpath &#x7684;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5220;&#x9664;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-comment"># ssh machine03 &apos;ls -l /tmp/count_output | wc -l&apos;</span>
<span class="hljs-number">127</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_observability">Observability</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__livenessprobe_echo_test_5_10">&#x521B;&#x5EFA; livenessProbe&#xFF0C;&#x6267;&#x884C; echo test &#x547D;&#x4EE4;&#xFF0C;&#x521D;&#x6B21;&#x5EF6;&#x8FDF;&#x4E3A; 5 &#x79D2;&#xFF0C;&#x5468;&#x671F;&#x4E3A; 10 &#x79D2;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// yaml
cat &lt;&lt;EOF &gt; ./liveness.yaml
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: liveness-pod
  name: liveness-pod
spec:
  containers:
  - image: busybox
    name: liveness-pod
    <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;sleep 3600&quot;</span>]
    livenessProbe:
      <span class="hljs-built_in">exec</span>:
        <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;echo&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>]
      initialDelaySeconds: 5
      periodSeconds: 10
EOF

// create
kubectl create <span class="hljs-_">-f</span> liveness.yaml

// verify
kubectl describe pod liveness-pod | grep Liveness</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__readinessprobe_http_get_80_5_10">&#x521B;&#x5EFA; readinessProbe&#xFF0C;&#x6267;&#x884C; HTTP GET&#xFF0C;&#x8DEF;&#x5F84; /&#xFF0C;&#x7AEF;&#x53E3; 80&#xFF0C;&#x521D;&#x6B21;&#x5EF6;&#x8FDF;&#x4E3A; 5 &#x79D2;&#xFF0C;&#x5468;&#x671F; 10 &#x79D2;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// yaml
cat &lt;&lt;EOF &gt; ./readness.yaml
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: readiness-pod
  name: readiness-pod
spec:
  containers:
  - image: nginx
    name: readiness-pod
    readinessProbe:
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 5
      periodSeconds: 10
EOF

// create
kubectl create <span class="hljs-_">-f</span> readness.yaml

// verify
kubectl describe pod readiness-pod | grep Readiness</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__busybox_pod_code_i_0_while_true_do_echo_i_date_i_i_1_sleep_1_done_code">&#x521B;&#x5EFA; busybox POD&#xFF0C;&#x6267;&#x884C; <code>i=0; while true; do echo &quot;$i: $(date)&quot;; i=$i+1; sleep 1; done</code>&#xFF0C;&#x67E5;&#x770B;&#x65E5;&#x5FD7;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run busybox --image=busybox --generator=run-pod/v1 --command -- sh -c <span class="hljs-string">&quot;i=0; while true; do echo &apos;<span class="hljs-variable">$i</span>: <span class="hljs-variable">$(date)</span>&apos;; i=<span class="hljs-variable">$((i+1)</span>); sleep 1; done&quot;</span>
kubectl logs <span class="hljs-_">-f</span> busybox</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__">&#x68C0;&#x6D4B;&#x5E94;&#x7528;&#x662F;&#x5426;&#x91CD;&#x542F;&#xFF0C;&#x4EE5;&#x53CA;&#x5E94;&#x7528;&#x662F;&#x5426;&#x5C31;&#x7EEA;</h3>
<div class="ulist">
<ul>
<li>
<p>&#x5BB9;&#x5668;&#x4E2D;&#x5E94;&#x7528;&#x901A;&#x5E38;&#x4F1A;&#x6709;&#x9519;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x5F02;&#x5E38;&#x8BEF;&#xFF0C;&#x4F46;&#x9519;&#x8BEF;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x6216; Crash&#xFF08;Kubernets &#x672C;&#x8EAB;&#x4E0D;&#x4F1A;&#x611F;&#x77E5;&#x5230;&#x5BB9;&#x5668;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#xFF09;&#xFF0C;&#x9700;&#x8981;&#x914D;&#x7F6E; livenessProbe &#x6765;&#x786E;&#x5B9A;&#x662F;&#x5426;&#x9700;&#x8981;&#x91CD;&#x542F;&#x5BB9;&#x5668;</p>
</li>
<li>
<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E00;&#x4E9B;&#x7528;&#x6237;&#x7684;&#x8BF7;&#x6C42;&#x4F1A;&#x65E0;&#x6CD5;&#x53CA;&#x65F6;&#x54CD;&#x5E94;&#xFF0C;&#x901A;&#x8FC7; readinessProbe &#x6765;&#x786E;&#x4FDD;&#x5BB9;&#x5668;&#x5C31;&#x7EEA;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>&#x793A;&#x4F8B;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">apiVersion: v1
kind: Pod
metadata:
  name: candy-service
spec:
  containers:
  - name: candy-service
    image: linuxacademycontent/candy-service:2
    livenessProbe:
      httpGet:
        path: /healthz
        port: 8081
    readinessProbe:
      httpGet:
        path: /
        port: 80</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__metrics_server">&#x5B89;&#x88C5; Metrics Server</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// install
git <span class="hljs-built_in">clone</span> https://github.com/kubernetes-sigs/metrics-server.git
kubectl apply <span class="hljs-_">-f</span> metrics-server/deploy/kubernetes/

// verify
kubectl get --raw /apis/metrics.k8s.io/
{<span class="hljs-string">&quot;kind&quot;</span>:<span class="hljs-string">&quot;APIGroup&quot;</span>,<span class="hljs-string">&quot;apiVersion&quot;</span>:<span class="hljs-string">&quot;v1&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;metrics.k8s.io&quot;</span>,<span class="hljs-string">&quot;versions&quot;</span>:[{<span class="hljs-string">&quot;groupVersion&quot;</span>:<span class="hljs-string">&quot;metrics.k8s.io/v1beta1&quot;</span>,<span class="hljs-string">&quot;version&quot;</span>:<span class="hljs-string">&quot;v1beta1&quot;</span>}],<span class="hljs-string">&quot;preferredVersion&quot;</span>:{<span class="hljs-string">&quot;groupVersion&quot;</span>:<span class="hljs-string">&quot;metrics.k8s.io/v1beta1&quot;</span>,<span class="hljs-string">&quot;version&quot;</span>:<span class="hljs-string">&quot;v1beta1&quot;</span>}}

// <span class="hljs-built_in">export</span>
kubectl get pod &lt;POD_NAME&gt; -o yaml --export &gt; nginx-pod.yml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="___2">&#x5E38;&#x89C1;&#x5E94;&#x7528;&#x76D1;&#x63A7;&#x573A;&#x666F;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl top pods
kubectl top pod resource-consumer-big
kubectl top pods -n kube-system
kubectl top nodes</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__troubleshooting">&#x57FA;&#x672C; Troubleshooting &#x6B65;&#x9AA4;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// 1. describe
kubectl describe &lt;POD_NAME&gt;

// 2. logs
kubectl logs &lt;OBJECT_NAME&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pod_design">Pod Design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__labels_selectors">&#x5E38;&#x89C1; Labels, Selectors &#x64CD;&#x4F5C;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get pods <span class="hljs-_">-l</span> app=my-app

kubectl get pods <span class="hljs-_">-l</span> environment=production

kubectl get pods <span class="hljs-_">-l</span> environment=development

kubectl get pods <span class="hljs-_">-l</span> environment!=production

kubectl get pods <span class="hljs-_">-l</span> <span class="hljs-string">&apos;environment in (development,production)&apos;</span>

kubectl get pods <span class="hljs-_">-l</span> app=my-app,environment=production</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pod_label_app_v1">&#x521B;&#x5EFA;&#x4E09;&#x4E2A; POD &#xFF0C;Label &#x90FD;&#x5305;&#x542B; app=v1</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> 1 2 3 ; <span class="hljs-keyword">do</span> kubectl run nginx-<span class="hljs-variable">$i</span> --image=nginx --port=80 --labels=app=v1 --generator=run-pod/v1 ; <span class="hljs-keyword">done</span>

kubectl get pods <span class="hljs-_">-l</span> app=v1

kubectl delete all <span class="hljs-_">-l</span> app=v1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pod_label">&#x67E5;&#x770B;&#x5E76;&#x4FEE;&#x6539; POD &#x7684; Label</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get pods --show-labels
kubectl label pod nginx-1 app=v2 --overwrite</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_annotation_git_commits">Annotation &#x8BB0;&#x5F55;&#x5E94;&#x7528;&#x7684;&#x6240;&#x6709;&#x8005;&#x548C; git commits</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> my-annotation-pod
<span class="hljs-attr">  annotations:</span>
<span class="hljs-attr">    owner:</span> terry@linuxacademy.com
<span class="hljs-attr">    git-commit:</span> bdab0c6
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> nginx
<span class="hljs-attr">    image:</span> nginx</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pod_description_my_description_annotation">&#x7ED9;&#x8FD0;&#x884C;&#x7684; POD &#x6DFB;&#x52A0;&quot;description=&apos;my description&apos;&quot; &#x7684; Annotation</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl annotate pod nginx-1 description=<span class="hljs-string">&apos;my description&apos;</span>
kubectl describe pod nginx-1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pod_annotation">&#x5220;&#x9664;&#x8FD0;&#x884C; POD &#x7684; Annotation</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl annotate pod nginx-1 description-</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__deployments">&#x5E38;&#x89C1; Deployments &#x64CD;&#x4F5C;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl <span class="hljs-built_in">set</span> image deployment/rolling-deployment nginx=nginx:1.7.9 --record

kubectl rollout <span class="hljs-built_in">history</span> deployment/rolling-deployment

kubectl rollout <span class="hljs-built_in">history</span> deployment/rolling-deployment --revision=2

kubectl rollout undo deployment/rolling-deployment</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="___3">&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#xFF0C;&#x7248;&#x672C;&#x56DE;&#x6EDA;</h3>
<div class="listingblock">
<div class="title"><strong>1. &#x90E8;&#x7F72; nginx</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./deployment-nginx.yaml
<span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> nginx
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx
<span class="hljs-attr">  strategy:</span> {}
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - image:</span> nginx:<span class="hljs-number">1.7</span><span class="hljs-number">.8</span>
<span class="hljs-attr">        name:</span> nginx
EOF

// create
kubectl create -f deployment-nginx.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x5347;&#x7EA7;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl set image deployments/nginx nginx=nginx:<span class="hljs-number">1.7</span><span class="hljs-number">.9</span>  --record</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x67E5;&#x770B;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x72B6;&#x6001;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl rollout status deployments/nginx</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x67E5;&#x770B;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x5386;&#x53F2;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl rollout history deployments/nginx</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x56DE;&#x6EDA;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl rollout undo deployments/nginx</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__statefulset_nginx_pod_3">&#x90E8;&#x7F72; StatefulSet&#xFF0C; &#x4F7F;&#x7528; nginx &#x955C;&#x50CF;&#xFF0C;POD &#x526F;&#x672C;&#x6570;&#x4E3A; 3</h3>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; PersistentVolume</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./my-storage.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolume
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> statefulsets-volume
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  capacity:</span>
<span class="hljs-attr">    storage:</span> <span class="hljs-number">1</span>Gi
<span class="hljs-attr">  volumeMode:</span> Filesystem
<span class="hljs-attr">  accessModes:</span>
<span class="hljs-bullet">    -</span> ReadWriteOnce
<span class="hljs-attr">  persistentVolumeReclaimPolicy:</span> Recycle
<span class="hljs-attr">  storageClassName:</span> my-storage-class
<span class="hljs-attr">  hostPath:</span>
<span class="hljs-attr">    path:</span> /tmp/statefulsets
EOF

// create
kubectl create -f my-storage.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA; Headless Service</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./my-headless-svc.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> nginx
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> nginx
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    name:</span> web
<span class="hljs-attr">  clusterIP:</span> None
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> nginx
EOF

// create
kubectl create -f my-headless-svc.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x521B;&#x5EFA; StatefulSet</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./my-statefulset.yaml
<span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> StatefulSet
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> web
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> nginx <span class="hljs-comment"># has to match .spec.template.metadata.labels</span>
<span class="hljs-attr">  serviceName:</span> <span class="hljs-string">&quot;nginx&quot;</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nginx <span class="hljs-comment"># has to match .spec.selector.matchLabels</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      terminationGracePeriodSeconds:</span> <span class="hljs-number">10</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> nginx
<span class="hljs-attr">        image:</span> k8s.gcr.io/nginx-slim:<span class="hljs-number">0.8</span>
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">          name:</span> web
<span class="hljs-attr">        volumeMounts:</span>
<span class="hljs-attr">        - name:</span> www
<span class="hljs-attr">          mountPath:</span> /usr/share/nginx/html
<span class="hljs-attr">  volumeClaimTemplates:</span>
<span class="hljs-attr">  - metadata:</span>
<span class="hljs-attr">      name:</span> www
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      accessModes:</span> [ <span class="hljs-string">&quot;ReadWriteOnce&quot;</span> ]
<span class="hljs-attr">      storageClassName:</span> <span class="hljs-string">&quot;my-storage-class&quot;</span>
<span class="hljs-attr">      resources:</span>
<span class="hljs-attr">        requests:</span>
<span class="hljs-attr">          storage:</span> <span class="hljs-number">1</span>Gi
EOF

// create
kubectl create -f my-statefulset.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jobs_cronjobs">Jobs &#x548C; CronJobs &#x6BD4;&#x8F83;</h3>
<div class="paragraph">
<p>Job &#x548C; CronJob &#x90FD;&#x4F1A;&#x521B;&#x5EFA; POD &#x53BB;&#x5B8C;&#x6210;&#x540E;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Job &#x7C7B;&#x4F3C; Pod&#xFF0C;&#x4F46;&#x662F;&#x505A;&#x5B8C;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x540E;&#x9000;&#x51FA;</p>
</li>
<li>
<p>CronJob &#x7C7B;&#x4F3C; Job, &#x4F46;&#x5468;&#x671F;&#x6027;&#x505A;&#x540C;&#x4E00;&#x4EF6;&#x4E8B;&#x4EF6;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="__job_2000">&#x521B;&#x5EFA; Job &#x8BA1;&#x7B97; &#x3C0; &#x540E; 2000 &#x4F4D;&#x8F93;&#x51FA;&#x5230;&#x65E5;&#x5FD7;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// yaml
cat &lt;&lt;EOF &gt; ./pi.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: pi
spec:
  template:
    spec:
      containers:
      - name: pi
        image: perl
        <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;perl&quot;</span>,  <span class="hljs-string">&quot;-Mbignum=bpi&quot;</span>, <span class="hljs-string">&quot;-wle&quot;</span>, <span class="hljs-string">&quot;print bpi(2000)&quot;</span>]
      restartPolicy: Never
  backoffLimit: 4
EOF

// create
kubectl create <span class="hljs-_">-f</span> pi.yaml

// verify
kubectl logs pi-r7kxf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__job_20_5">&#x521B;&#x5EFA; Job &#x8BA1;&#x7B97; &#x3C0; &#x540E; 20 &#x4F4D;&#x8F93;&#x51FA;&#x5230;&#x65E5;&#x5FD7;&#xFF0C;&#x5E76;&#x8F93;&#x51FA; 5 &#x6B21;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// yaml
cat &lt;&lt;EOF &gt; ./pi-completions.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: pi-completions
spec:
  completions: 5
  template:
    spec:
      containers:
      - name: pi
        image: perl
        <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;perl&quot;</span>,  <span class="hljs-string">&quot;-Mbignum=bpi&quot;</span>, <span class="hljs-string">&quot;-wle&quot;</span>, <span class="hljs-string">&quot;print bpi(20)&quot;</span>]
      restartPolicy: Never
  backoffLimit: 4
EOF

// create
kubectl create <span class="hljs-_">-f</span> pi-completions.yaml

// verify
<span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> $(kubectl get pods --no-headers | awk <span class="hljs-string">&apos;{print $1}&apos;</span>) ; <span class="hljs-keyword">do</span> kubectl logs <span class="hljs-variable">$p</span> ; <span class="hljs-keyword">done</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__job_20_5_2">&#x521B;&#x5EFA; Job &#x8BA1;&#x7B97; &#x3C0; &#x540E; 20 &#x4F4D;&#x8F93;&#x51FA;&#x5230;&#x65E5;&#x5FD7;&#xFF0C;&#x5E76;&#x5E76;&#x884C;&#x8F93;&#x51FA; 5 &#x6B21;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// yaml
cat &lt;&lt;EOF &gt; ./pi-parallelism.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: pi-parallelism
spec:
  parallelism: 5
  template:
    spec:
      containers:
      - name: pi
        image: perl
        <span class="hljs-built_in">command</span>: [<span class="hljs-string">&quot;perl&quot;</span>,  <span class="hljs-string">&quot;-Mbignum=bpi&quot;</span>, <span class="hljs-string">&quot;-wle&quot;</span>, <span class="hljs-string">&quot;print bpi(20)&quot;</span>]
      restartPolicy: Never
  backoffLimit: 4
EOF

// create
kubectl create <span class="hljs-_">-f</span> pi-parallelism.yaml

// verify
<span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> $(kubectl get pods --no-headers | awk <span class="hljs-string">&apos;{print $1}&apos;</span>) ; <span class="hljs-keyword">do</span> kubectl logs <span class="hljs-variable">$p</span> ; <span class="hljs-keyword">done</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__job_busybox_echo_sleep">&#x521B;&#x5EFA; Job &#x8FD0;&#x884C; busybox &#x6267;&#x884C; echo, sleep &#x547D;&#x4EE4;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create job busybox --image=busybox -- /bin/sh -c <span class="hljs-string">&apos;echo hello;sleep 30;echo world&apos;</span>
kubectl logs <span class="hljs-_">-f</span> busybox<span class="hljs-_">-f</span>9bbz
kubectl logs job/busybox</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__cronjob">&#x521B;&#x5EFA; CronJob &#x6BCF;&#x9694;&#x4E00;&#x5206;&#x949F;&#x8F93;&#x51FA;&#x65F6;&#x95F4;&#x53CA;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">// yaml
cat &lt;&lt;EOF &gt; ./hello-cronjob.yaml
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: hello
spec:
  schedule: <span class="hljs-string">&quot;*/1 * * * *&quot;</span>
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            args:
            - /bin/sh
            - -c
            - date; <span class="hljs-built_in">echo</span> Hello from the Kubernetes cluster
          restartPolicy: OnFailure
EOF

// create
kubectl create <span class="hljs-_">-f</span> hello-cronjob.yaml

// verify
kubectl get pods -w</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pizza">pizza &#x670D;&#x52A1;&#x90E8;&#x7F72;</h3>
<div class="paragraph">
<p>&#x90E8;&#x7F72; pizza &#x670D;&#x52A1;&#xFF0C;&#x6EE1;&#x8DB3;&#x5982;&#x4E0B;&#x6761;&#x4EF6;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x4E0B; pizza namespace &#x4E0B;</p>
</li>
<li>
<p>Deployment &#x5BF9;&#x8C61;&#x540D;&#x79F0;&#x4E3A;pizza-deployment</p>
</li>
<li>
<p>Deployment &#x5BF9;&#x8C61;&#x6709; 3 &#x4E2A;&#x526F;&#x672C;</p>
</li>
<li>
<p>&#x90E8;&#x7F72;&#x5BB9;&#x5668;&#x7684;&#x955C;&#x50CF;&#x4E3A; linuxacademycontent/pizza-service:1.14.6</p>
</li>
<li>
<p>&#x5BB9;&#x5668;&#x901A;&#x8FC7; nginx &#x547D;&#x4EE4;&#x8FD0;&#x884C;</p>
</li>
<li>
<p>&#x5BB9;&#x5668;&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x6709; &quot;-g&quot;, &quot;daemon off;&quot;</p>
</li>
<li>
<p>POD &#x5BF9;&#x5916;&#x66B4;&#x9732;&#x7684;&#x7AEF;&#x53E3;&#x662F; 80</p>
</li>
<li>
<p>POD &#x901A;&#x8FC7;&#x8DEF;&#x5F84; /healthz &#x548C;&#x7AEF;&#x53E3; 8081 &#x68C0;&#x6D4B;&#x662F;&#x5426;&#x9700;&#x8981;&#x81EA;&#x52A8;&#x91CD;&#x542F;</p>
</li>
<li>
<p>POD &#x901A;&#x8FC7;&#x8DEF;&#x5F84; / &#x548C;&#x7AEF;&#x53E3; 80 &#x68C0;&#x6D4B;&#x670D;&#x52A1;&#x662F;&#x5426;&#x5728;&#x7EBF;</p>
</li>
<li>
<p>&#x670D;&#x52A1;&#x540D;&#x79F0;&#x4E3A; pizza-service</p>
</li>
<li>
<p>&#x670D;&#x52A1;&#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230; 80 &#x7AEF;&#x53E3;&#x7684; POD</p>
</li>
<li>
<p>&#x670D;&#x52A1;&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x7684;&#x7AEF;&#x53E3;&#x4E3A; 30080</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; namespace</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create ns pizza</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA; Deployment</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./deployment.yaml
<span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> pizza-deployment
<span class="hljs-attr">  name:</span> pizza-deployment
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> pizza-deployment
<span class="hljs-attr">  strategy:</span> {}
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> pizza-deployment
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - image:</span> linuxacademycontent/pizza-service:<span class="hljs-number">1.14</span><span class="hljs-number">.6</span>
<span class="hljs-attr">        name:</span> pizza-service
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">        command:</span> [<span class="hljs-string">&quot;nginx&quot;</span>]
<span class="hljs-attr">        args:</span> [<span class="hljs-string">&quot;-g&quot;</span>, <span class="hljs-string">&quot;daemon off;&quot;</span>]
<span class="hljs-attr">        livenessProbe:</span>
<span class="hljs-attr">          httpGet:</span>
<span class="hljs-attr">            path:</span> /healthz
<span class="hljs-attr">            port:</span> <span class="hljs-number">8081</span>
<span class="hljs-attr">        readinessProbe:</span>
<span class="hljs-attr">          httpGet:</span>
<span class="hljs-attr">            path:</span> /
<span class="hljs-attr">            port:</span> <span class="hljs-number">80</span>
EOF

// create
kubectl create -f deployment.yaml -n pizza</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x521B;&#x5EFA;&#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./pizza-service.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> pizza-deployment
<span class="hljs-attr">  name:</span> pizza-deployment
<span class="hljs-attr">  namespace:</span> pizza
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - nodePort:</span> <span class="hljs-number">30080</span>
<span class="hljs-attr">    port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    protocol:</span> TCP
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> pizza-deployment
<span class="hljs-attr">  type:</span> NodePort
EOF

// create svc
kubectl create -f pizza-service.yaml -n pizza</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x9A8C;&#x8BC1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl get svc -n pizza
kubectl get ep -n pizza
kubectl get po -n pizza</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. Clean up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl delete all --all -n pizza
kubectl delete ns pizza</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_services_and_networking">Services and Networking</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__nginx_pod_80">&#x57FA;&#x4E8E; nginx &#x955C;&#x50CF;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; POD&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x66B4;&#x9732;&#x5728; 80 &#x7AEF;&#x53E3;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl run nginx --image=nginx --port=<span class="hljs-number">80</span> --generator=run-pod/v1
kubectl expose pod nginx --port=<span class="hljs-number">80</span> --name=nginx

kubectl get svc
kubectl get ep

kubectl run busybox --image=busybox --rm -it --generator=run-pod/v1 --command -- sh wget <span class="hljs-bullet">-0</span>- <span class="hljs-number">192.168</span><span class="hljs-number">.208</span><span class="hljs-number">.216</span>:<span class="hljs-number">80</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__nginx_deployment_80">&#x57FA;&#x4E8E; nginx &#x955C;&#x50CF;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Deployment&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x66B4;&#x9732;&#x5728; 80 &#x7AEF;&#x53E3;</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create deployment nginx --image=nginx
kubectl scale deployments/nginx --replicas=<span class="hljs-number">3</span>
kubectl expose deployments/nginx --port=<span class="hljs-number">80</span> --name=nginx --type=NodePort</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nginx">Nginx &#x8BBF;&#x95EE;&#x7B56;&#x7565;&#x5B9A;&#x5236;</h3>
<div class="paragraph">
<p>&#x5B9A;&#x5236;&#x8BBF;&#x95EE;&#x7B56;&#x7565;&#xFF0C;&#x786E;&#x4FDD; Nginx &#x5BB9;&#x5668;&#x63D0;&#x4F9B;&#x7684;&#x670D;&#x52A1;&#x53EA;&#x88AB;&#x7279;&#x5B9A;&#x6807;&#x7B7E;&#x7684;&#x5BB9;&#x5668;&#x8BBF;&#x95EE;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nginx Pod &#x63D0;&#x4F9B; /hello &#x670D;&#x52A1;&#xFF0C;&#x4F9B;&#x540C;&#x4E00; namespace &#x5185;&#x7684;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x8BBF;&#x95EE;</p>
</li>
<li>
<p>Nginx &#x53EA;&#x5141;&#x8BB8; allow-access: &quot;true&quot; &#x6807;&#x7B7E;&#x7684;&#x5BB9;&#x5668;&#x8BBF;&#x95EE;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x90E8;&#x7F72; nginx service</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./hello.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> hello
<span class="hljs-attr">  name:</span> hello
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> nginx
<span class="hljs-attr">    name:</span> hello
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> svc-root
<span class="hljs-attr">      mountPath:</span> <span class="hljs-string">&quot;/usr/share/nginx/html&quot;</span>
<span class="hljs-attr">    livenessProbe:</span>
<span class="hljs-attr">      exec:</span>
<span class="hljs-attr">        command:</span> [<span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;-e&quot;</span>, <span class="hljs-string">&quot;/usr/share/nginx/html/hello&quot;</span>]
<span class="hljs-attr">  initContainers:</span>
<span class="hljs-attr">  - image:</span> busybox:<span class="hljs-number">1.28</span>
<span class="hljs-attr">    name:</span> init-svc
<span class="hljs-attr">    command:</span> [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo &apos;hello&apos; &gt; /usr/share/nginx/html/hello&quot;</span>]
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> svc-root
<span class="hljs-attr">      mountPath:</span> <span class="hljs-string">&quot;/usr/share/nginx/html&quot;</span>
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> svc-root
<span class="hljs-attr">    emptyDir:</span> {}
<span class="hljs-attr">  restartPolicy:</span> Always
EOF

// create service
kubectl create -f hello.yaml

// verify
<span class="hljs-comment"># kubectl exec hello -- cat /usr/share/nginx/html/hello</span>
hello</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA; Client &#x670D;&#x52A1;&#xFF0C;&#x8BBF;&#x95EE; hello</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl run client --image=radial/busyboxplus:curl --generator=run-pod/v1 --command -- sh -c <span class="hljs-string">&quot;sleep 3600&quot;</span>

// Access service
<span class="hljs-comment"># kubectl exec client -- curl http://$(kubectl get pod hello -o wide --no-headers | awk &apos;{print $6}&apos;)/hello</span>
hello</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x8BBE;&#x5B9A;&#x8BBF;&#x95EE;&#x7B56;&#x7565;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./policy.yaml
<span class="hljs-attr">apiVersion:</span> networking.k8s.io/v1
<span class="hljs-attr">kind:</span> NetworkPolicy
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> my-network-policy
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  podSelector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      run:</span> hello
<span class="hljs-attr">  policyTypes:</span>
<span class="hljs-bullet">  -</span> Ingress
<span class="hljs-bullet">  -</span> Egress
<span class="hljs-attr">  ingress:</span>
<span class="hljs-attr">  - from:</span>
<span class="hljs-attr">    - podSelector:</span>
<span class="hljs-attr">        matchLabels:</span>
<span class="hljs-attr">          allow-access:</span> <span class="hljs-string">&quot;true&quot;</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - protocol:</span> TCP
<span class="hljs-attr">      port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  egress:</span>
<span class="hljs-attr">  - to:</span>
<span class="hljs-attr">    - podSelector:</span>
<span class="hljs-attr">        matchLabels:</span>
<span class="hljs-attr">          allow-access:</span> <span class="hljs-string">&quot;true&quot;</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - protocol:</span> TCP
<span class="hljs-attr">      port:</span> <span class="hljs-number">80</span>
EOF

// create
kubectl create -f policy.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x8BBE;&#x5B9A;&#x8BBF;&#x95EE;&#x7B56;&#x7565;&#x540E;&#x91CD;&#x65B0;&#x8BBF;&#x95EE; hello &#x670D;&#x52A1;&#xFF08;&#x670D;&#x52A1;&#x4E0D;&#x5141;&#x8BB8;&#x88AB;&#x8BBF;&#x95EE;&#xFF09;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl exec client -- curl http://$(kubectl get pod hello -o wide --<span class="hljs-literal">no</span>-headers | awk <span class="hljs-string">&apos;{print $6}&apos;</span>)/hello</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x7ED9; Client &#x670D;&#x52A1;&#x8BBE;&#x5B9A;&#x6807;&#x7B7E;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x8BBF;&#x95EE;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl run client --image=radial/busyboxplus:curl --generator=run-pod/v1 --labels=<span class="hljs-string">&apos;allow-access=true&apos;</span> --command -- sh -c <span class="hljs-string">&quot;sleep 3600&quot;</span>

// Access hello service again
<span class="hljs-comment"># kubectl exec client -- curl http://$(kubectl get pod hello -o wide --no-headers | awk &apos;{print $6}&apos;)/hello</span>
hello</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. Clean up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl delete pod hello client
kubectl delete networkpolicy my-network-policy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="___4">&#x7F51;&#x5173;&#x57FA;&#x4E8E;&#x4E0D;&#x540C;&#x7B56;&#x7565;&#x8BBF;&#x95EE;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;</h3>
<div class="paragraph">
<p>&#x672C;&#x90E8;&#x5206;&#x6709; 2 &#x4E2A;&#x670D;&#x52A1;&#x548C;&#x4E00;&#x4E2A;&#x7F51;&#x5173;&#xFF0C;2 &#x4E2A;&#x670D;&#x52A1;&#x6709;&#x5BF9;&#x5E94;&#x8BBF;&#x95EE;&#x7B56;&#x7565;&#xFF0C;&#x7F51;&#x5173;&#x4F4D;&#x4E8E; 2 &#x4E2A;&#x670D;&#x52A1;&#x4E4B;&#x524D;</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">&#x5BF9;&#x8C61;</th>
<th class="tableblock halign-left valign-top">yaml</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">customer-data</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> customer-data
<span class="hljs-attr">  name:</span> customer-data
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> customer-data
<span class="hljs-attr">  strategy:</span> {}
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> customer-data
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - image:</span> nginx
<span class="hljs-attr">        name:</span> nginx</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inventory</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> inventory
<span class="hljs-attr">  name:</span> inventory
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> inventory
<span class="hljs-attr">  strategy:</span> {}
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> inventory
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - image:</span> nginx
<span class="hljs-attr">        name:</span> nginx</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">customer-data-policy</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> networking.k8s.io/v1
<span class="hljs-attr">kind:</span> NetworkPolicy
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> customer-data-policy
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  podSelector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> customer-data
<span class="hljs-attr">  policyTypes:</span>
<span class="hljs-bullet">  -</span> Ingress
<span class="hljs-bullet">  -</span> Egress
<span class="hljs-attr">  ingress:</span>
<span class="hljs-attr">  - from:</span>
<span class="hljs-attr">    - podSelector:</span>
<span class="hljs-attr">        matchLabels:</span>
<span class="hljs-attr">          allow-access-customer-data:</span> <span class="hljs-string">&quot;true&quot;</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - protocol:</span> TCP
<span class="hljs-attr">      port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  egress:</span>
<span class="hljs-attr">  - to:</span>
<span class="hljs-attr">    - podSelector:</span>
<span class="hljs-attr">        matchLabels:</span>
<span class="hljs-attr">          allow-access-customer-data:</span> <span class="hljs-string">&quot;true&quot;</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - protocol:</span> TCP
<span class="hljs-attr">      port:</span> <span class="hljs-number">80</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inventory-policy</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> networking.k8s.io/v1
<span class="hljs-attr">kind:</span> NetworkPolicy
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> inventory-policy
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  podSelector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> inventory
<span class="hljs-attr">  policyTypes:</span>
<span class="hljs-bullet">  -</span> Ingress
<span class="hljs-bullet">  -</span> Egress
<span class="hljs-attr">  ingress:</span>
<span class="hljs-attr">  - from:</span>
<span class="hljs-attr">    - podSelector:</span>
<span class="hljs-attr">        matchLabels:</span>
<span class="hljs-attr">          allow-access-inventory:</span> <span class="hljs-string">&quot;true&quot;</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - protocol:</span> TCP
<span class="hljs-attr">      port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  egress:</span>
<span class="hljs-attr">  - to:</span>
<span class="hljs-attr">    - podSelector:</span>
<span class="hljs-attr">        matchLabels:</span>
<span class="hljs-attr">          allow-access-inventory:</span> <span class="hljs-string">&quot;true&quot;</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - protocol:</span> TCP
<span class="hljs-attr">      port:</span> <span class="hljs-number">80</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-gateway</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    run:</span> web-gateway
<span class="hljs-attr">  name:</span> web-gateway
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - command:</span>
<span class="hljs-bullet">    -</span> sh
<span class="hljs-bullet">    -</span> -c
<span class="hljs-bullet">    -</span> sleep <span class="hljs-number">3600</span>
<span class="hljs-bullet">    -</span> --dry-run
<span class="hljs-bullet">    -</span> -o
<span class="hljs-bullet">    -</span> yaml
<span class="hljs-attr">    image:</span> radial/busyboxplus:curl
<span class="hljs-attr">    name:</span> web-gateway</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title"><strong>1. &#x521D;&#x59CB;&#x5316;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create -f customer-data.yaml
kubectl create -f inventory.yaml
kubectl create -f customer-data-policy.yaml
kubectl create -f inventory-policy.yaml
kubectl create -f web-gateway.yaml
kubectl expose deployments/customer-data --port=<span class="hljs-number">80</span> --name=customer-data-svc
kubectl expose deployments/inventory --port=<span class="hljs-number">80</span> --name=inventory-svc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x8BBF;&#x95EE;&#x6D4B;&#x8BD5;&#xFF08;&#x8BBF;&#x95EE;&#x4E0D;&#x901A;&#xFF09;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl exec web-gateway -- curl -m <span class="hljs-number">3</span> customer-data-svc
kubectl exec web-gateway -- curl -m <span class="hljs-number">3</span> inventory-svc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x8BBE;&#x5B9A;&#x89C4;&#x5219;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl label pod web-gateway allow-access-customer-data=<span class="hljs-literal">true</span>
kubectl label pod web-gateway allow-access-inventory=<span class="hljs-literal">true</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x518D;&#x6B21;&#x8BBF;&#x95EE;&#x6D4B;&#x8BD5;&#xFF0C;&#x8BBF;&#x95EE;&#x6210;&#x529F;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl exec web-gateway -- curl -m <span class="hljs-number">3</span> customer-data-svc
kubectl exec web-gateway -- curl -m <span class="hljs-number">3</span> inventory-svc</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_state_persistence">State Persistence</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_redis">Redis &#x6301;&#x4E45;&#x5316;</h3>
<div class="listingblock">
<div class="title"><strong>1. Create a PersistentVolume</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./redis-pv.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolume
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> redis-pv
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  storageClassName:</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  capacity:</span>
<span class="hljs-attr">    storage:</span> <span class="hljs-number">1</span>Gi
<span class="hljs-attr">  accessModes:</span>
<span class="hljs-bullet">    -</span> ReadWriteOnce
<span class="hljs-attr">  hostPath:</span>
<span class="hljs-attr">    path:</span> <span class="hljs-string">&quot;/tmp/data&quot;</span>
EOF

// create
kubectl create -f redis-pv.yaml

// view
<span class="hljs-comment"># kubectl get pv --no-headers</span>
redis-pv   <span class="hljs-number">1</span>Gi   RWO   Retain   Available                     <span class="hljs-number">5</span>m53s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. Create a PersistentVolumeClaim</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./redis-pvc.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> PersistentVolumeClaim
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> redisdb-pvc
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  storageClassName:</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  accessModes:</span>
<span class="hljs-bullet">    -</span> ReadWriteOnce
<span class="hljs-attr">  resources:</span>
<span class="hljs-attr">    requests:</span>
<span class="hljs-attr">      storage:</span> <span class="hljs-number">1</span>Gi
EOF

// create
kubectl create -f redis-pvc.yaml

// view
<span class="hljs-comment"># kubectl get pv --no-headers</span>
redis-pv   <span class="hljs-number">1</span>Gi   RWO   Retain   Bound   default/redisdb-pvc               <span class="hljs-number">6</span>m40s

<span class="hljs-comment"># kubectl get pvc --no-headers</span>
redisdb-pvc   Bound   redis-pv   <span class="hljs-number">1</span>Gi   RWO         <span class="hljs-number">34</span>s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. Create the redispod image, with a mounted volume to mount path /data</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// yaml
cat &lt;&lt;EOF &gt; ./redispod.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> redispod
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - image:</span> redis
<span class="hljs-attr">    name:</span> redisdb
<span class="hljs-attr">    volumeMounts:</span>
<span class="hljs-attr">    - name:</span> redis-data
<span class="hljs-attr">      mountPath:</span> /data
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - containerPort:</span> <span class="hljs-number">6379</span>
<span class="hljs-attr">      protocol:</span> TCP
<span class="hljs-attr">  volumes:</span>
<span class="hljs-attr">  - name:</span> redis-data
<span class="hljs-attr">    persistentVolumeClaim:</span>
<span class="hljs-attr">      claimName:</span> redisdb-pvc
EOF

// create pod
kubectl create -f redispod.yaml

// view pod
<span class="hljs-comment"># kubectl get pod redispod -o wide --no-headers</span>
redispod   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>   Running   <span class="hljs-number">0</span>     <span class="hljs-number">3</span>m31s   <span class="hljs-number">192.168</span><span class="hljs-number">.208</span><span class="hljs-number">.248</span>   machine03.example.com   &lt;none&gt;   &lt;none<span class="hljs-string">&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. Connect to the container and write some data</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl exec -it redispod redis-cli
<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; SET server:name <span class="hljs-string">&quot;redis server&quot;</span>
OK
<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; GET server:name
<span class="hljs-string">&quot;redis server&quot;</span>
<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; QUIT</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. Delete pod and check persist files</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// delete pod
kubectl delete pod redispod

// check persist files
<span class="hljs-comment"># ssh machine03.example.com &quot;ls /tmp/data&quot;</span>
dump.rdb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. Create pod again</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">// create
kubectl create -f redispod.yaml

// get pod
<span class="hljs-comment"># kubectl get pod redispod -o wide --no-headers</span>
redispod   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>   Running   <span class="hljs-number">0</span>     <span class="hljs-number">62</span>s   <span class="hljs-number">192.168</span><span class="hljs-number">.208</span><span class="hljs-number">.253</span>   machine03.example.com   &lt;none&gt;   &lt;none<span class="hljs-string">&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>7. Verify data existing</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl exec -it redispod redis-cli
<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; GET server:name
<span class="hljs-string">&quot;redis server&quot;</span>
<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; QUIT</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mysql">Mysql &#x6301;&#x4E45;&#x5316;</h3>
<div class="listingblock">
<div class="title"><strong>Mysql PV</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">apiVersion: v1
kind: PersistentVolume
metadata:
  name: mysql-pv
spec:
  storageClassName: localdisk
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: <span class="hljs-string">&quot;/mnt/data&quot;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>Mysql PVC</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pv-claim
spec:
  storageClassName: localdisk
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 500Mi</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>Mysql Pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: mysql-pod
  name: mysql-pod
spec:
  containers:
  - image: mysql:5.6
    name: mysql-pod
    ports:
    - containerPort: 3306
    env:
    - name: MYSQL_ROOT_PASSWORD
      value: password
    volumeMounts:
    - name: mysql-storage
      mountPath: <span class="hljs-string">&quot;/var/lib/mysql&quot;</span>
    resources: {}
  volumes:
  - name: mysql-storage
    persistentVolumeClaim:
      claimName: mysql-pv-claim</code></pre>
</div>
</div>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="net.html" class="navigation navigation-prev " aria-label="Previous page: 网络">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="admin.html" class="navigation navigation-next " aria-label="Next page: 管理">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"开发","level":"1.5.4","depth":2,"next":{"title":"管理","level":"1.5.5","depth":2,"path":"k8s/admin.adoc","ref":"k8s/admin.adoc","articles":[]},"previous":{"title":"网络","level":"1.5.3","depth":2,"path":"k8s/net.adoc","ref":"k8s/net.adoc","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"GUID":"na39","OCP_USER_ID":"ksoong-redhat.com","copyrightYear":"2018","copyrightHolder":"Kylin Soong"},"plugins":["collapsible-menu","donate","-sharing","sharing-plus","splitter","back-to-top-button","edit-link"],"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy Kylin Soong 2018","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"collapsible-menu":{},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"donate":{"alipay":"http://ksoong.org/docs/content/images/alipay.png","alipayText":"支付宝捐赠","button":"赞赏","title":"","wechat":"http://ksoong.org/docs/content/images/wechat.png","wechatText":"微信捐赠"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"sharing":{"weibo":true,"linkedin":true,"google":true,"facebook":true,"all":["facebook","google","linkedin","weibo"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/kylinsoong/docs/blob/gh-pages"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"k8s/dev.adoc","mtime":"2020-03-14T04:32:41.658Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2020-05-05T10:39:16.380Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

