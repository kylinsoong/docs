
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>高级部署 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="devops.html" />
    
    
    <link rel="prev" href="install/qa.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    INTRODUCTION
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../linux/">
            
                <a href="../linux/">
            
                    
                    INFRA
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../linux/rhel/readme.html">
            
                <a href="../linux/rhel/readme.html">
            
                    
                    安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../linux/rhel/pre-install.html">
            
                <a href="../linux/rhel/pre-install.html">
            
                    
                    安装 DVD 制作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../linux/rhel/install-img-usb.html">
            
                <a href="../linux/rhel/install-img-usb.html">
            
                    
                    生成 USB 介质
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../linux/rhel/install.html">
            
                <a href="../linux/rhel/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../linux/rhel/kvm.html">
            
                <a href="../linux/rhel/kvm.html">
            
                    
                    KVM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../linux/basic/basic.html">
            
                <a href="../linux/basic/basic.html">
            
                    
                    基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../linux/basic/local-remote-login.html">
            
                <a href="../linux/basic/local-remote-login.html">
            
                    
                    本地及远程登录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../linux/basic/user-group.html">
            
                <a href="../linux/basic/user-group.html">
            
                    
                    用户和组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../linux/basic/packages-update.html">
            
                <a href="../linux/basic/packages-update.html">
            
                    
                    软件包的安装与更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../linux/basic/syslog.html">
            
                <a href="../linux/basic/syslog.html">
            
                    
                    系统日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../linux/basic/ntp.html">
            
                <a href="../linux/basic/ntp.html">
            
                    
                    NTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../linux/basic/ex.html">
            
                <a href="../linux/basic/ex.html">
            
                    
                    QA
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../linux/networking/">
            
                <a href="../linux/networking/">
            
                    
                    网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../linux/networking/fundamentals.html">
            
                <a href="../linux/networking/fundamentals.html">
            
                    
                    网络基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../linux/networking/ifcfg.html">
            
                <a href="../linux/networking/ifcfg.html">
            
                    
                    网络配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../linux/networking/ipv6cfg.html">
            
                <a href="../linux/networking/ipv6cfg.html">
            
                    
                    IPv6 网络配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../linux/networking/netns.html">
            
                <a href="../linux/networking/netns.html">
            
                    
                    namespace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../linux/networking/teaming.html">
            
                <a href="../linux/networking/teaming.html">
            
                    
                    teaming
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.6" data-path="../linux/networking/bridge.html">
            
                <a href="../linux/networking/bridge.html">
            
                    
                    bridge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.7" data-path="../linux/networking/dns.html">
            
                <a href="../linux/networking/dns.html">
            
                    
                    DNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.8" data-path="../linux/networking/monitor.html">
            
                <a href="../linux/networking/monitor.html">
            
                    
                    网络监控
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../linux/fs.html">
            
                <a href="../linux/fs.html">
            
                    
                    文件系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../linux/stoarges/readme.html">
            
                <a href="../linux/stoarges/readme.html">
            
                    
                    存储
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../linux/stoarges/lvm.html">
            
                <a href="../linux/stoarges/lvm.html">
            
                    
                    LVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../linux/stoarges/nfs.html">
            
                <a href="../linux/stoarges/nfs.html">
            
                    
                    NFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../linux/stoarges/file-storage.html">
            
                <a href="../linux/stoarges/file-storage.html">
            
                    
                    文件存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" data-path="../linux/stoarges/block-storage.html">
            
                <a href="../linux/stoarges/block-storage.html">
            
                    
                    块存储
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../linux/security/">
            
                <a href="../linux/security/">
            
                    
                    安全
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../linux/security/file-permissions.html">
            
                <a href="../linux/security/file-permissions.html">
            
                    
                    文件权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.2" data-path="../linux/security/SELinux.html">
            
                <a href="../linux/security/SELinux.html">
            
                    
                    SELinux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.3" data-path="../linux/security/firewall.html">
            
                <a href="../linux/security/firewall.html">
            
                    
                    防火墙
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.4" data-path="../linux/security/openssl.html">
            
                <a href="../linux/security/openssl.html">
            
                    
                    OpenSSL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../linux/process/">
            
                <a href="../linux/process/">
            
                    
                    进程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.7.1" data-path="../linux/process/management.html">
            
                <a href="../linux/process/management.html">
            
                    
                    进程管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.2" data-path="../linux/process/service.html">
            
                <a href="../linux/process/service.html">
            
                    
                    服务管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.3" data-path="../linux/process/schedule.html">
            
                <a href="../linux/process/schedule.html">
            
                    
                    周期性运行进程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.4" data-path="../linux/process/bash.html">
            
                <a href="../linux/process/bash.html">
            
                    
                    bash
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../linux/svc/">
            
                <a href="../linux/svc/">
            
                    
                    常用服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.8.1" data-path="../linux/svc/openssh.html">
            
                <a href="../linux/svc/openssh.html">
            
                    
                    OpenSSH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.2" data-path="../linux/svc/postfix.html">
            
                <a href="../linux/svc/postfix.html">
            
                    
                    Email
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.3" data-path="../linux/svc/mariadb.html">
            
                <a href="../linux/svc/mariadb.html">
            
                    
                    MariaDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.4" data-path="../linux/svc/httpd.html">
            
                <a href="../linux/svc/httpd.html">
            
                    
                    HTTPD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.5" data-path="../linux/svc/zabbix.html">
            
                <a href="../linux/svc/zabbix.html">
            
                    
                    Zabbix
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../linux/perf/">
            
                <a href="../linux/perf/">
            
                    
                    性能调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../docker/docker.html">
            
                <a href="../docker/docker.html">
            
                    
                    DOCKER
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../docker/svc/svc.html">
            
                <a href="../docker/svc/svc.html">
            
                    
                    容器化服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../docker/svc/mysql.html">
            
                <a href="../docker/svc/mysql.html">
            
                    
                    mysql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../docker/svc/httpd.html">
            
                <a href="../docker/svc/httpd.html">
            
                    
                    httpd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../docker/container.html">
            
                <a href="../docker/container.html">
            
                    
                    容器管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../docker/images.html">
            
                <a href="../docker/images.html">
            
                    
                    容器镜像
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="openshift.html">
            
                <a href="openshift.html">
            
                    
                    OPENSHIFT
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="concepts/">
            
                <a href="concepts/">
            
                    
                    概念
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="install/">
            
                <a href="install/">
            
                    
                    安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="install/yum.html">
            
                <a href="install/yum.html">
            
                    
                    本地 yum 源配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="install/docker-dist.html">
            
                <a href="install/docker-dist.html">
            
                    
                    本地 docker 镜像仓库配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="install/dns.html">
            
                <a href="install/dns.html">
            
                    
                    DNS 服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="install/pre-install.html">
            
                <a href="install/pre-install.html">
            
                    
                    前续安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.5" data-path="install/install.html">
            
                <a href="install/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.6" data-path="install/post-install.html">
            
                <a href="install/post-install.html">
            
                    
                    后续安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.7" data-path="install/add-nodes.html">
            
                <a href="install/add-nodes.html">
            
                    
                    节点扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.8" data-path="install/qa.html">
            
                <a href="install/qa.html">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.4.3" data-path="advanced-deployment.html">
            
                <a href="advanced-deployment.html">
            
                    
                    高级部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="devops.html">
            
                <a href="devops.html">
            
                    
                    DEVOPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="secure.html">
            
                <a href="secure.html">
            
                    
                    安全
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="samples/samples.html">
            
                <a href="samples/samples.html">
            
                    
                    示例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.6.1" data-path="samples/rc.html">
            
                <a href="samples/rc.html">
            
                    
                    RC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.2" data-path="samples/dc.html">
            
                <a href="samples/dc.html">
            
                    
                    DC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.3" data-path="samples/s2i.html">
            
                <a href="samples/s2i.html">
            
                    
                    S2I
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.4" data-path="samples/configmap.html">
            
                <a href="samples/configmap.html">
            
                    
                    ConfigMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.5" data-path="samples/elastic-spark.html">
            
                <a href="samples/elastic-spark.html">
            
                    
                    elasticsearch and spark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.6" data-path="samples/vdb-data-svc.html">
            
                <a href="samples/vdb-data-svc.html">
            
                    
                    Teiid Data Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="labs/">
            
                <a href="labs/">
            
                    
                    LABS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.1" data-path="labs/sdn.html">
            
                <a href="labs/sdn.html">
            
                    
                    Software-Defined Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.2" data-path="labs/edge-route.html">
            
                <a href="labs/edge-route.html">
            
                    
                    Route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.3" data-path="labs/web-console.html">
            
                <a href="labs/web-console.html">
            
                    
                    Web Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4" data-path="labs/projects-accounts.html">
            
                <a href="labs/projects-accounts.html">
            
                    
                    项目用户安全管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.5" data-path="labs/secure-secrets.html">
            
                <a href="labs/secure-secrets.html">
            
                    
                    数据库连接信息保护
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.6" data-path="labs/db-persist.html">
            
                <a href="labs/db-persist.html">
            
                    
                    持久化数据库存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.7" data-path="labs/wordpress.html">
            
                <a href="labs/wordpress.html">
            
                    
                    部署 wordpress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.8" data-path="labs/scaling.html">
            
                <a href="labs/scaling.html">
            
                    
                    扩展应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.9" data-path="labs/hpa.html">
            
                <a href="labs/hpa.html">
            
                    
                    弹性扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.10" data-path="labs/010.html">
            
                <a href="labs/010.html">
            
                    
                    Blue-Green Deployments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.11" data-path="labs/011.html">
            
                <a href="labs/011.html">
            
                    
                    SCM Web Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.12" data-path="labs/012.html">
            
                <a href="labs/012.html">
            
                    
                    Rollback Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.13" data-path="labs/deploy-an-operator.html">
            
                <a href="labs/deploy-an-operator.html">
            
                    
                    Operator 部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.14" data-path="labs/014.html">
            
                <a href="labs/014.html">
            
                    
                    JBoss Developer Studio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.15" data-path="labs/015.html">
            
                <a href="labs/015.html">
            
                    
                    Deploy a SpringBoot Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="case.html">
            
                <a href="case.html">
            
                    
                    用例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../ansible/">
            
                <a href="../ansible/">
            
                    
                    ANSIBLE
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../ansible/basic-usage.html">
            
                <a href="../ansible/basic-usage.html">
            
                    
                    基本使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../jboss/readme.html">
            
                <a href="../jboss/readme.html">
            
                    
                    APPDEV
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../jboss/api/readme.html">
            
                <a href="../jboss/api/readme.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../jboss/mesh.html">
            
                <a href="../jboss/mesh.html">
            
                    
                    Mesh
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../jboss/faas/openwhisk.html">
            
                <a href="../jboss/faas/openwhisk.html">
            
                    
                    Serverless
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../jboss/coolstore/">
            
                <a href="../jboss/coolstore/">
            
                    
                    CoolStore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../jboss/rhte18/redhat-msa.html">
            
                <a href="../jboss/rhte18/redhat-msa.html">
            
                    
                    微服务及红帽产品集成实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" >
            
                <a target="_blank" href="http://ksoong.org/drools-examples/content/">
            
                    
                    规则引擎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../jboss/datavirt/datavirt.html">
            
                <a href="../jboss/datavirt/datavirt.html">
            
                    
                    数据虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.7.1" data-path="../jboss/datavirt/software-list.html">
            
                <a href="../jboss/datavirt/software-list.html">
            
                    
                    软件版本号对照表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.2" data-path="../jboss/datavirt/changelog.html">
            
                <a href="../jboss/datavirt/changelog.html">
            
                    
                    修订记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.3" data-path="../jboss/datavirt/download.html">
            
                <a href="../jboss/datavirt/download.html">
            
                    
                    下载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.4" data-path="../jboss/datavirt/install.html">
            
                <a href="../jboss/datavirt/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.5" data-path="../jboss/datavirt/start.html">
            
                <a href="../jboss/datavirt/start.html">
            
                    
                    启动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.6" data-path="../jboss/datavirt/deploy-vdbs.html">
            
                <a href="../jboss/datavirt/deploy-vdbs.html">
            
                    
                    部署测试 VDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.7" data-path="../jboss/datavirt/meta.html">
            
                <a href="../jboss/datavirt/meta.html">
            
                    
                    元数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.8" data-path="../jboss/datavirt/jbds-jdv.html">
            
                <a href="../jboss/datavirt/jbds-jdv.html">
            
                    
                    JBDS 创建虚拟数据库操作示例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../jboss/amq/amq.html">
            
                <a href="../jboss/amq/amq.html">
            
                    
                    A-MQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.8.1" data-path="../jboss/amq/streams.html">
            
                <a href="../jboss/amq/streams.html">
            
                    
                    AMQ Streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.2" data-path="../jboss/amq/install.html">
            
                <a href="../jboss/amq/install.html">
            
                    
                    AMQ 6.3 安装测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.9" >
            
                <a target="_blank" href="http://ksoong.org/agile-integration/">
            
                    
                    敏捷集成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../jboss/bpm/bpm.html">
            
                <a href="../jboss/bpm/bpm.html">
            
                    
                    BPM
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.10.1" data-path="../jboss/bpm/install.html">
            
                <a href="../jboss/bpm/install.html">
            
                    
                    安装测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../jboss/secure/">
            
                <a href="../jboss/secure/">
            
                    
                    安全
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <a target="_blank" href="https://mongocn.github.io">
            
                    
                    DATA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../solutions/">
            
                <a href="../solutions/">
            
                    
                    SOLUTIONS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../solutions/abc-distribute-arch.html">
            
                <a href="../solutions/abc-distribute-arch.html">
            
                    
                    核心银行系统分布式架构转型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../about/">
            
                <a href="../about/">
            
                    
                    BUSINESS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../about/it-professions.html">
            
                <a href="../about/it-professions.html">
            
                    
                    PROFESSIONS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../about/softskills.html">
            
                <a href="../about/softskills.html">
            
                    
                    SKILLS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >高级部署</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="openshift-&#x9AD8;&#x7EA7;&#x90E8;&#x7F72;">OPENSHIFT &#x9AD8;&#x7EA7;&#x90E8;&#x7F72;</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#__">&#x9AD8;&#x53EF;&#x7528;&#x90E8;&#x7F72;</a>
<ul class="sectlevel2">
<li><a href="#___2">&#x9AD8;&#x53EF;&#x7528;&#x67B6;&#x6784;</a></li>
<li><a href="#___3">&#x73AF;&#x5883;&#x51C6;&#x5907;</a></li>
<li><a href="#___4">&#x5B89;&#x88C5;</a></li>
<li><a href="#___5">&#x5378;&#x8F7D;</a></li>
<li><a href="#___6">&#x9AD8;&#x53EF;&#x7528;&#x5B89;&#x88C5;&#x9A8C;&#x8BC1;</a></li>
<li><a href="#__pv">&#x521B;&#x5EFA; PV</a></li>
<li><a href="#___7">&#x5192;&#x70DF;&#x6D4B;&#x8BD5;</a></li>
</ul>
</li>
<li><a href="#___8">&#x7F51;&#x7EDC;</a>
<ul class="sectlevel2">
<li><a href="#___9">&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x7F51;&#x7EDC;</a></li>
<li><a href="#___10">&#x5185;&#x7F6E;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x548C;&#x5185;&#x90E8;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li>
<li><a href="#_ovs_multitenant">OVS Multitenant</a></li>
<li><a href="#_ovs_networkpolicy">OVS Networkpolicy</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="__">&#x9AD8;&#x53EF;&#x7528;&#x90E8;&#x7F72;</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="___2">&#x9AD8;&#x53EF;&#x7528;&#x67B6;&#x6784;</h3>
<div class="paragraph">
<p><span class="image"><img src="img/ocp-ha-arch.jpg" alt="ocp ha arch.jpg"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x53EF;&#x4EE5;&#x7528;&#x4EFB;&#x4F55;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x65B9;&#x6848;</p>
</li>
<li>
<p>&#x591A;&#x4E2A; Master &#x8282;&#x70B9;&#xFF0C;&#x591A;&#x4E2A; etcd &#x8282;&#x70B9;&#xFF0C;&#x591A;&#x4E2A;&#x8BA1;&#x7B97;&#x8282;&#x70B9;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="___3">&#x73AF;&#x5883;&#x51C6;&#x5907;</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">&#x7C7B;&#x578B;</th>
<th class="tableblock halign-left valign-top">&#x4E3B;&#x673A;&#x540D;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bastion.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support (NFS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">support1.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LoadBalancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadbalancer.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">master1.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">master2.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">master3.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">infranode1.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">infranode2.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node1.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node2.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node3.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipa.example.com</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title"><strong>1. &#x67E5;&#x770B;&#x8282;&#x70B9; hostname</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># for i in loadbalancer1 master1 master2 master3 infranode1 infranode2 node1 node2 node3 support1 ; do ssh ec2-user@$i.${GUID}.internal &apos;hostname&apos; ; done
loadbalancer1.fc84.internal
master1.fc84.internal
master2.fc84.internal
master3.fc84.internal
infranode1.fc84.internal
infranode2.fc84.internal
node1.fc84.internal
node2.fc84.internal
node3.fc84.internal
support1.fc84.internal</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x67E5;&#x770B;&#x5404;&#x8282;&#x70B9;&#x7684;&#x5185;&#x5B58;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># for i in loadbalancer1 master1 master2 master3 infranode1 infranode2 node1 node2 node3 support1 ; do ssh ec2-user@$i.${GUID}.internal &apos;hostname; cat /proc/meminfo | grep MemTotal&apos; ; done
loadbalancer1.fc84.internal  -  MemTotal:        1882064 kB
master1.fc84.                -  MemTotal:        8009180 kB
master2.fc84.                -  MemTotal:        8009180 kB
master3.fc84.                -  MemTotal:        8009180 kB
infranode1.fc84.             -  MemTotal:       16266720 kB
infranode2.fc84.             -  MemTotal:       16266720 kB
node1.fc84.                  -  MemTotal:        8009180 kB
node2.fc84.                  -  MemTotal:        8009180 kB
node3.fc84.                  -  MemTotal:        8009180 kB
support1.fc84.               -  MemTotal:        3880412 kB</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x67E5;&#x770B;&#x5404;&#x8282;&#x70B9; CPU</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># for i in loadbalancer1 master1 master2 master3 infranode1 infranode2 node1 node2 node3 support1 ; do ssh ec2-user@$i.${GUID}.internal &apos;hostname; grep -c ^processor /proc/cpuinfo&apos; ; done
loadbalancer1.fc84.  -  1
master1.fc84.        -  2
master2.fc84.        -  2
master3.fc84.        -  2
infranode1.fc84.     -  4
infranode2.fc84.     -  4
node1.fc84.          -  2
node2.fc84.          -  2
node3.fc84.          -  2
support1.fc84.       -  2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x67E5;&#x770B;&#x8282;&#x70B9; IP &#x5730;&#x5740;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># for i in loadbalancer1 master1 master2 master3 infranode1 infranode2 node1 node2 node3 support1 ; do host $i.${GUID}.internal ; done
loadbalancer1.fc84.internal has address 192.199.0.164
      master1.fc84.internal has address 192.199.0.76
      master2.fc84.internal has address 192.199.0.56
      master3.fc84.internal has address 192.199.0.210
   infranode1.fc84.internal has address 192.199.0.22
   infranode2.fc84.internal has address 192.199.0.119
        node1.fc84.internal has address 192.199.0.14
        node2.fc84.internal has address 192.199.0.229
        node3.fc84.internal has address 192.199.0.20
     support1.fc84.internal has address 192.199.0.117</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. Wildcard DNS &#x67E5;&#x8BE2;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># dig anyname.apps.${GUID}.example.opentlc.com +short
3.0.247.187
3.1.106.59</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. Master DNS &#x67E5;&#x8BE2;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># dig master{1,2,3}.${GUID}.internal +short
192.199.0.76
192.199.0.56
192.199.0.210</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>7. node &#x548C; infra DNS &#x67E5;&#x8BE2;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># dig {infra,}node{1,2,3}.${GUID}.internal +short
192.199.0.22
192.199.0.119
192.199.0.14
192.199.0.229
192.199.0.20</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>8. &#x67E5;&#x770B; master, node yum &#x914D;&#x7F6E;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible masters,nodes -m shell -a&quot;yum repolist&quot;
 [WARNING]: Consider using yum module rather than running yum

infranode1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
Loaded plugins: amazon-id, rhui-lb, search-disabled-repos, versionlock
repo id                        repo name                                  status
!rhel-7-fast-datapath-rpms     Red Hat Enterprise Linux 7 Fast Datapath      16
!rhel-7-server-extras-rpms     Red Hat Enterprise Linux 7 Extras            102
!rhel-7-server-optional-rpms   Red Hat Enterprise Linux 7 Optional        4,848
!rhel-7-server-ose-3.7-rpms    Red Hat Enterprise Linux 7 OSE 3.7           522
!rhel-7-server-rh-common-rpms  Red Hat Enterprise Linux 7 Common             82
!rhel-7-server-rpms            Red Hat Enterprise Linux 7                 5,163
repolist: 10,733

master1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
Loaded plugins: amazon-id, rhui-lb, search-disabled-repos, versionlock
repo id                        repo name                                  status
!rhel-7-fast-datapath-rpms     Red Hat Enterprise Linux 7 Fast Datapath      16
!rhel-7-server-extras-rpms     Red Hat Enterprise Linux 7 Extras            102
!rhel-7-server-optional-rpms   Red Hat Enterprise Linux 7 Optional        4,848
!rhel-7-server-ose-3.7-rpms    Red Hat Enterprise Linux 7 OSE 3.7           522
!rhel-7-server-rh-common-rpms  Red Hat Enterprise Linux 7 Common             82
!rhel-7-server-rpms            Red Hat Enterprise Linux 7                 5,163
repolist: 10,733

master2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
Loaded plugins: amazon-id, rhui-lb, search-disabled-repos, versionlock
repo id                        repo name                                  status
!rhel-7-fast-datapath-rpms     Red Hat Enterprise Linux 7 Fast Datapath      16
!rhel-7-server-extras-rpms     Red Hat Enterprise Linux 7 Extras            102
!rhel-7-server-optional-rpms   Red Hat Enterprise Linux 7 Optional        4,848
!rhel-7-server-ose-3.7-rpms    Red Hat Enterprise Linux 7 OSE 3.7           522
!rhel-7-server-rh-common-rpms  Red Hat Enterprise Linux 7 Common             82
!rhel-7-server-rpms            Red Hat Enterprise Linux 7                 5,163
repolist: 10,733

infranode2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
Loaded plugins: amazon-id, rhui-lb, search-disabled-repos, versionlock
repo id                        repo name                                  status
!rhel-7-fast-datapath-rpms     Red Hat Enterprise Linux 7 Fast Datapath      16
!rhel-7-server-extras-rpms     Red Hat Enterprise Linux 7 Extras            102
!rhel-7-server-optional-rpms   Red Hat Enterprise Linux 7 Optional        4,848
!rhel-7-server-ose-3.7-rpms    Red Hat Enterprise Linux 7 OSE 3.7           522
!rhel-7-server-rh-common-rpms  Red Hat Enterprise Linux 7 Common             82
!rhel-7-server-rpms            Red Hat Enterprise Linux 7                 5,163
repolist: 10,733

master3.fc84.internal | SUCCESS | rc=0 &gt;&gt;
Loaded plugins: amazon-id, rhui-lb, search-disabled-repos, versionlock
repo id                        repo name                                  status
!rhel-7-fast-datapath-rpms     Red Hat Enterprise Linux 7 Fast Datapath      16
!rhel-7-server-extras-rpms     Red Hat Enterprise Linux 7 Extras            102
!rhel-7-server-optional-rpms   Red Hat Enterprise Linux 7 Optional        4,848
!rhel-7-server-ose-3.7-rpms    Red Hat Enterprise Linux 7 OSE 3.7           522
!rhel-7-server-rh-common-rpms  Red Hat Enterprise Linux 7 Common             82
!rhel-7-server-rpms            Red Hat Enterprise Linux 7                 5,163
repolist: 10,733

node1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
Loaded plugins: amazon-id, rhui-lb, search-disabled-repos, versionlock
repo id                        repo name                                  status
!rhel-7-fast-datapath-rpms     Red Hat Enterprise Linux 7 Fast Datapath      16
!rhel-7-server-extras-rpms     Red Hat Enterprise Linux 7 Extras            102
!rhel-7-server-optional-rpms   Red Hat Enterprise Linux 7 Optional        4,848
!rhel-7-server-ose-3.7-rpms    Red Hat Enterprise Linux 7 OSE 3.7           522
!rhel-7-server-rh-common-rpms  Red Hat Enterprise Linux 7 Common             82
!rhel-7-server-rpms            Red Hat Enterprise Linux 7                 5,163
repolist: 10,733

node3.fc84.internal | SUCCESS | rc=0 &gt;&gt;
Loaded plugins: amazon-id, rhui-lb, search-disabled-repos, versionlock
repo id                        repo name                                  status
!rhel-7-fast-datapath-rpms     Red Hat Enterprise Linux 7 Fast Datapath      16
!rhel-7-server-extras-rpms     Red Hat Enterprise Linux 7 Extras            102
!rhel-7-server-optional-rpms   Red Hat Enterprise Linux 7 Optional        4,848
!rhel-7-server-ose-3.7-rpms    Red Hat Enterprise Linux 7 OSE 3.7           522
!rhel-7-server-rh-common-rpms  Red Hat Enterprise Linux 7 Common             82
!rhel-7-server-rpms            Red Hat Enterprise Linux 7                 5,163
repolist: 10,733

node2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
Loaded plugins: amazon-id, rhui-lb, search-disabled-repos, versionlock
repo id                        repo name                                  status
!rhel-7-fast-datapath-rpms     Red Hat Enterprise Linux 7 Fast Datapath      16
!rhel-7-server-extras-rpms     Red Hat Enterprise Linux 7 Extras            102
!rhel-7-server-optional-rpms   Red Hat Enterprise Linux 7 Optional        4,848
!rhel-7-server-ose-3.7-rpms    Red Hat Enterprise Linux 7 OSE 3.7           522
!rhel-7-server-rh-common-rpms  Red Hat Enterprise Linux 7 Common             82
!rhel-7-server-rpms            Red Hat Enterprise Linux 7                 5,163
repolist: 10,733</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>9. &#x67E5;&#x770B; NFS &#x5171;&#x4EAB;&#x5377;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible nfs -m shell -a &quot;exportfs&quot;
support1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
/srv/nfs      	&lt;world&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>10. &#x67E5;&#x770B;&#x8282;&#x70B9; docker &#x72B6;&#x6001;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible nodes -m shell -a &quot;systemctl is-active docker&quot;
master1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
active

master2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
active

master3.fc84.internal | SUCCESS | rc=0 &gt;&gt;
active

infranode1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
active

infranode2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
active

node1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
active

node3.fc84.internal | SUCCESS | rc=0 &gt;&gt;
active

node2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
active</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>11. &#x67E5;&#x770B;&#x8282;&#x70B9; docker &#x662F;&#x5426; enable</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible nodes -m shell -a &quot;systemctl is-enabled docker&quot;
master3.fc84.internal | SUCCESS | rc=0 &gt;&gt;
enabled

infranode2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
enabled

master2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
enabled

infranode1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
enabled

master1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
enabled

node1.fc84.internal | SUCCESS | rc=0 &gt;&gt;
enabled

node2.fc84.internal | SUCCESS | rc=0 &gt;&gt;
enabled

node3.fc84.internal | SUCCESS | rc=0 &gt;&gt;
enabled</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="___4">&#x5B89;&#x88C5;</h3>
<div class="paragraph">
<p>&#x62F7;&#x8D1D; <a href="install/hosts/hosts-3.10.45">hosts-3.10.45</a> &#x5185;&#x5BB9;&#x5230;&#x7BA1;&#x7406;&#x8282;&#x70B9; bastion &#x7684; /etc/ansible/hosts &#x6587;&#x4EF6;&#x3002;</p>
</div>
<div class="listingblock">
<div class="title"><strong>&#x524D;&#x9700;&#x5B89;&#x88C5;&#x9A8C;&#x8BC1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/prerequisites.yml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>&#x5B89;&#x88C5;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="___5">&#x5378;&#x8F7D;</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
&#x672C;&#x90E8;&#x5206;&#x53EA;&#x6709;&#x5728;&#x9700;&#x8981;&#x5378;&#x8F7D; OpenShift &#x73AF;&#x5883;&#x65F6;&#x4F7F;&#x7528;
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>&#x5378;&#x8F7D;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/adhoc/uninstall.yml
# ansible nodes -a &quot;rm -rf /etc/origin&quot;
# ansible nfs -a &quot;rm -rf /srv/nfs/*&quot;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="___6">&#x9AD8;&#x53EF;&#x7528;&#x5B89;&#x88C5;&#x9A8C;&#x8BC1;</h3>
<div class="listingblock">
<div class="title"><strong>&#x8F93;&#x51FA;&#x5F53;&#x524D;&#x7528;&#x6237;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc whoami
system:admin</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>&#x8F93;&#x51FA;&#x6240;&#x6709;&#x8282;&#x70B9;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get nodes
NAME                       STATUS    ROLES     AGE       VERSION
infranode1.f062.internal   Ready     infra     10m       v1.10.0+b81c8f8
infranode2.f062.internal   Ready     infra     10m       v1.10.0+b81c8f8
master1.f062.internal      Ready     master    13m       v1.10.0+b81c8f8
master2.f062.internal      Ready     master    13m       v1.10.0+b81c8f8
master3.f062.internal      Ready     master    13m       v1.10.0+b81c8f8
node1.f062.internal        Ready     compute   10m       v1.10.0+b81c8f8
node2.f062.internal        Ready     compute   10m       v1.10.0+b81c8f8
node3.f062.internal        Ready     compute   10m       v1.10.0+b81c8f8</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>&#x8F93;&#x51FA;&#x6240;&#x6709; Pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get pod --all-namespaces -o wide | wc -l
76
# oc get pod --all-namespaces -o wide
NAMESPACE                           NAME                                       READY     STATUS      RESTARTS   AGE       IP              NODE
default                             docker-registry-1-qgnst                    1/1       Running     0          10m       10.130.2.2      infranode1.f062.internal
default                             registry-console-1-bdjl2                   1/1       Running     0          10m       10.130.0.2      master1.f062.internal
default                             router-1-67g5t                             1/1       Running     0          10m       192.199.0.40    infranode1.f062.internal
default                             router-1-s7vql                             1/1       Running     0          10m       192.199.0.138   infranode2.f062.internal
kube-service-catalog                apiserver-8cqtd                            1/1       Running     0          3m        10.128.0.6      master3.f062.internal
kube-service-catalog                apiserver-gr6nn                            1/1       Running     0          3m        10.130.0.5      master1.f062.internal
kube-service-catalog                apiserver-jmk9b                            1/1       Running     0          3m        10.129.0.7      master2.f062.internal
kube-service-catalog                controller-manager-ql84k                   1/1       Running     0          3m        10.129.0.8      master2.f062.internal
kube-service-catalog                controller-manager-qrfk6                   1/1       Running     0          3m        10.128.0.7      master3.f062.internal
kube-service-catalog                controller-manager-rftnl                   1/1       Running     0          3m        10.130.0.6      master1.f062.internal
kube-system                         master-api-master1.f062.internal           1/1       Running     0          13m       192.199.0.189   master1.f062.internal
kube-system                         master-api-master2.f062.internal           1/1       Running     0          13m       192.199.0.105   master2.f062.internal
kube-system                         master-api-master3.f062.internal           1/1       Running     0          13m       192.199.0.220   master3.f062.internal
kube-system                         master-controllers-master1.f062.internal   1/1       Running     0          13m       192.199.0.189   master1.f062.internal
kube-system                         master-controllers-master2.f062.internal   1/1       Running     0          13m       192.199.0.105   master2.f062.internal
kube-system                         master-controllers-master3.f062.internal   1/1       Running     0          13m       192.199.0.220   master3.f062.internal
kube-system                         master-etcd-master1.f062.internal          1/1       Running     0          13m       192.199.0.189   master1.f062.internal
kube-system                         master-etcd-master2.f062.internal          1/1       Running     0          13m       192.199.0.105   master2.f062.internal
kube-system                         master-etcd-master3.f062.internal          1/1       Running     0          13m       192.199.0.220   master3.f062.internal
openshift-ansible-service-broker    asb-1-fjkxx                                1/1       Running     0          3m        10.130.2.6      infranode1.f062.internal
openshift-infra                     hawkular-cassandra-1-v7svv                 1/1       Running     0          7m        10.128.0.3      master3.f062.internal
openshift-infra                     hawkular-metrics-jt5b9                     1/1       Running     0          7m        10.129.2.5      infranode2.f062.internal
openshift-infra                     hawkular-metrics-schema-mt775              0/1       Completed   0          8m        10.129.2.4      infranode2.f062.internal
openshift-infra                     heapster-ww5lr                             1/1       Running     0          7m        10.129.0.5      master2.f062.internal
openshift-logging                   logging-curator-1-rk98c                    1/1       Running     0          5m        10.128.2.2      node2.f062.internal
openshift-logging                   logging-es-data-master-1ptuekvq-1-deploy   1/1       Running     0          5m        10.128.0.5      master3.f062.internal
openshift-logging                   logging-es-data-master-1ptuekvq-1-dns66    0/2       Pending     0          4m        &lt;none&gt;          &lt;none&gt;
openshift-logging                   logging-fluentd-2b7mv                      1/1       Running     0          5m        10.128.2.3      node2.f062.internal
openshift-logging                   logging-fluentd-2pd82                      1/1       Running     0          5m        10.130.2.5      infranode1.f062.internal
openshift-logging                   logging-fluentd-bsbjj                      1/1       Running     0          5m        10.130.0.4      master1.f062.internal
openshift-logging                   logging-fluentd-cg9rs                      1/1       Running     0          5m        10.131.2.3      node3.f062.internal
openshift-logging                   logging-fluentd-cqpt6                      1/1       Running     0          5m        10.128.0.4      master3.f062.internal
openshift-logging                   logging-fluentd-qjwkr                      1/1       Running     0          5m        10.129.0.6      master2.f062.internal
openshift-logging                   logging-fluentd-rwhd6                      1/1       Running     0          5m        10.129.2.6      infranode2.f062.internal
openshift-logging                   logging-fluentd-sq5b6                      1/1       Running     0          5m        10.131.0.3      node1.f062.internal
openshift-logging                   logging-kibana-1-f79lb                     2/2       Running     0          5m        10.130.2.4      infranode1.f062.internal
openshift-metrics                   prometheus-0                               0/6       Pending     0          4m        &lt;none&gt;          &lt;none&gt;
openshift-metrics                   prometheus-node-exporter-98n9k             1/1       Running     0          4m        192.199.0.40    infranode1.f062.internal
openshift-metrics                   prometheus-node-exporter-9kgqf             1/1       Running     0          4m        192.199.0.220   master3.f062.internal
openshift-metrics                   prometheus-node-exporter-9vpjc             1/1       Running     0          4m        192.199.0.105   master2.f062.internal
openshift-metrics                   prometheus-node-exporter-crcwq             1/1       Running     0          4m        192.199.0.189   master1.f062.internal
openshift-metrics                   prometheus-node-exporter-h49rr             1/1       Running     0          4m        192.199.0.138   infranode2.f062.internal
openshift-metrics                   prometheus-node-exporter-tftwh             1/1       Running     0          4m        192.199.0.61    node2.f062.internal
openshift-metrics                   prometheus-node-exporter-zhrbg             1/1       Running     0          4m        192.199.0.77    node1.f062.internal
openshift-metrics                   prometheus-node-exporter-zqltm             1/1       Running     0          4m        192.199.0.94    node3.f062.internal
openshift-node                      sync-8vn8q                                 1/1       Running     0          12m       192.199.0.105   master2.f062.internal
openshift-node                      sync-frgls                                 1/1       Running     0          11m       192.199.0.40    infranode1.f062.internal
openshift-node                      sync-hldpx                                 1/1       Running     0          11m       192.199.0.138   infranode2.f062.internal
openshift-node                      sync-jgn6j                                 1/1       Running     0          11m       192.199.0.61    node2.f062.internal
openshift-node                      sync-mp2dn                                 1/1       Running     0          11m       192.199.0.94    node3.f062.internal
openshift-node                      sync-nbr9q                                 1/1       Running     0          12m       192.199.0.189   master1.f062.internal
openshift-node                      sync-xxjsl                                 1/1       Running     0          12m       192.199.0.220   master3.f062.internal
openshift-node                      sync-zfnkm                                 1/1       Running     0          11m       192.199.0.77    node1.f062.internal
openshift-sdn                       ovs-6mkxk                                  1/1       Running     0          11m       192.199.0.77    node1.f062.internal
openshift-sdn                       ovs-74k8m                                  1/1       Running     0          12m       192.199.0.105   master2.f062.internal
openshift-sdn                       ovs-8rm52                                  1/1       Running     0          11m       192.199.0.40    infranode1.f062.internal
openshift-sdn                       ovs-hcp2r                                  1/1       Running     0          12m       192.199.0.189   master1.f062.internal
openshift-sdn                       ovs-qhrcj                                  1/1       Running     0          11m       192.199.0.138   infranode2.f062.internal
openshift-sdn                       ovs-sx4t7                                  1/1       Running     0          12m       192.199.0.220   master3.f062.internal
openshift-sdn                       ovs-zgsxg                                  1/1       Running     0          11m       192.199.0.61    node2.f062.internal
openshift-sdn                       ovs-zh9ln                                  1/1       Running     0          11m       192.199.0.94    node3.f062.internal
openshift-sdn                       sdn-4c58q                                  1/1       Running     0          12m       192.199.0.220   master3.f062.internal
openshift-sdn                       sdn-68kgk                                  1/1       Running     0          12m       192.199.0.105   master2.f062.internal
openshift-sdn                       sdn-7vh5l                                  1/1       Running     0          11m       192.199.0.77    node1.f062.internal
openshift-sdn                       sdn-grr8g                                  1/1       Running     0          11m       192.199.0.61    node2.f062.internal
openshift-sdn                       sdn-pv47r                                  1/1       Running     0          11m       192.199.0.138   infranode2.f062.internal
openshift-sdn                       sdn-tdbg7                                  1/1       Running     0          11m       192.199.0.40    infranode1.f062.internal
openshift-sdn                       sdn-vprhs                                  1/1       Running     0          11m       192.199.0.94    node3.f062.internal
openshift-sdn                       sdn-xd6ks                                  1/1       Running     0          12m       192.199.0.189   master1.f062.internal
openshift-template-service-broker   apiserver-8ffkw                            1/1       Running     0          3m        10.128.0.8      master3.f062.internal
openshift-template-service-broker   apiserver-kcqdt                            1/1       Running     0          3m        10.130.0.7      master1.f062.internal
openshift-template-service-broker   apiserver-s4x9n                            1/1       Running     0          3m        10.129.0.9      master2.f062.internal
openshift-web-console               webconsole-7f944b7c85-5xmtr                1/1       Running     2          10m       10.130.0.3      master1.f062.internal
openshift-web-console               webconsole-7f944b7c85-89qxf                1/1       Running     2          10m       10.129.0.3      master2.f062.internal
openshift-web-console               webconsole-7f944b7c85-h8c5n                1/1       Running     2          10m       10.128.0.2      master3.f062.internal</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__pv">&#x521B;&#x5EFA; PV</h3>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA; pv.sh</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">cat &lt;&lt; EOF &gt; pv.sh
#!/usr/bin/sh

mkdir -p /srv/nfs/user-vols/pv{1..200}

for pvnum in {1..50} ; do
echo &quot;/srv/nfs/user-vols/pv${pvnum} *(rw,root_squash)&quot; &gt;&gt; /etc/exports.d/openshift-uservols.exports
chown -R nfsnobody.nfsnobody  /srv/nfs
chmod -R 777 /srv/nfs
done

systemctl restart nfs-server
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x62F7;&#x8D1D; pv.sh &#x5230; NFS &#x670D;&#x52A1;&#x5668;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible support1.f062.internal -m copy -a &apos;src=./pv.sh dest=~/pv.sh owner=root group=root mode=0744&apos;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x5728; NFS &#x670D;&#x52A1;&#x5668;&#x4E0A;&#x6267;&#x884C; pv.sh</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ansible support1.f062.internal -m shell -a &apos;~/pv.sh&apos;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x521B;&#x5EFA; pvs.sh&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">#!/usr/bin/sh

export GUID=`hostname|awk -F. &apos;{print $2}&apos;`

export volsize=&quot;5Gi&quot;
mkdir /root/pvs
for volume in pv{1..25} ; do
cat &lt;&lt; EOF &gt; /root/pvs/${volume}
{
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;kind&quot;: &quot;PersistentVolume&quot;,
  &quot;metadata&quot;: {
    &quot;name&quot;: &quot;${volume}&quot;
  },
  &quot;spec&quot;: {
    &quot;capacity&quot;: {
        &quot;storage&quot;: &quot;${volsize}&quot;
    },
    &quot;accessModes&quot;: [ &quot;ReadWriteOnce&quot; ],
    &quot;nfs&quot;: {
        &quot;path&quot;: &quot;/srv/nfs/user-vols/${volume}&quot;,
        &quot;server&quot;: &quot;support1.${GUID}.internal&quot;
    },
    &quot;persistentVolumeReclaimPolicy&quot;: &quot;Recycle&quot;
  }
}
EOF
echo &quot;Created def file for ${volume}&quot;;
done;

# 10Gi
export volsize=&quot;10Gi&quot;
for volume in pv{26..50} ; do
cat &lt;&lt; EOF &gt; /root/pvs/${volume}
{
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;kind&quot;: &quot;PersistentVolume&quot;,
  &quot;metadata&quot;: {
    &quot;name&quot;: &quot;${volume}&quot;
  },
  &quot;spec&quot;: {
    &quot;capacity&quot;: {
        &quot;storage&quot;: &quot;${volsize}&quot;
    },
    &quot;accessModes&quot;: [ &quot;ReadWriteMany&quot; ],
    &quot;nfs&quot;: {
        &quot;path&quot;: &quot;/srv/nfs/user-vols/${volume}&quot;,
        &quot;server&quot;: &quot;support1.${GUID}.internal&quot;
    },
    &quot;persistentVolumeReclaimPolicy&quot;: &quot;Retain&quot;
  }
}
EOF
echo &quot;Created def file for ${volume}&quot;;
done;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x6267;&#x884C; pvs.sh &#x521B;&#x5EFA; PV</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># chmod +x pvs.sh &amp;&amp; ./pvs.sh
# cat /root/pvs/* | oc create -f -</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. &#x67E5;&#x770B; ReadWriteOnce PV &#x914D;&#x7F6E;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># cat /root/pvs/pv1
{
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;kind&quot;: &quot;PersistentVolume&quot;,
  &quot;metadata&quot;: {
    &quot;name&quot;: &quot;pv1&quot;
  },
  &quot;spec&quot;: {
    &quot;capacity&quot;: {
        &quot;storage&quot;: &quot;5Gi&quot;
    },
    &quot;accessModes&quot;: [ &quot;ReadWriteOnce&quot; ],
    &quot;nfs&quot;: {
        &quot;path&quot;: &quot;/srv/nfs/user-vols/pv1&quot;,
        &quot;server&quot;: &quot;support1.f062.internal&quot;
    },
    &quot;persistentVolumeReclaimPolicy&quot;: &quot;Recycle&quot;
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>7. &#x67E5;&#x770B; ReadWriteMany PV &#x914D;&#x7F6E;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># cat /root/pvs/pv28
{
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;kind&quot;: &quot;PersistentVolume&quot;,
  &quot;metadata&quot;: {
    &quot;name&quot;: &quot;pv28&quot;
  },
  &quot;spec&quot;: {
    &quot;capacity&quot;: {
        &quot;storage&quot;: &quot;10Gi&quot;
    },
    &quot;accessModes&quot;: [ &quot;ReadWriteMany&quot; ],
    &quot;nfs&quot;: {
        &quot;path&quot;: &quot;/srv/nfs/user-vols/pv28&quot;,
        &quot;server&quot;: &quot;support1.f062.internal&quot;
    },
    &quot;persistentVolumeReclaimPolicy&quot;: &quot;Retain&quot;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="___7">&#x5192;&#x70DF;&#x6D4B;&#x8BD5;</h3>
<div class="paragraph">
<p>&#x672C;&#x90E8;&#x5206;&#x6D4B;&#x8BD5; OpenShift &#x9AD8;&#x7EA7;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#xFF0C;&#x786E;&#x4FDD;&#x96C6;&#x7FA4;&#x8FD0;&#x884C;&#x6B63;&#x5E38;&#xFF0C;PV &#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#xFF0C;&#x955C;&#x50CF;&#x53EF;&#x4EE5; S2I &#x751F;&#x6210;&#x5E76;&#x63A8;&#x9001;&#x5230;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#xFF0C;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#xFF0C;&#x8DEF;&#x7531;&#x53EF;&#x4EE5;&#x8DEF;&#x7531;&#x5916;&#x90E8;&#x8BF7;&#x6C42;&#x3002;</p>
</div>
<div class="paragraph">
<p>&#x4F7F;&#x7528; <code>nodejs-mongo-persistent</code> &#x6A21;&#x7248;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x4F7F;&#x7528; MongoDB &#x4FDD;&#x5B58;&#x6570;&#x636E;&#x4E14;&#x9700;&#x8981;&#x6302;&#x8F7D;&#x5B58;&#x50A8;&#x3002;</p>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x5DE5;&#x7A0B;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc new-project smoke-test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA; nodejs &#x5E94;&#x7528;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc new-app nodejs-mongo-persistent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x67E5;&#x770B; PV &#x6302;&#x8F7D;&#x60C5;&#x51B5;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get pv | grep mongodb
pv1               5Gi        RWO            Recycle          Bound       smoke-test/mongodb                                             15m</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x67E5;&#x770B;&#x8DEF;&#x7531;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get routes
NAME                      HOST/PORT                                                          PATH      SERVICES                  PORT      TERMINATION   WILDCARD
nodejs-mongo-persistent   nodejs-mongo-persistent-smoke-test.apps.f062.example.opentlc.com             nodejs-mongo-persistent   &lt;all&gt;                   None</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x5916;&#x90E8;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x6D4B;&#x8BD5;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">$ curl http://nodejs-mongo-persistent-smoke-test.apps.f062.example.opentlc.com</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
&#x6253;&#x5F00;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x8BBF;&#x95EE; <a href="http://nodejs-mongo-persistent-smoke-test.apps.f062.example.opentlc.com" class="bare" target="_blank">http://nodejs-mongo-persistent-smoke-test.apps.f062.example.opentlc.com</a> &#x53EF;&#x4EE5;&#x6D4B;&#x8BD5;&#x5E94;&#x7528;&#x3002;
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>6. &#x5220;&#x9664;&#x6D4B;&#x8BD5;&#x5DE5;&#x7A0B;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">$ oc delete project smoke-test</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="___8">&#x7F51;&#x7EDC;</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="___9">&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x7F51;&#x7EDC;</h3>
<div class="paragraph">
<p>&#x4E3A;&#x4EC0;&#x4E48; OpenShift/Kubernetes &#x9700;&#x8981;&#x7F51;&#x7EDC;&#xFF1F;&#x5E94;&#x4E3A;&#x9ED8;&#x8BA4; Docker &#x91C7;&#x7528;&#x865A;&#x62DF;&#x6865;&#x63A5;&#x8BBE;&#x5907;&#xFF0C;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x90FD;&#x8FDE;&#x63A5;&#x5230;&#x865A;&#x62DF;&#x6865;&#x63A5;&#x8BBE;&#x5907;&#xFF0C;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x9762;&#x7684;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x901A;&#x4FE1;&#xFF0C;&#x4F46;&#x4E0D;&#x540C;&#x4E3B;&#x673A;&#x4E0A;&#x5BB9;&#x5668;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x901A;&#x4FE1;&#xFF0C;&#x4E0D;&#x540C;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x5BB9;&#x5668;&#x901A;&#x4FE1;&#x9700;&#x8981;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x7B49;&#x914D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x4E0D;&#x540C;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x5BB9;&#x5668;&#x901A;&#x4FE1;&#xFF0C;Kubernetes &#x5F15;&#x5165;&#x7F51;&#x7EDC;&#x7684;&#x6982;&#x5FF5;&#xFF0C;<strong>OpenShift/Kubernetes &#x7684;&#x7F51;&#x7EDC;&#x662F;&#x4E3A;&#x4E86;&#x7075;&#x6D3B;&#x63A7;&#x5236;&#x4E0D;&#x540C;&#x4E3B;&#x673A;&#x4E0A;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;</strong>&#x3002;&#x7F51;&#x7EDC;&#x4E5F;&#x79F0;&#x8F6F;&#x4EF6;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#xFF0C;Software-Defined Networking (SDN)&#x3002;</p>
</div>
<div class="paragraph">
<p>Container Network Interface(CNI) &#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x4E86;&#x914D;&#x7F6E;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x7684;&#x63CF;&#x8FF0;&#x548C;&#x6807;&#x51C6;&#xFF0C;</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/ocp-net-plugin.png" alt="ocp net plugin.png"></span></p>
</div>
<div class="paragraph">
<p>OpenShift &#x63D0;&#x4F9B;&#x4E00;&#x7CFB;&#x5217;&#x5B9E;&#x73B0;&#x4E86; CNI &#x7684;&#x7F51;&#x7EDC;&#x7F51;&#x7EDC;&#x63D2;&#x4EF6;&#xFF0C;OpenShift OVS &#x4E3A;&#x9ED8;&#x8BA4;&#x63D2;&#x4EF6;&#xFF0C;OVS &#x53C8;&#x6709;&#x4E09;&#x79CD;&#x6A21;&#x5F0F;&#xFF1A;ovs-subnet&#xFF0C;ovs-multitenant&#xFF0C;ovs-networkpolicy&#xFF0C;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x901A;&#x8FC7;&#x5982;&#x4E0B; Ansible &#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x914D;&#x7F6E;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">os_sdn_network_plugin_name=&apos;redhat/openshift-ovs-subnet&apos;
os_sdn_network_plugin_name=&apos;redhat/openshift-ovs-multitenant&apos;
os_sdn_network_plugin_name=&apos;redhat/openshift-ovs-networkpolicy&apos;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. <strong>OpenShift SDN OVS &#x63D2;&#x4EF6;</strong></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">&#x540D;&#x79F0;</th>
<th class="tableblock halign-left valign-top">&#x662F;&#x5426;&#x9ED8;&#x8BA4;</th>
<th class="tableblock halign-left valign-top">&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovs-subnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x662F;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x6241;&#x5E73;&#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x4EFB;&#x610F;&#x4E00;&#x4E2A; Pod &#x53EF;&#x4EE5;&#x901A;&#x4EFB;&#x610F; Pod &#x6216; Service &#x901A;&#x4FE1;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovs-multitenant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x5426;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x5C42;&#x62BD;&#x8C61;&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#xFF0C;&#x4E00;&#x4E2A; Project &#x4E2D;&#x5904;&#x4E8E;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x4E14;&#x6709;&#x552F;&#x4E00;&#x7684; VNID&#xFF0C;&#x4E0D;&#x540C; Project &#x4E2D;&#x7684; Pod &#x4E0D;&#x80FD;&#x548C;&#x5176;&#x5B83; Project &#x4E2D;&#x7684; Pod &#x6216; Service &#x901A;&#x4FE1;&#x3002;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovs-networkpolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x5426;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x5141;&#x8BB8;&#x901A;&#x8FC7; NetworkPolicy &#x5BF9;&#x8C61;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x7B56;&#x7565;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="___10">&#x5185;&#x7F6E;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x548C;&#x5185;&#x90E8;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</h3>
<div class="paragraph">
<p>OpenShift/Kubernetes &#x5728;&#x7F51;&#x7EDC;&#x5E94;&#x7528;&#x5C42;&#x63D0;&#x51FA; <code>Service</code> &#x7684;&#x6982;&#x5FF5;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x8BBE;&#x8BA1;&#xFF08;&#x76F8;&#x6BD4;&#x8F83;&#x4F20;&#x7EDF;&#x4E2D;&#x95F4;&#x4EF6;&#x67B6;&#x6784;&#xFF09;&#xFF0C;&#x4E00;&#x4E2A; <code>Service</code> &#x5305;&#x62EC;&#x4E00;&#x7EC4;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6216;&#x662F;&#x4F4D;&#x4E8E;&#x4E00;&#x7EC4;&#x5BB9;&#x5668;&#x4E4B;&#x4E0A;&#x7684;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#xFF0C;&#x800C; <code>Service</code> &#x7684;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E24;&#x4E2A;&#x6807;&#x51C6;&#x5316;&#x7279;&#x6027;&#x662F;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#x5185;&#x90E8;&#x8D1F;&#x8F7D;&#x5747;&#x8861;(internal load-balancing)</p>
</li>
<li>
<p>&#x5185;&#x7F6E;&#x670D;&#x52A1;&#x53D1;&#x73B0; - Service &#x4F1A;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; <code>Selector: app=hello-openshift,deploymentconfig=hello-openshift</code>&#xFF0C;&#x5F53;&#x5E94;&#x7528;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x6807;&#x7B7E;(<code>Labels</code>)&#x80FD;&#x548C; Service &#x7684; <code>Selector</code> &#x5339;&#x914D;&#x65F6;&#xFF0C;&#x5185;&#x7F6E;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x5C06;&#x5E94;&#x7528;&#x5BB9;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x670D;&#x52A1;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/ocp-svc-discover-load-balancing.png" alt="ocp svc discover load balancing.png"></span></p>
</div>
<div class="paragraph">
<p>&#x5BB9;&#x5668;&#x5316;&#x5E94;&#x7528;&#x901A;&#x5E38;&#x4EE5; <code>Pod</code> &#x5C01;&#x88C5;&#xFF0C;<code>Service</code> &#x548C; <code>Pod</code> &#x9664;&#x4E86; <code>Name</code>, <code>Namespace</code>, <code>Selector</code>, <code>Labels</code> &#x7B49;&#x5C5E;&#x6027;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x4EE5;&#x4E0B;&#x91CD;&#x8981;&#x5C5E;&#x6027;&#xFF1A;</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IP</code></p>
</li>
<li>
<p><code>Port</code></p>
</li>
<li>
<p><code>Endpoints</code></p>
</li>
<li>
<p><code>Session Affinity</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&#x672C;&#x90E8;&#x5206;&#x56F4;&#x7ED5;&#x4EE5;&#x4E0A; <code>Service</code> &#x548C; <code>Pod</code> &#x7684;&#x5C5E;&#x6027;&#x53BB;&#x8BF4;&#x660E; OpenShift &#x7F51;&#x7EDC;&#x5E94;&#x7528;&#x5C42;&#x7684;&#x5185;&#x7F6E;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x548C;&#x5185;&#x90E8;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
</div>
<div class="sect3">
<h4 id="_i">I - &#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x5DE5;&#x7A0B;</h4>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA;&#x5DE5;&#x7A0B;&#x5E76;&#x90E8;&#x7F72;&#x5E94;&#x7528;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc new-project servicelayer

# oc new-app openshift/hello-openshift:v1.1.1.1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x6269;&#x5C55; <code>hello-openshift</code> &#x4E3A; 4 &#x4E2A;&#x8FD0;&#x884C;&#x5B9E;&#x4F8B;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc scale dc/hello-openshift --replicas=4
deploymentconfig.apps.openshift.io &quot;hello-openshift&quot; scaled</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x67E5;&#x770B; 4 &#x4E2A;&#x5B9E;&#x4F8B;&#x6B63;&#x5E38;&#x8FD0;&#x884C;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get pods -o wide
NAME                      READY     STATUS    RESTARTS   AGE       IP            NODE
hello-openshift-1-46q9h   1/1       Running   0          2m        10.128.2.11   node2.f062.internal
hello-openshift-1-5kptl   1/1       Running   0          56s       10.128.2.12   node2.f062.internal
hello-openshift-1-jqvhj   1/1       Running   0          56s       10.131.0.12   node1.f062.internal
hello-openshift-1-nk8w6   1/1       Running   0          56s       10.131.2.12   node3.f062.internal</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ii_round_robin">II - Round-Robin</h4>
<div class="paragraph">
<p>OpenShift &#x4E2D;&#x9ED8;&#x8BA4;&#x521B;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7B56;&#x7565;&#x662F; Round-Robin&#x3002;</p>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x67E5;&#x770B;&#x670D;&#x52A1;&#x660E;&#x7EC6;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc describe svc hello-openshift
Name:              hello-openshift
Namespace:         servicelayer
Labels:            app=hello-openshift
Annotations:       openshift.io/generated-by=OpenShiftNewApp
Selector:          app=hello-openshift,deploymentconfig=hello-openshift
Type:              ClusterIP
IP:                172.30.37.237
Port:              8080-tcp  8080/TCP
TargetPort:        8080/TCP
Endpoints:         10.128.2.11:8080,10.128.2.12:8080,10.131.0.12:8080 + 1 more...
Port:              8888-tcp  8888/TCP
TargetPort:        8888/TCP
Endpoints:         10.128.2.11:8888,10.128.2.12:8888,10.131.0.12:8888 + 1 more...
Session Affinity:  None
Events:            &lt;none&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>hello-openshift</code> &#x7684; IP &#x4E3A; <code>172.30.37.237</code>&#xFF0C;<code>Type</code> &#x4E3A; <code>ClusterIP</code>&#xFF0C;<code>Session Affinity</code> &#x4E3A; <code>None</code>&#x3002;
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>2. <code>ssh</code> &#x5230; master1</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># ssh master1.f062.internal
$ sudo -i
# oc project servicelayer</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x67E5;&#x770B; hello-openshift &#x670D;&#x52A1; 8080 &#x7AEF;&#x53E3; iptables &#x89C4;&#x5219;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># iptables-save | grep servicelayer/hello-openshift | grep 8080
-A KUBE-SEP-5ALW7DB4ASV2H75B -s 10.128.2.11/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-5ALW7DB4ASV2H75B -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m tcp -j DNAT --to-destination 10.128.2.11:8080
-A KUBE-SEP-7JAYOUKDEDIW6LF6 -s 10.131.0.12/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-7JAYOUKDEDIW6LF6 -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m tcp -j DNAT --to-destination 10.131.0.12:8080
-A KUBE-SEP-SCPXWX5WPAPOOM2W -s 10.131.2.12/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-SCPXWX5WPAPOOM2W -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m tcp -j DNAT --to-destination 10.131.2.12:8080
-A KUBE-SEP-TSDFXFOXWPPSIHKV -s 10.128.2.12/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-TSDFXFOXWPPSIHKV -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m tcp -j DNAT --to-destination 10.128.2.12:8080
-A KUBE-SERVICES -d 172.30.37.237/32 -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp cluster IP&quot; -m tcp --dport 8080 -j KUBE-SVC-BXIL3WE3EN2EVZ7N
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.25000000000 -j KUBE-SEP-5ALW7DB4ASV2H75B
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.33332999982 -j KUBE-SEP-TSDFXFOXWPPSIHKV
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-7JAYOUKDEDIW6LF6
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-SEP-SCPXWX5WPAPOOM2W</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. hello-openshift &#x670D;&#x52A1;&#x8DEF;&#x5F84;&#x662F;&#x4E00;&#x4E2A;&#x76EE;&#x7684;&#x5730;&#x5339;&#x914D;&#x89C4;&#x5219;&#xFF0C;&#x8DF3;&#x8F6C;&#x5230;&#x53E6;&#x4E00;&#x4E2A; iptables &#x89C4;&#x5219; <code>KUBE-SVC-BXIL3WE3EN2EVZ7N</code></strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">-A KUBE-SERVICES -d 172.30.37.237/32 -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp cluster IP&quot; -m tcp --dport 8080 -j KUBE-SVC-BXIL3WE3EN2EVZ7N</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x6709;&#x56DB;&#x4E2A; <code>KUBE-SVC-BXIL3WE3EN2EVZ7N</code> &#x89C4;&#x5219;&#xFF0C;&#x901A;&#x8FC7;&#x968F;&#x673A;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x6311;&#x8F6C;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.25000000000 -j KUBE-SEP-5ALW7DB4ASV2H75B
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.33332999982 -j KUBE-SEP-TSDFXFOXWPPSIHKV
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-7JAYOUKDEDIW6LF6
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-SEP-SCPXWX5WPAPOOM2W</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. &#x5BFB;&#x627E; <code>KUBE-SEP-5ALW7DB4ASV2H75B</code> &#x4E0B;&#x4E00;&#x8DF3;&#xFF0C;&#x89C4;&#x5219;&#x94FE;&#x4E2D; <code>DNAT</code> &#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x5411;&#x76F8;&#x5173; Pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">-A KUBE-SEP-5ALW7DB4ASV2H75B -s 10.128.2.11/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-5ALW7DB4ASV2H75B -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m tcp -j DNAT --to-destination 10.128.2.11:8080</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_iii_session_affinity">III - Session Affinity</h4>
<div class="listingblock">
<div class="title"><strong>1. &#x7F16;&#x8F91; <code>hello-openshift</code> &#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc edit svc hello-openshift</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x4FEE;&#x6539; sessionAffinity &#x4E3A; <code>ClientIP</code></strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">sessionAffinity: ClientIP</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x67E5;&#x770B;&#x670D;&#x52A1;&#x660E;&#x7EC6;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc describe svc hello-openshift
Name:              hello-openshift
Namespace:         servicelayer
Labels:            app=hello-openshift
Annotations:       openshift.io/generated-by=OpenShiftNewApp
Selector:          app=hello-openshift,deploymentconfig=hello-openshift
Type:              ClusterIP
IP:                172.30.37.237
Port:              8080-tcp  8080/TCP
TargetPort:        8080/TCP
Endpoints:         10.128.2.11:8080,10.128.2.12:8080,10.131.0.12:8080 + 1 more...
Port:              8888-tcp  8888/TCP
TargetPort:        8888/TCP
Endpoints:         10.128.2.11:8888,10.128.2.12:8888,10.131.0.12:8888 + 1 more...
Session Affinity:  ClientIP
Events:            &lt;none&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x67E5;&#x770B; hello-openshift &#x670D;&#x52A1; 8080 &#x7AEF;&#x53E3; iptables &#x89C4;&#x5219;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># iptables-save | grep servicelayer/hello-openshift | grep 8080
-A KUBE-SEP-5ALW7DB4ASV2H75B -s 10.128.2.11/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-5ALW7DB4ASV2H75B -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --set --name KUBE-SEP-5ALW7DB4ASV2H75B --mask 255.255.255.255 --rsource -m tcp -j DNAT --to-destination 10.128.2.11:8080
-A KUBE-SEP-7JAYOUKDEDIW6LF6 -s 10.131.0.12/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-7JAYOUKDEDIW6LF6 -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --set --name KUBE-SEP-7JAYOUKDEDIW6LF6 --mask 255.255.255.255 --rsource -m tcp -j DNAT --to-destination 10.131.0.12:8080
-A KUBE-SEP-SCPXWX5WPAPOOM2W -s 10.131.2.12/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-SCPXWX5WPAPOOM2W -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --set --name KUBE-SEP-SCPXWX5WPAPOOM2W --mask 255.255.255.255 --rsource -m tcp -j DNAT --to-destination 10.131.2.12:8080
-A KUBE-SEP-TSDFXFOXWPPSIHKV -s 10.128.2.12/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-TSDFXFOXWPPSIHKV -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --set --name KUBE-SEP-TSDFXFOXWPPSIHKV --mask 255.255.255.255 --rsource -m tcp -j DNAT --to-destination 10.128.2.12:8080
-A KUBE-SERVICES -d 172.30.37.237/32 -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp cluster IP&quot; -m tcp --dport 8080 -j KUBE-SVC-BXIL3WE3EN2EVZ7N
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-5ALW7DB4ASV2H75B --mask 255.255.255.255 --rsource -j KUBE-SEP-5ALW7DB4ASV2H75B
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-TSDFXFOXWPPSIHKV --mask 255.255.255.255 --rsource -j KUBE-SEP-TSDFXFOXWPPSIHKV
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-7JAYOUKDEDIW6LF6 --mask 255.255.255.255 --rsource -j KUBE-SEP-7JAYOUKDEDIW6LF6
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-SCPXWX5WPAPOOM2W --mask 255.255.255.255 --rsource -j KUBE-SEP-SCPXWX5WPAPOOM2W
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.25000000000 -j KUBE-SEP-5ALW7DB4ASV2H75B
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.33332999982 -j KUBE-SEP-TSDFXFOXWPPSIHKV
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-7JAYOUKDEDIW6LF6
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-SEP-SCPXWX5WPAPOOM2W</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x67E5;&#x770B;&#x7B2C;&#x4E00;&#x8DF3; SVC &#x7684;&#x89C4;&#x5219;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">-A KUBE-SERVICES -d 172.30.37.237/32 -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp cluster IP&quot; -m tcp --dport 8080 -j KUBE-SVC-BXIL3WE3EN2EVZ7N</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. &#x67E5;&#x770B;&#x7B2C;&#x4E8C;&#x8DF3;&#x89C4;&#x5219;&#x94FE;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-5ALW7DB4ASV2H75B --mask 255.255.255.255 --rsource -j KUBE-SEP-5ALW7DB4ASV2H75B
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-TSDFXFOXWPPSIHKV --mask 255.255.255.255 --rsource -j KUBE-SEP-TSDFXFOXWPPSIHKV
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-7JAYOUKDEDIW6LF6 --mask 255.255.255.255 --rsource -j KUBE-SEP-7JAYOUKDEDIW6LF6
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-SCPXWX5WPAPOOM2W --mask 255.255.255.255 --rsource -j KUBE-SEP-SCPXWX5WPAPOOM2W
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.25000000000 -j KUBE-SEP-5ALW7DB4ASV2H75B
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.33332999982 -j KUBE-SEP-TSDFXFOXWPPSIHKV
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-7JAYOUKDEDIW6LF6
-A KUBE-SVC-BXIL3WE3EN2EVZ7N -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-SEP-SCPXWX5WPAPOOM2W</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#x548C; <code>Round-Robin</code> &#x76F8;&#x6BD4;&#xFF0C;&#x7B2C;&#x4E8C;&#x8C03;&#x591A;&#x4E86; <code>-m recent --rcheck --seconds 10800</code> &#x76F8;&#x5173;&#x89C4;&#x5219;&#xFF0C;&#x5728;&#x4E00;&#x7AEF;&#x65F6;&#x95F4;&#x5185;&#x7C98;&#x6027;&#x8F6C;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x89C4;&#x5219;&#x3002;</p>
</div>
<div class="listingblock">
<div class="title"><strong>7. &#x67E5;&#x770B;&#x7B2C;&#x4E09;&#x8DF3;&#xFF0C;&#x89C4;&#x5219;&#x94FE;&#x4E2D; <code>DNAT</code> &#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x5411;&#x76F8;&#x5173; Pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">-A KUBE-SEP-5ALW7DB4ASV2H75B -s 10.128.2.11/32 -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -j KUBE-MARK-MASQ
-A KUBE-SEP-5ALW7DB4ASV2H75B -p tcp -m comment --comment &quot;servicelayer/hello-openshift:8080-tcp&quot; -m recent --set --name KUBE-SEP-5ALW7DB4ASV2H75B --mask 255.255.255.255 --rsource -m tcp -j DNAT --to-destination 10.128.2.11:8080</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ovs_multitenant">OVS Multitenant</h3>
<div class="paragraph">
<p>&#x5B89;&#x88C5; OpenShift &#x65F6;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x5982;&#x4E0B; Ansible Inventory &#x53D8;&#x91CF;&#xFF0C;&#x914D;&#x7F6E;&#x7F51;&#x7EDC;&#x4E3A; <code>openshift-ovs-multitenant</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">os_sdn_network_plugin_name=&apos;redhat/openshift-ovs-multitenant&apos;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_i_2">I - &#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x5DE5;&#x7A0B;</h4>
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x6D4B;&#x8BD5;&#x5DE5;&#x7A0B;&#xFF0C;&#x5E76;&#x5206;&#x522B;&#x901A;&#x8FC7; hello-openshift &#x955C;&#x50CF;&#x90E8;&#x7F72;&#x5E94;&#x7528;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc new-project pizzaparty-dev
# oc new-project fancypants-dev

# oc new-app openshift/hello-openshift:v1.1.1.1 -n pizzaparty-dev
# oc new-app openshift/hello-openshift:v1.1.1.1 -n fancypants-dev</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x67E5;&#x770B; hello-openshift Pod &#x8FD0;&#x884C;&#x72B6;&#x6001;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get pod --all-namespaces | grep hello-openshift
fancypants-dev                      hello-openshift-1-zbd8l                    1/1       Running     0          1m
pizzaparty-dev                      hello-openshift-1-dzh58                    1/1       Running     0          1m</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x5206;&#x522B;&#x5728;&#x4E24;&#x4E2A;&#x5DE5;&#x7A0B;&#x4E2D;&#x521B;&#x5EFA;&#x4E24;&#x4E2A; bash Pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc run shelly -n pizzaparty-dev --image=openshift3/ose-deployer --command=true -- bash -c &apos;while true; do sleep 1; done&apos;
# oc run shelly -n fancypants-dev --image=openshift3/ose-deployer --command=true -- bash -c &apos;while true; do sleep 1; done&apos;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x67E5;&#x770B; bash Pod &#x8FD0;&#x884C;&#x72B6;&#x6001;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get pod --all-namespaces | grep shelly
fancypants-dev                      shelly-1-tgmgw                             1/1       Running     0          39s
pizzaparty-dev                      shelly-1-jdn74                             1/1       Running     0          47s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ii_netid">II - &#x865A;&#x62DF;&#x7F51;&#x7EDC; NETID</h4>
<div class="listingblock">
<div class="title"><strong>&#x67E5;&#x770B; netnamespaces &#x5C5E;&#x6027; NETID</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get netnamespaces
NAME                                NETID      EGRESS IPS
fancypants-dev                      6646260    []
...
pizzaparty-dev                      15713197   []</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
&#x4E24;&#x4E2A; netnamespaces &#x7684;&#x865A;&#x62DF;&#x7F51;&#x7EDC; ID &#x4E0D;&#x540C;&#x3002;
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_iii_multitenancy">III - Multitenancy &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x6027;&#x6D4B;&#x8BD5;</h4>
<div class="listingblock">
<div class="title"><strong>1. &#x83B7;&#x53D6; Pod &#x7684; IP &#x5730;&#x5740;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get pod -n pizzaparty-dev
NAME                      READY     STATUS    RESTARTS   AGE
hello-openshift-1-dzh58   1/1       Running   0          45m
shelly-1-jdn74            1/1       Running   0          40m

# oc describe pod -n pizzaparty-dev hello-openshift-1-dzh58 | egrep &apos;IP|Node:&apos;
Node:           node1.f062.internal/192.199.0.77
IP:             10.131.0.7

# oc get pod -n fancypants-dev
NAME                      READY     STATUS    RESTARTS   AGE
hello-openshift-1-zbd8l   1/1       Running   0          48m
shelly-1-tgmgw            1/1       Running   0          43m

# oc describe pod -n fancypants-dev hello-openshift-1-zbd8l | egrep &apos;IP|Node:&apos;
Node:           node3.f062.internal/192.199.0.94
IP:             10.131.2.7</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>hello-openshift</code> &#x4F4D;&#x4E8E; <code>pizzaparty-dev</code> IP &#x5730;&#x5740;&#x4E3A; <code>10.131.0.7</code>&#xFF0C;&#x800C; <code>hello-openshift</code> &#x4F4D;&#x4E8E; <code>fancypants-dev</code> IP &#x5730;&#x5740;&#x4E3A; 10.131.2.7&#x3002;
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x5728; <code>fancypants-dev</code> &#x4E2D;&#x4F7F;&#x7528; <code>oc rsh</code> &#x8FDB;&#x5165; <code>shelly</code> Pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc rsh -n fancypants-dev $(oc get pod -n fancypants-dev | grep shelly | awk &apos;{print $1}&apos;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x67E5;&#x770B; <code>fancypants-dev</code> &#x4E2D; <code>shelly</code> Pod &#x7684; IP &#x5730;&#x5740;&#xFF0C;&#x5E76;&#x8BBF;&#x95EE; <code>fancypants-dev</code> &#x4E2D; <code>hello-openshift</code> &#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">sh-4.2$ ip a | grep inet | grep eth0
    inet 10.131.0.8/23 brd 10.131.1.255 scope global eth0

sh-4.2$ curl http://10.131.2.7:8080 -m 1
Hello OpenShift!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x63A5;&#x7740;&#x6B65;&#x9AA4; 3&#xFF0C;&#x5728; <code>fancypants-dev</code> &#x4E2D; <code>shelly</code> Pod &#x4E2D;&#x8BBF;&#x95EE; <code>pizzaparty-dev</code> &#x63D0;&#x4F9B;&#x7684; <code>hello-openshift</code> &#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">sh-4.2$ curl http://10.131.0.7:8080 -m 1
curl: (28) Connection timed out after 1001 milliseconds</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
&#x4E0A;&#x9762;&#x6B65;&#x9AA4;&#x8BF4;&#x660E; <code>fancypants-dev</code> &#x548C; <code>pizzaparty-dev</code> &#x662F;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x865A;&#x62DF;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#xFF0C;<code>fancypants-dev</code> &#x4E2D;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x4E0D;&#x80FD;&#x548C; <code>pizzaparty-dev</code> &#x4E2D;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x901A;&#x4FE1;&#x3002;
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x5728; <code>pizzaparty-dev</code> &#x4E2D;&#x4F7F;&#x7528; <code>oc rsh</code> &#x8FDB;&#x5165; <code>shelly</code> Pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc rsh -n pizzaparty-dev $(oc get pod -n pizzaparty-dev | grep shelly | awk &apos;{print $1}&apos;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. &#x67E5;&#x770B; <code>pizzaparty-dev</code> &#x4E2D; <code>shelly</code> Pod &#x7684; IP &#x5730;&#x5740;&#xFF0C;&#x5E76;&#x8BBF;&#x95EE; <code>pizzaparty-dev</code> &#x4E2D; <code>hello-openshift</code> &#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">sh-4.2$ ip a | grep inet | grep eth0
    inet 10.131.2.8/23 brd 10.131.3.255 scope global eth0

sh-4.2$ curl http://10.131.0.7:8080 -m 1
Hello OpenShift!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>7. &#x63A5;&#x7740;&#x6B65;&#x9AA4; 6&#xFF0C;&#x5728; <code>pizzaparty-dev</code> &#x4E2D; <code>shelly</code> Pod &#x4E2D;&#x8BBF;&#x95EE; <code>fancypants-dev</code> &#x63D0;&#x4F9B;&#x7684; <code>hello-openshift</code> &#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">sh-4.2$ curl http://10.131.2.7:8080 -m 1
curl: (28) Connection timed out after 1000 milliseconds</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
&#x6B65;&#x9AA4; 5 - 7 &#x518D;&#x6B21;&#x8BC1;&#x660E; <code>fancypants-dev</code> &#x548C; <code>pizzaparty-dev</code> &#x662F;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x865A;&#x62DF;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x3002;
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_iv_join_projects">IV - Join Projects</h4>
<div class="paragraph">
<p><code>oc adm pod-network</code> &#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x5C06;&#x4E24;&#x4E2A;&#x5DE5;&#x7A0B;&#x7EA7;&#x8054;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x4F7F;&#x5176;&#x5904;&#x4E8E;&#x540C;&#x4E00;&#x4E2A; Open vSwitch &#x865A;&#x62DF;&#x7F51;&#x7EDC;&#x3002;</p>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x7EA7;&#x8054; <code>pizzaparty-dev</code> &#x548C; <code>fancypants-dev</code></strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc adm pod-network join-projects --to=fancypants-dev pizzaparty-dev</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x67E5;&#x770B;&#x4E24;&#x4E2A;&#x5DE5;&#x7A0B;&#x6240;&#x5728;&#x865A;&#x62DF;&#x7F51;&#x7EDC; ID</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc get netnamespaces | grep dev
fancypants-dev                      6646260    []
pizzaparty-dev                      6646260    []</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
&#x6CE8;&#x610F;&#xFF0C;&#x4E24;&#x4E2A;&#x5DE5;&#x7A0B;&#x7684; NETID &#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x5728; <code>pizzaparty-dev</code> &#x4E2D;&#x4F7F;&#x7528; <code>oc rsh</code> &#x8FDB;&#x5165; <code>shelly</code> Pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc rsh -n pizzaparty-dev $(oc get pod -n pizzaparty-dev | grep shelly | awk &apos;{print $1}&apos;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x5728; <code>shelly</code> Pod &#x4E2D;&#x5206;&#x522B;&#x8BBF;&#x95EE; <code>pizzaparty-dev</code> &#x548C; <code>fancypants-dev</code> &#x63D0;&#x4F9B;&#x7684; <code>hello-openshift</code> &#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">sh-4.2$ curl http://10.131.0.7:8080 -m 1
Hello OpenShift!

sh-4.2$ curl http://10.131.2.7:8080 -m 1
Hello OpenShift!</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ovs_networkpolicy">OVS Networkpolicy</h3>
<div class="paragraph">
<p>&#x5B89;&#x88C5; OpenShift &#x65F6;&#x6DFB;&#x52A0;&#x5982;&#x4E0B; Ansible Inventory &#x53D8;&#x91CF;&#xFF0C;&#x914D;&#x7F6E;&#x7F51;&#x7EDC;&#x4E3A; <code>openshift-ovs-networkpolicy</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">os_sdn_network_plugin_name=&apos;redhat/openshift-ovs-networkpolicy&apos;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_i_3">I - &#x5E94;&#x7528;&#x90E8;&#x7F72;</h4>
<div class="listingblock">
<div class="title"><strong>1. &#x514B;&#x9686;&#x5E94;&#x7528;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># git clone https://github.com/newgoliath/microservices-on-openshift
# cd microservices-on-openshift/installscripts/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x521B;&#x5EFA; 3 &#x4E2A; Project</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># oc new-project msclient
# oc new-project msservices
# oc new-project msinfra</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">*3. &#x4FBF;&#x6377; 1.setVariable.sh *</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># cat 1.setVariable.sh
export OSE_DOMAIN=apps.example.com
export OSE_CLIENT_PROJECT=msclient
export OSE_SERVICES_PROJECT=msservices
export OSE_INFRA_PROJECT=msinfra
export FROM_GMAIL=kylinsoong.1214@gmail.com
export FROM_GMAIL_PASSWORD=XirZVyDjVvodKnMXDGwsw4JJsrzKpTby
export TWITTER_CONSUMER_KEY=nothign
export TWITTER_CONSUMER_SECRET=nothing
export TWITTER_OAUTH_ACCESS_TOKEN=noting
export TWITTER_OAUTH_ACCESS_TOKEN_SECRET=nothing</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x4F9D;&#x6B21;&#x6267;&#x884C;&#x811A;&#x672C;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"># source 1.setVariable.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="install/qa.html" class="navigation navigation-prev " aria-label="Previous page: 常见问题">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="devops.html" class="navigation navigation-next " aria-label="Next page: DEVOPS">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"高级部署","level":"1.4.3","depth":2,"next":{"title":"DEVOPS","level":"1.4.4","depth":2,"path":"openshift/devops.adoc","ref":"openshift/devops.adoc","articles":[]},"previous":{"title":"常见问题","level":"1.4.2.8","depth":3,"path":"openshift/install/qa.adoc","ref":"openshift/install/qa.adoc","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"GUID":"na39","OCP_USER_ID":"ksoong-redhat.com","copyrightYear":"2018","copyrightHolder":"Kylin Soong"},"plugins":["collapsible-menu","donate","-sharing","sharing-plus","splitter","back-to-top-button","edit-link"],"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy Kylin Soong 2018","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"collapsible-menu":{},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"donate":{"alipay":"http://ksoong.org/docs/content/images/alipay.png","alipayText":"支付宝捐赠","button":"赞赏","title":"","wechat":"http://ksoong.org/docs/content/images/wechat.png","wechatText":"微信捐赠"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"sharing":{"weibo":true,"linkedin":true,"google":true,"facebook":true,"all":["facebook","google","linkedin","weibo"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/kylinsoong/docs/blob/gh-pages"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"openshift/advanced-deployment.adoc","mtime":"2019-03-27T08:41:56.967Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2019-06-20T09:29:16.283Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

