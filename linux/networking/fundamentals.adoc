= è®¡ç®—æœºç½‘ç»œ
:toc: manual

== ç½‘ç»œæ¨¡å‹

å„ä¸ªç»„ç»‡æˆ–ä¼ä¸šå¯¹ç½‘ç»œæ¨¡å‹å®šä¹‰æœ‰æ‰€ä¸åŒï¼Œä½†ç›®å‰æœ€å¸¸è§çš„å®šä¹‰æœ‰ä¸€ä¸‹ä¸‰ç§ã€‚

=== TCP/IP äº”å±‚æ¨¡å‹

image:img/layer_terminology.png[]

* *ç‰©ç†å±‚* - ç‰©ç†å±‚è¡¨ç¤ºä¸è®¡ç®—æœºäº’è¿çš„ç‰©ç†è®¾å¤‡ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬å°†ç‰©ç†è®¾å¤‡è¿æ¥åœ¨ä¸€èµ·çš„ç½‘çº¿ã€å…‰ç¼†ã€è¿æ¥å™¨çš„è§„èŒƒï¼Œä»¥åŠæè¿°å¦‚ä½•é€šè¿‡è¿™äº›è¿æ¥å‘é€ä¿¡å·çš„è§„èŒƒã€‚
* *æ•°æ®é“¾è·¯å±‚* - ç‰©ç†å±‚ä»…ä»…æ¶‰åŠåˆ°çš„æ˜¯å…‰ç¼†ã€è¿æ¥å™¨å’Œä¿¡å·å‘é€ï¼Œæ•°æ®é“¾è·¯å±‚è´Ÿè´£å®šä¹‰è§£é‡Šè¿™äº›ä¿¡å·çš„é€šç”¨æ–¹æ³•ï¼Œä»¥ä¾¿ç½‘ç»œè®¾å¤‡å¯ä»¥è¿›è¡Œé€šä¿¡ã€‚ è¯¥å±‚ä¸­æœ€å¸¸è§çš„åè®®æ˜¯ä»¥å¤ªç½‘ï¼ˆEthernetï¼‰ï¼Œå®ƒæŒ‡å®šç‰©ç†å±‚å±æ€§ï¼Œå¹¶å®šä¹‰è´Ÿè´£åŒä¸€ç½‘ç»œæˆ–é“¾è·¯ä¸Šçš„èŠ‚ç‚¹é—´ä¼ è¾“æ•°æ®çš„åè®®ã€‚
* *ç½‘ç»œå±‚* - ä¹Ÿç§°ä¸º Internet å±‚ï¼Œå®ƒå…è®¸ä¸åŒçš„ç½‘ç»œä¹‹é—´é€šè¿‡è·¯ç”±å™¨è®¾å¤‡ç›¸äº’é€šä¿¡ã€‚æ•°æ®é“¾è·¯å±‚åªè´Ÿè´£çš„æ˜¯åŒä¸€é“¾è·¯ä¸Šçš„æ•°æ®äº¤äº’ï¼Œç½‘ç»œå±‚è´Ÿè´£çš„æ˜¯è·¨ä¸åŒç½‘ç»œçš„æ•°æ®äº¤äº’ã€‚ç½‘ç»œå±‚æœ€å¸¸è§çš„ä¸¤ä¸ªåè®®æ˜¯ IP ä¸ª Internetã€‚
* *ä¼ è¾“å±‚* - ç½‘ç»œå±‚å¯ä»¥è´Ÿè´£ä¸¤ä¸ªä¸åŒç½‘ç»œä¸­çš„èŠ‚ç‚¹é—´çš„æ•°æ®äº¤äº’ï¼Œä¼ è¾“å±‚ä¼šç†æ¸…åº”è¯¥ç”±é‚£ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç¨‹åºè·å–è¿™äº›æ•°æ®ã€‚TCP æ˜¯æœ€å¸¸è§çš„å››å±‚åè®®ï¼ŒIP è´Ÿè´£å°†æ•°æ®ä»ä¸€ä¸ªèŠ‚ç‚¹ä¼ è¾“åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹; TCP å’Œ UDP è´Ÿè´£ç¡®ä¿æ•°æ®è¢«èŠ‚ç‚¹ä¸Šçš„ç‰¹å®šåº”ç”¨è·å–ã€‚
* *åº”ç”¨å±‚* -  è¿™ä¸€å±‚åŒ…æ‹¬å¾ˆå¤šåè®®ï¼Œå¸¸è§çš„ä¸€äº›åŒ…æ‹¬æ˜¯ç”¨æ¥å…è®¸æ‚¨æµè§ˆç½‘é¡µæˆ–å‘é€æ¥æ”¶ç”µå­é‚®ä»¶ç­‰ã€‚

.*TCP/IP 5 å±‚æ¨¡å‹ä¸åŒ…è£¹æŠ•é€’å¯¹åº”ç¤ºä¾‹*
image:img/TCPIP-5-layer-models.png[]

1. ç‰©ç†å±‚ç›¸å½“äºæŠ•é€’å¿«é€’çš„å¡è½¦å’Œè·¯ã€‚
2. æ•°æ®é“¾è·¯å±‚ç¡®ä¿æŠ•é€’å¡è½¦ä»ä¸€ä¸ªåå­—è·¯å£åˆ°ä¸‹ä¸€ä¸ªåå­—è·¯å£ï¼Œå¹¶ä¸”é‡å¤å¤šæ¬¡ã€‚
3. ç½‘ç»œå±‚ç¡®å®šäº†åœ°å€ A å’Œåœ°å€ B ä¹‹é—´çš„è·¯ã€‚
4. ä¼ è¾“å±‚ç¡®ä¿æŸä¸ªåœ°å€ä¸Šå…·ä½“çš„é—¨ç‰Œå·ï¼Œä»¥åŠå‘Šè¯‰å¿«é€Ÿå·²ç»é€è¾¾ã€‚
5. åº”ç”¨å±‚æŒ‡åŒ…è£¹çš„å†…å®¹æœ¬èº«ã€‚

.*TCP/IP 5 å±‚æ¨¡å‹ä¸ç¡¬ä»¶ç»„å»ºå¯¹åº”å…³ç³»*
image:img/5layermoles-hardwareComponent.png[]

=== TCP/IP å››å±‚æ¨¡å‹

image:img/tcp-ip-model.png[TCP/IP]

* åº”ç”¨å±‚ - å¸¸è§çš„åº”ç”¨å±‚åè®®æœ‰ï¼šSSHï¼ŒHTTPSï¼ŒNFS/CIFSï¼ŒSMTP
* ä¼ è¾“å±‚ - ä¼ è¾“å±‚åè®®æœ‰ TCP å’Œ UDPï¼ŒTCP å±äºå¯é è¿æ¥ä¼ è¾“åè®®ï¼ŒUDP æ— è¿æ¥æ•°æ®åŒ…ä¼ è¾“åè®®
* ç½‘ç»œäº’è¿å±‚ - è´Ÿè´£å°†æ•°æ®ä»æºä¸»æœºä¼ è¾“åˆ°ç›®çš„ä¸»æœºï¼Œä»»æ„ä¸»æœºéƒ½æœ‰ä¸€ä¸ª IP åœ°å€å’Œå­ç½‘æ©ç æ¥ç¡®å®šç½‘ç»œåœ°å€ï¼Œè·¯ç”±å™¨ç”¨æ¥è¿æ¥ç½‘ç»œã€‚è¿™ä¸€å±‚çš„åè®®æœ‰ ICMPï¼Œ`ping` å‘½ä»¤å°±æ˜¯åŸºäº ICMP åè®®ï¼Œ`ping` å‘½ä»¤å‘é€ä¸€ä¸ª ICMP ECHO_REQUEST è¯·
æ±‚åŒ…ï¼ŒæˆåŠŸåˆ™è¿”å› ICMP ECHO_REPLY ç¡®è®¤ã€‚
* ç½‘ç»œæ¥å£å±‚ - æä¾›è¿æ¥åˆ°ç‰©ç†åª’ä»‹ï¼Œå¦‚å¸¸è§çš„æœ‰çº¿ä»¥å¤ªç½‘ï¼ˆ802.3ï¼‰å’Œæ— çº¿WLANï¼ˆ802.11ï¼‰ï¼Œæ¯ä¸€ä¸ªç‰©ç†ç½‘ç»œè®¾å¤‡éƒ½æœ‰ä¸€ä¸ªç‰©ç†åœ°å€ï¼ˆMACï¼‰ç”¨æ¥åœ¨ç½‘ç»œä¸­å”¯ä¸€æ ‡è¯†ç›®çš„åœ°å€ã€‚

=== OSI ä¸ƒå±‚æ¨¡å‹

è¯¦ç»†å‚ç…§ https://en.wikipedia.org/wiki/OSI_model[wiki/OSI_model] äº†è§£æ›´å¤šå…³äº OSI ä¸ƒå±‚æ¨¡å‹ã€‚

=== ä¸‰ç§æ¨¡å‹å¯¹æ¯”åŠå¯¹åº”ç½‘ç»œåè®®

é™¤äº† TCP/IP äº”å±‚æ¨¡å‹å¤–ï¼Œå…³äºç½‘ç»œæ¨¡å‹åœ¨ä¸šç•Œè¿˜æœ‰å…¶ä»–è¡¨è¿°ï¼Œæœ€æœ‰å½±å“åŠ›çš„è¡¨æ‰©ï¼šOSI ä¸ƒå±‚æ¨¡å‹å’Œ TCP/IP å››å±‚æ¨¡å‹ï¼Œå…·ä½“å¯¹ç…§å¦‚ä¸‹è¡¨ï¼š

image:img/network-model.png[]

* OSI ä¸ƒå±‚æ¨¡å‹å°† TCP/IP æ¨¡å‹ä¸­çš„åº”ç”¨å±‚ç»†åˆ†ä¸ºä¸‰å±‚ï¼šåº”å±‚å±‚ã€è¡¨ç¤ºå±‚ã€ä¼šè¯å±‚
* ç›¸æ¯”è¾ƒ TCP/IP äº”å±‚æ¨¡å‹ï¼ŒTCP/IP å››å±‚æ¨¡å‹å°†ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚åˆä¸ºä¸€å±‚
* ç½‘ç»œå±‚ä¹Ÿå« Internet å±‚æˆ–ç½‘ç»œäº’è”å±‚ï¼Œæ•°æ®é“¾è·¯å±‚ä¹Ÿç§°ç½‘ç»œæ¥å£å±‚

== ç‰©ç†å±‚

=== ç½‘ç»œè®¾å¤‡

==== ç”µç¼†ï¼ˆCablesï¼‰

ç”µç¼†ï¼ˆCablesï¼‰æ˜¯å°†ä¸åŒçš„è®¾å¤‡è¿æ¥åœ¨ä¸€èµ·ï¼Œå…è®¸ä»–ä»¬ç›¸äº’äº¤æ¢æ•°æ®ã€‚ç”µç¼†å¯åˆ†ä¸ºä¸¤ç±»:

* é“œç¼† - å°±æ˜¯æœ€é•¿è§çš„ç½‘çº¿ï¼Œé“œç¼†æ˜¯ç½‘ç»œç”µç¼†çš„æœ€å¸¸è§å½¢å¼ï¼Œå®ƒä»¬ç”±å¡‘æ–™ç»ç¼˜ä½“å†…çš„å¤šå¯¹é“œçº¿ç»„æˆã€‚ç½‘ç»œä¸­æœ€é•¿è§çš„é“œçº¿é…å¯¹ç¼ ç»•æ ‡å‡†æœ‰ Cat5, Cat5e, å’Œ Cat6ã€‚è¿™äº›ç±»åˆ«å…·æœ‰ä¸åŒçš„ç‰©ç†ç‰¹æ€§ï¼Œä¾‹å¦‚ä¸€å¯¹é“œçº¿ä¸­çš„ç»åˆæ•°ä¼šå¯¼è‡´ä¸åŒçš„å¯ç”¨é•¿åº¦å’Œä¼ è¾“é€Ÿç‡ã€‚
* å…‰ç¼† - å…‰çº¤ç”µç¼†åŒ…å«å•ä¸ªçš„å…‰çº¤æ˜¯ç”±ç»ç’ƒåˆ¶æˆçš„ç»†ç®¡ï¼Œå¤§çº¦ä¸äººçš„å¤´å‘å®½åº¦ç›¸åŒã€‚è¿™äº›ç»ç’ƒç®¡å¯ä»¥ä¼ è¾“å…‰æŸã€‚ä¸ä½¿ç”¨ç”µå‹çš„é“œç¼†ä¸åŒï¼Œå…‰ç¼†ä½¿ç”¨å…‰è„‰å†²æ¥è¡¨ç¤ºåŸºç¡€æ•°æ®çš„ 1 å’Œ0ã€‚

==== Hub

Hub æ˜¯ç‰©ç†å±‚çš„è®¾å¤‡ï¼Œå¤šå°è®¡ç®—æœºè®¾å¤‡å¯è¿æ¥åˆ°å®ƒï¼Œå…è®¸åŒä¸€æ—¶åˆ»æ¥è‡ªä¸åŒè®¡ç®—æœºçš„è¿æ¥ã€‚

image:img/network-hub.png[]

All the devices connected to a hub will end up talking to all other devices at the same time. It's up to each system connected to the hub to determine if the incoming data was meant for them, or to ignore it if it isn't. This causes a lot of noise on the network and creates what's called a collision domain. A collision domain is a network segment where only one device can communicate at a time. If multiple systems try sending data at the same time, the electrical pulses sent across the cable can interfere with each other. This causes these systems to have to wait for a quiet period before they try sending their data again. It really slows down network communications, and is the primary reason hubs are fairly rare.

==== äº¤æ¢æœºï¼ˆSwitchï¼‰

äº¤æ¢æœºæ˜¯äºŒå±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰è®¾å¤‡ï¼Œæ˜¯ç›®å‰å¸¸è§çš„ç½‘ç»œè®¾å¤‡ï¼Œå…è®¸å¤šå°è®¡ç®—æœºè¿æ¥åˆ°å®ƒï¼Œç”±äºæ˜¯äºŒå±‚çš„è®¾å¤‡ï¼Œäº¤æ¢æœºå¯ä»¥è¯†åˆ« Ethernet åè®®ä¸­çš„å±æ€§æ¥è¯†åˆ«ç‰¹ç‚¹çš„è®¡ç®—æœºï¼Œç¡®ä¿æ•°æ®å‡†ç¡®çš„ä¼ è¾“åˆ°ç‰¹å®šçš„æœºå™¨ã€‚è¿™æå¤§çš„å‡å°‘äº†ç½‘ç»œåŸŸå†²çªï¼Œæé«˜äº†ç½‘ç»œä¼ è¾“çš„ååé‡.

==== è·¯ç”±å™¨ï¼ˆRouterï¼‰

Hub æ˜¯ä¸€å±‚çš„ç½‘ç»œè®¾å¤‡ï¼Œäº¤æ¢æœºæ˜¯äºŒå±‚çš„ç½‘ç»œè®¾å¤‡ï¼ŒäºŒè·¯ç”±å™¨æ˜¯ä¸‰å±‚çš„ç½‘ç»œè®¾å¤‡ï¼Œè·¯ç”±å™¨çŸ¥é“å¦‚ä½•åœ¨ä¸åŒçš„ç½‘ç»œä¹‹é—´å‘é€æ•°æ®ã€‚å’Œäº¤æ¢æœºæ£€æµ‹ Ethernet åè®®ä¸­çš„å±æ€§å†³å®šå°†åŒ…å‘é€åˆ°ä»€ä¹ˆä½ç½®ç±»ä¼¼ï¼Œè·¯ç”±å™¨æ£€æµ‹ IP åè®®ä¸­çš„å±æ€§å†³å®šå°†åŒ…å‘é€åˆ°ä»€ä¹ˆä½ç½®ã€‚è·¯ç”±å™¨å†…éƒ¨æœ‰ä¸ª
è·¯ç”±è¡¨ï¼ŒåŒ…å«ç€å°†æ•°æ®è·¯ç”±åˆ°ä¸–ç•Œä¸Šä¸åŒç½‘ç»œçš„ä¿¡æ¯ã€‚

ä¸åŒçš„è·¯ç”±å™¨ä¹‹é—´é€šè¿‡ BGP(Border Gateway Protocol) åè®®å…±äº«æ•°æ®ï¼Œè¿™ä½¿æ•°æ®çš„å‘é€åŸºäºæœ€ä½³è·¯å¾„ã€‚å½“æ‚¨æ‰“å¼€Webæµè§ˆå™¨å¹¶åŠ è½½ç½‘é¡µæ—¶ï¼Œè®¡ç®—æœºå’ŒWebæœåŠ¡å™¨ä¹‹é—´çš„æµé‡å¯èƒ½ä¼šç»è¿‡æ•°åä¸ªä¸åŒçš„è·¯ç”±å™¨ã€‚ äº’è”ç½‘å¼‚å¸¸åºå¤§ä¸”å¤æ‚ã€‚ è·¯ç”±å™¨æ˜¯å°†æµé‡å¸å¼•åˆ°æ­£ç¡®ä½ç½®çš„å…¨çƒ
æŒ‡å—ã€‚

=== ä¼ è¾“ä»‹è´¨

==== åŒè½´ç”µç¼†

image:img/transimit-1.jpeg[]

ä¼ è¾“é€Ÿç‡ä½ï¼ŒåŸºæœ¬è¢«æ·˜æ±°ã€‚

==== åŒç»çº¿(Twisted Pair) åŒå‘äº¤æµ

* ä¸€ä¸ªæ ‡å‡†çš„ Cat 6 ç”µç¼†ç”± 8 æ ¹é“œçº¿ï¼Œ4 å¯¹åŒç»çº¿ç»„æˆ 
* åŒå‘äº¤æµæŒ‡ç”µç¼†æ”¯æŒåŒå‘ä¼ è¾“ ä¿¡æ¯ã€‚

image:img/cat5e-cat6.jpg[] 

https://en.wikipedia.org/wiki/Ethernet_over_twisted_pair[åŒç»çº¿ä»¥å¤ªç½‘]

image:img/transimit-2.jpeg[]

*ç½‘ç»œæ¥å£å’Œé…çº¿æ¶*

* ä¸€æ ¹ç½‘çº¿é€šå¸¸é€šè¿‡ä¸€ä¸ª RJ-45 æ¥å¤´è¿æ¥åˆ°ä¸€ä¸ª RJ-45 ç½‘ç»œæ¥å£. ç½‘ç»œæ¥å£é€šå¸¸ä¸ç»„æˆè®¡ç®—æœºç½‘ç»œçš„è®¾å¤‡ç›´æ¥è¿æ¥ï¼Œæˆ–æ˜¯è®¾å¤‡çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œä¾‹å¦‚ä»»ä½•ä¸€å°è®¡ç®—æœºéƒ½ä¼šè‡³å°‘æœ‰ä¸€ä¸ªç½‘ç»œæ¥å£ã€‚
* é…çº¿æ¶æ˜¯ä¸€ç§åŒ…å«è®¸å¤šç½‘ç»œç«¯å£çš„è®¾å¤‡ï¼Œä½†æ²¡æœ‰å…¶ä»–ä½œç”¨ï¼Œåªæ˜¯å°†ä¸åŒç½‘ç»œçº¿ç¼†è¿æ¥åˆ°ä¸€èµ·ã€‚ 
  
.*å¸¸è§ç½‘ç»œæ¥å£*
[cols="5a,5a,51"]
|===
|RJ-45 æ’å¤´ |RJ-45 ç½‘ç»œæ¥å£ |é…çº¿æ¶(Patch Panel)

|image:img/rj45.jpg[]

|image:img/rj45port.png[]

|image:img/patch_panel.png[]
|===

==== å…‰çº¤

image:img/transimit-3.jpeg[]

* äº®é»„è‰² - å•æ¨¡å…‰çº¤
* æ©™é»„è‰² - åŒæ¨¡å…‰çº¤

==== ä¸²å£ç”µç¼†

image:img/transimit-4.jpeg[]

=== é“¾è·¯ä¸Šçš„å­—èŠ‚ç§»åŠ¨

* ç‰©ç†å±‚è´Ÿè´£å°†å­—èŠ‚æµï¼ˆ0 æˆ– 1 çš„å­—èŠ‚ç ä¸²ï¼‰ä»é“¾è·¯çš„ä¸€ç«¯ç§»åŠ¨åˆ°å¦ä¸€ç«¯
* ç‰©ç†å±‚æ˜¯ç”±ä¼ è¾“å­—èŠ‚ç çš„è®¾å¤‡å’Œè£…ç½®ç»„æˆ
* ä¸€ä¸ªæ¯”ç‰¹(bit)ä»£è¡¨è®¡ç®—æœºå¯ä»¥æ˜ç™½çš„æœ€å°æ•°æ®ï¼Œå®ƒè¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯ 0ã€‚è¿™äº›åœ¨ç½‘ç»œé“¾è·¯ä¸Šå‘é€çš„ 0 æˆ– 1 çš„å­—èŠ‚ç ä¸²æ˜¯ç»„æˆæ•°æ®å¸§ã€æ•°æ®åŒ…çš„æœ€åº•å±‚å…ƒç´ ï¼Œè¿™äº›å¸§æˆ–åŒ…æ˜¯å…¶ä»–ç½‘ç»œå±‚çš„æ¦‚å¿µã€‚
*  0 æˆ– 1 çš„å­—èŠ‚ç ä¸²åœ¨ç½‘ç»œä¸Šå‘é€æ˜¯é€šè¿‡ä¸€ä¸ªå«è°ƒèŠ‚å™¨(Modulation)çš„ç¨‹åºæ§åˆ¶ï¼Œè°ƒèŠ‚å™¨(Modulation)æ˜¯ä¸€ç§æ”¹å˜ç”µè·åœ¨ç”µç¼†ä¸Šç§»åŠ¨çš„ç”µå‹çš„æ–¹å¼ã€‚å½“ç”¨äºè®¡ç®—æœºç½‘ç»œæ—¶ï¼Œè¿™ç§è°ƒåˆ¶æ–¹å¼æ›´å…·ä½“åœ°ç§°ä¸ºçº¿è·¯ç¼–ç ã€‚å®ƒå…è®¸é“¾è·¯ä¸¤ç«¯çš„è®¾å¤‡äº†è§£æŸç§çŠ¶æ€ä¸‹çš„ç”µè·ä¸º 0ï¼Œè€Œå¦ä¸€
ç§çŠ¶æ€ä¸‹çš„ç”µè·ä¸º 1ã€‚

image:img/line-coding.png[]

=== æ‹¨å·æ¥å…¥

* PSTN(Public Switched Telephone Network) is also referred to as the POTS(Plain Old Telephone Service).
* A dial-up connection uses POTS for data transfer, and gets its name because the connection is established by actually dialing a phone number.
* Modem stands for modulator/demodulator, and they take data that computers can understand and turn them into audible wavelengths that can be transmitted over POTS.
* A baud rate is a measurement of how many bits could be passed across a phone line in a second.

image:img/dial-up-moderms.png[]

=== å®½å¸¦æ¥å…¥

==== What is broadband?

In terms of internet connectivity, it's used to refer to any connectivity technology that isn't dial-up Internet. Broadband Internet is almost always much faster than even the fastest dial-up connections and refers to connections that are always on. This means that they're long lasting connections that don't need to be established with each use. They're essentially links that are always present.

==== T-Carrier Technologies

* T-Carrier Technologies were originally invented by AT&T in order to transmit multiple phone calls over a single link.
* T1 stands for Transmission System 1.
* A T1 communicates at speeds of 1.544 Kb/sec.
* A T3 is just 28 multiplexed T1 lines.

==== Digital Subscriber Lines

* DSL(digital subscriber line) was able to send much more data across the wire than traditional dial-up technologies.
* DSL technologies use DSLAMs or Digital Subscriber Line Access Multiplexers to establish data connections across phone lines.

ä¸¤ç§å¸¸è§çš„ DSL ç±»å‹ï¼š

1. *ADSL* - ADSL stands for Asymmetric Digital Subscriber Line. ADSL connections featured different speeds for outbound and incoming data. Generally, this means faster download speeds and slower upload speeds.
2. *SDSL* - SDSL stands for Symmetric Digital Subscriber Line. SDSL technology is basically the same as ADSL, except the upload and download speeds are the same.

==== Cable Broadband

Cable Internet connections are usually managed by what's known as a cable modem. This is a device that sits at the edge of a consumer's network and connects it to the cable modem termination system, or CMTS. The CMTS is what connects lots of different cable connections to an ISP's core network.

image:img/cable-broadband.png[]

==== Fiber Connections

* FTTN means fiber to the neighborhood that fiber technologies are used to deliver data to a single physical cabinet that serves a certain amount of the population.
* FTTB stands for fiber to the building, fiber to the business or even a fiber to the basement, since this is generally where cables to buildings physically enter.
* FTTH stands for fiber to the home, that is used in instances where fiber is actually run to each individual residents in a neighborhood or apartment building.
* FTTP fiber to the premises, FTTH and FTTB may both also be referred to as FTTP.

Instead of a modem, the demarcation point for fiber technologies is known as Optical Network Terminator, or ONT. An ONT converts data from protocols the fiber network can understand to those that are more traditional twisted pair copper networks can understand.

=== æ— çº¿ç½‘ç»œ(WIFI)

* The most common specifications for how wireless networking devices should communicate, are defined by the IEEE 802.11 standards. This set of specifications, also called the 802.11 family, make up the set of technologies we call WiFi.
* A frequency band is a certain section of the radio spectrum that's been agreed upon to be used for certain communications.
* WiFi networks operate on a few different frequency bands. Most commonly, the 2.4 gigahertz and 5 gigahertz bands. There are lots of 802.11 specifications including some that exist just experimentally or for testing. The most common specifications you might run into are 802.11b, 802.11a, 802.11g, 802.11n, and 802.11ac.

*802.11 frame*

image:img/802.11-frame.png[]

* *Frame Control* - Frame control field is 16 bits long, and contains a number of sub-fields that are used to describe how the frame itself should be processed.
* *Duration ID* - It specifies how long the total frame is. So, the receiver knows how long it should expect to have to listen to the transmission.
* *Address* - There are four address fields, because there needs to be room to indicate which wireless access point should be processing the frame. So, we'd have our normal source address field, which would represent the MAC address of the sending device.
* *Sequence Control* - Sequence control field is 16 bits long and mainly contains a sequence number used to keep track of ordering the frames.
* *Data payload* - Data payload section which has all of the data of the protocols further up the stack.
* *FCS* - Frame check sequence field which contains a checksum used for a cyclical redundancy check.

==== Wireless Channels

Channels are individual, smaller sections of the overall frequency band used by a wireless network.

==== Wireless Security

* WEP stands for Wired Equivalent Privacy, it's an encryption technology that provides a very low level of privacy.
* WPA stabds for Wi-Fi Protected Access, by default, uses a 128-bit key, making it a whole lot more difficult to crack than WEP.
* WPA2,  an update to the original WPA. WPA2 uses a 256-bit key make it even harder to crack.

==== Cellular Networking

Cellular networks are built around the concept of cells. Each cell is assigned a specific frequency band for use.

== æ•°æ®é“¾è·¯å±‚

æ•°æ®é“¾è·¯å±‚å®è´¨ä¸Šæ˜¯å¯¹ç‰©ç†å±‚çš„ä¸€ä¸ªæŠ½è±¡ï¼Œä½¿å…¶ä»–å±‚å¯ä»¥ä¸ç”¨è€ƒè™‘ç‰©ç†å±‚æ‰€ä½¿ç”¨çš„ç¡¬ä»¶æˆ–è®¾å¤‡ï¼Œè€Œå¯ä»¥è¿›è¡Œå‘é€æ•°æ®å’Œæ¥æ”¶æ•°æ®çš„å·¥ä½œï¼Œè¿™æ ·ç¡®ä¿äº†ä¸ç®¡ç‰©ç†å±‚ç¡¬ä»¶æˆ–è®¾å¤‡å¦‚ä½•å˜åŒ–ï¼Œç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€åº”ç”¨å±‚éƒ½åœ¨ç”¨åŒæ ·çš„æ–¹å¼å·¥ä½œã€‚

=== ä»¥å¤ªç½‘åè®®(Ethernet)

* Ethernet æ˜¯ç›®å‰é“¾è·¯å±‚æœ€è¢«å¹¿æ³›ä½¿ç”¨çš„åè®®ï¼Œç”¨æ¥åœ¨å•ä¸ªé“¾è·¯ä¸Šå‘é€æ•°æ®ï¼ŒEthernet æœ€æ—©åœ¨ 1980 å¹´æå‡ºï¼Œ1983 æˆä¸ºæ ‡å‡†ï¼Œåç»­åªæ˜¯åŸºäºå¸¦å®½çš„å¢åŠ ç›¸åº”è¿›è¡Œè¿‡ä¸€äº›å¾®è°ƒã€‚
* Ethernet æ˜¯å½“ä»Šç°æœ‰å±€åŸŸç½‘ï¼ˆLocal Area Network LANï¼‰é‡‡ç”¨çš„æœ€é€šç”¨çš„é€šä¿¡åè®®æ ‡å‡†ï¼Œå®šä¹‰äº†å±€åŸŸç½‘ä¸­é‡‡ç”¨çš„ç”µç¼†ç±»å‹çš„ä¿¡å·å¤„ç†æ–¹æ³•ã€‚
* Ethernet æ˜¯å»ºç«‹åœ¨CSMA/CD(Carrier Sense Multiple Access With Collision Detection, è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®/å†²çªæ£€æµ‹)æœºåˆ¶ä¸Šçš„å¹¿æ’­å‹ç½‘ç»œã€‚ 

==== å…±äº«å¼ä»¥å¤ªç½‘

æ—©æœŸä»¥å¤ªç½‘æ˜¯å…±äº«å¼ç½‘ç»œï¼Œå…±äº«å¼ç½‘ç»œå¯èƒ½ä¼šå‡ºç°ä¿¡å·å†²çªç°è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

image:img/collision-domain.jpeg[]

CSMA/CD(Carrier Sense Multiple Access With Collision Detection, è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®/å†²çªæ£€æµ‹) - CSMA/CD ç”¨äºç¡®å®šé€šä¿¡é€šé“ä½•æ—¶ç•…é€šä»¥åŠè®¾å¤‡ä½•æ—¶è‡ªç”±ä¼ è¾“æ•°æ®ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å†²çªåŸŸã€‚

CSMA/CD çš„å·¥ä½œåŸç†å°±æ˜¯æ£€æµ‹å½“å‰ç½‘æ®µä¸Šæ˜¯å¦æœ‰æ•°æ®ä¼ è¾“ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å‘é€æ•°æ®ï¼›å¦‚æœæœ‰ï¼Œåˆ™ç­‰å¾…ä¸€ä¸ªéšæœºçš„æ—¶é—´é—´éš”ï¼Œç„¶åå°è¯•å†æ¬¡å‘é€æ•°æ®ï¼ŒCSMA/CD ä½¿ç”¨ MAC åœ°å€æ¥ç¡®è®¤ç›®çš„åœ°èŠ‚ç‚¹ã€‚

1. å…ˆå¬åå‘ 
2. è¾¹å¬è¾¹å‘
3. å†²çªåœå‘
4. éšæœºå»¶è¿Ÿåå‘

==== äº¤æ¢å¼ä»¥å¤ªç½‘

å½“å‰çš„ä»¥å¤ªç½‘æ˜¯äº¤æ¢å¼ï¼Œäº¤æ¢æœºè®¾å¤‡å¾ˆå¥½çš„è§£å†³äº†ä¿¡å·å†²çªç°è±¡ï¼Œå› ä¸ºäº¤æ¢æœºæ”¶åˆ°æ•°æ®åä¼šæœ‰æ£€æŸ¥æœºåˆ¶ï¼Œéš”ç¦»å†²çªã€‚

ä¸€ä¸ªäº¤æ¢æœºçš„æ¥å£å°±æ˜¯ä¸€ä¸ª*å†²çªåŸŸ*ï¼›å¹¿æ’­æŠ¥æ–‡æ‰€èƒ½åˆ°è¾¾çš„æ•´ä¸ªè®¿é—®èŒƒå›´ç§°ä¸ºäºŒå±‚å¹¿æ’­åŸŸï¼Œç®€ç§°*å¹¿æ’­åŸŸ*ã€‚

NOTE: äº¤æ¢æœºä¸­æ— æ³•éš”ç¦»å¹¿æ’­åŸŸã€‚

=== MAC åœ°å€

* ä»¥å¤ªç½‘å¡(Network Interface Card NIC)ç®€ç§°ä¸ºä»¥å¤ªç½‘å¡ï¼Œæ¯ä¸€ä¸ªä»¥å¤ªç½‘å¡ä¼šå…³è”ä¸€ä¸ª MAC åœ°å€ã€‚
* MAC(Media Access Control) åœ°å€æ˜¯é™„åŠ åˆ°ä¸€ä¸ªä»¥å¤ªç½‘å¡ä¸Šçš„å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
* MAC åœ°å€æ˜¯ä¸€ä¸ª 48 ä½çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œç”±å…­ç»„äºŒä½çš„åå…­è¿›åˆ¶æ•°å­—æ„æˆï¼Œä¾‹å¦‚ï¼š`8:00:27:c3:0f:80`ã€‚
* MAC åœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†, å‰ä¸‰ç»„åå…­è¿›åˆ¶æ•°æ˜¯ç»„ç»‡å”¯ä¸€æ ‡è¯†ï¼Œæ˜¯ç”± IEEE ç»„ç»‡åˆ†é…ç»™å„ä¸ªç¡¬ä»¶åˆ¶é€ å•†ï¼›åä¸‰ä½å¯ä»¥æŒ‰åˆ¶é€ å•†å¸Œæœ›çš„æ–¹å¼ä»»æ„åˆ†é…ï¼Œåˆ†é…çš„æ¡ä»¶æ˜¯ç¡®ä¿æ¯ä¸ªå¯èƒ½çš„åœ°å€åªåˆ†é…ä¸€æ¬¡ã€‚

image:img/mac_addr-strcture.png[]

==== MAC åœ°å€åˆ†ç±»

è®¡ç®—æœºç½‘ç»œçš„åŒºåŸŸï¼Œå®ƒç”±æ¯ä¸ªå•å°è®¡ç®—æœºæˆ–ä¸ç½‘ç»œè¿æ¥è®¾å¤‡ç»„æˆï¼Œè¯¥åŒºåŸŸå¯ä»¥é€šè¿‡å‘æ•°æ®é“¾è·¯å±‚çš„å¹¿æ’­åœ°å€å‘é€ç®€å•å¸§æ¥ç›´æ¥è®¿é—®ã€‚æ•´ä¸ªèƒ½å¤Ÿç›´æ¥è®¿é—®çš„åŒºåŸŸç§°ä¸ºå¹¿æ’­åŸŸï¼Œå¹¿æ’­åŸŸæ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†ç½‘ç»œä¸­çš„ä»»æ„è®¾è®¡ä¸ç»è¿‡è·¯ç”±ï¼ˆç½‘å…³ï¼‰å¯ç›´æ¥å‘ä»»æ„å…¶ä»–ä¸€ä¸ªè®¾å¤‡å‘é€æ•°æ®ã€‚ä¸€ä¸ªå¹¿æ’­åŸŸä¸­çš„æ‰€æœ‰è®¾å¤‡æˆ–èŠ‚ç‚¹ä½äºåŒä¸€ä¸ª LAN æˆ– VLANã€‚

ä¸€ä¸ª LAN æˆ– VLAN ä¸­ä¸åŒç½‘ç»œèŠ‚ç‚¹é€šä¿¡é€šå¸¸åŒ…æ‹¬ï¼š

* 1 å¯¹ 1ï¼šä¸€ä¸ªèŠ‚ç‚¹å‘é€æ•°æ®åŒ…åªç»™å¦ä¸€ä¸ªèŠ‚ç‚¹
* 1 å¯¹å¤šï¼šä¸€ä¸ªèŠ‚ç‚¹å‘é€æ•°æ®åŒ…ç»™éƒ¨åˆ†èŠ‚ç‚¹
* 1å¯¹æ‰€æœ‰ï¼šä¸€ä¸ªèŠ‚ç‚¹å‘é€æ•°æ®åŒ…ç»™ç½‘ç»œä¸­æ‰€æœ‰èŠ‚ç‚¹

å¯¹åº”è¿™ä¸‰ç§æ–¹å¼ï¼Œ ä¸ºæ”¯æŒè¿™ç§èƒ½åŠ›ï¼ŒMAC åœ°å€åˆ†ä¸ºä¸‰ç±»ï¼Œå•æ’­MACåœ°å€ã€ç»„æ’­MACåœ°å€å’Œå¹¿æ’­MACåœ°å€ã€‚

.*å•æ’­, ç»„æ’­, å¹¿æ’­*
|===
|ç±»å‹ |æ¨¡å¼ |è¯´æ˜

|Unicastï¼ˆå•æ’­ï¼‰
|ä¸€å¯¹ä¸€
|Unicast ä¼ è¾“å§‹ç»ˆæ„å‘³ç€åªæœ‰ä¸€ä¸ªæ¥æ”¶åœ°å€ã€‚MAC åœ°å€ä¸­ç¬¬ä¸€ç»„æ•°å­—çš„æœ€åä¸€ä¸ªäºŒè¿›ä½ä¸º 0ï¼Œåˆ™ Ethernet å¸§å‘é€åˆ°ä¸€ä¸ªåœ°å€ã€‚

|Multicastï¼ˆç»„æ’­ï¼‰
|ä¸€å¯¹å¤š
|Multicast ä¼ è¾“å‘é€åˆ°å¤šä¸ªç‰©ç†åœ°å€ã€‚MAC åœ°å€ä¸­ç¬¬ä¸€ç»„æ•°å­—çš„æœ€åä¸€ä¸ªäºŒè¿›ä½ä¸º 1ï¼Œåˆ™ Ethernet å¸§å‘é€åˆ°å¤šä¸ªåœ°å€ã€‚

|Broadcastï¼ˆå¹¿æ’­ï¼‰
|ä¸€å¯¹æ‰€æœ‰
|Ethernet å¹¿æ’­å‘é€åˆ° LAN ä¸­çš„æ‰€æœ‰åœ°å€ï¼ˆå¹¿æ’­åŸŸï¼‰, MAC åœ°å€çš„æ‰€æœ‰ä½éƒ½ä¸º fã€‚
|===

[source, text]
.*ç¤ºä¾‹ - Unicast MAC åœ°å€*
----
16:91:99:24:68:c9
b6:fe:ee:92:78:42
fa:4e:1b:7f:27:7f
----

å¦‚ä¸Šä¸‰ä¸ªç¤ºä¾‹ MAC åœ°å€ç¬¬ä¸€ç»„ 16 è¿›åˆ¶è½¬åŒ–ä¸º 2 è¿›åˆ¶å¯¹åº”å¦‚ä¸‹ï¼š

* `16` - `00010110`
* `b6` - `10110110`
* `fa` - 11111010

[source, text]
.*ç¤ºä¾‹ - Multicast MAC åœ°å€*
----
6b:b7:22:a4:a4:cb
97:20:82:57:fa:e5
a7:50:c1:30:ca:c1
----

å¦‚ä¸Šä¸‰ä¸ªç¤ºä¾‹ MAC åœ°å€ç¬¬ä¸€ç»„ 16 è¿›åˆ¶è½¬åŒ–ä¸º 2 è¿›åˆ¶å¯¹åº”å¦‚ä¸‹

* `6b` - `01101011`
* `97` - `10010111`
* `a7` - `10100111`

[source, text]
.*ç¤ºä¾‹ - Broadcast MAC åœ°å€*
----
ff:ff:ff:ff:ff:ff
----

=== ä»¥å¤ªç½‘å¸§(Ethernet Frame)

ä»¥å¤ªç½‘(Ethernet)å¸§(Frame)æ˜¯æŒ‰ç‰¹å®šé¡ºåºæ˜¾ç¤ºçš„é«˜åº¦ç»“æ„åŒ–çš„ä¿¡æ¯é›†åˆã€‚è¿™æ ·ï¼Œå¯ä»¥ç¡®ä¿å°†ç‰©ç†å±‚ç½‘ç»œæ¥å£å°†ä¼ è¾“çš„äºŒè¿›åˆ¶ä¸²è½¬åŒ–ä¸ºæœ‰æ„ä¹‰çš„æ•°æ®ï¼Œæˆ–å°†æ•°æ®è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ä¸²ã€‚

image:img/EthernetPacket.png[]

1. The first part of an Ethernet frame is known as the preamble. A preamble is 8 bytes or 64 bits long and can itself be split into two sections. The first seven bytes are a series of alternating ones and zeros. These act partially as a buffer between frames and can also be used by the network interfaces to synchronize internal clocks they use, to regulate the speed at which they send data. This last byte in the preamble is known as the SFD or start frame delimiter. This signals to a receiving device that the preamble is over and that the actual frame contents will now follow.
2. *Destination MAC Address* - ç›®çš„åœ°æ¥æ”¶åœ°å€ç¡¬ä»¶çš„ç‰©ç†åœ°å€ï¼›
3. *Source MAC Address* - ä»¥å¤ªç½‘å¸§å‘é€ç«¯çš„ç‰©ç†åœ°å€ï¼›
4. *Type Field* - 16 äºŒè¿›åˆ¶é•¿åº¦ï¼Œä»¥å¤ªç½‘ç±»å‹æ ‡è¯†å­—æ®µï¼ŒåŒ…æ‹¬å¸§çš„å†…å®¹ï¼›
5. *Payload* - Data payload of an Ethernet frame. A payload in networking terms is the actual data being transported, which is everything that isn't a header. The data payload of a traditional Ethernet frame can be anywhere from 46 to 1500 bytes long.
6. CRC(cyclical redundancy check) checksum, which is a 4-byte or 32-bit number that represents a checksum value for the entire frame.

=== VLAN

ä¸ºäº†è§£å†³å¹¿æ’­åŸŸå¸¦æ¥çš„é—®é¢˜ï¼Œäººä»¬å¼•å…¥äº†VLAN (Virtual Local Area Network)ï¼Œå³è™šæ‹Ÿå±€åŸŸç½‘æŠ€æœ¯ã€‚

=== ARP

ARP æ˜¯æ ¹æ®ç½‘ç»œå±‚ IP åœ°å€å¯»æ‰¾åˆ°å¯¹åº”ç½‘ç»œæ¥å£çš„ MAC åœ°å€ï¼Œæœ‰äº›å½’çº³é‡Œé¢è®² ARP è®¤ä¸ºæ˜¯ç½‘ç»œå±‚åè®®ï¼Œè¯¦ç»†å‚ç…§ link:#_arp_2[ARP]ã€‚

=== LAN vs VLAN

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ

image:img/vlan.png[]

* é€šå¸¸ä¸€ä¸ª 2 å±‚äº¤æ¢è®¾å¤‡ç›¸å½“äºä¸€ä¸ª LANï¼Œ è€ŒVLAN æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„å¹¿æ’­åŸŸï¼Œé€šå¸¸æ˜¯åœ¨ä¸€ä¸ªäºŒå±‚äº¤æ¢è®¾å¤‡ä¸­åˆ›å»ºï¼Œå½“ç„¶ç°ä»£å¤šæ•° 2 å±‚äº¤æ¢è®¾å¤‡ä¹‹é—´å¯ä»¥ç›¸è¿å’Œäº¤æ¢ï¼Œä¸åŒäº¤æ¢æœºä¸‹çš„ VLAN å¯ä»¥ä½äºåŒä¸€ä¸ª VLAN ä¸­ã€‚
* VLAN å¯ä»¥æœ‰æ•ˆçš„é™ä½å¹¿æ’­è´Ÿè½½ï¼Œæé«˜ç½‘ç»œæ€§èƒ½ï¼›ä¼ ç»Ÿä¸Šå¼•å…¥ VLAN å¯ä»¥è¿›è¡Œæ›´å¥½çš„å®‰å…¨ã€åˆ†ç»„ç­‰æ§åˆ¶ï¼Œè€Œä¸”å¤§å¤šæ•° 2 å±‚äº¤æ¢æœºå‚å•†çš„è®¾å¤‡é»˜è®¤å°±æœ‰ VLAN çš„åˆ’åˆ†ï¼›å¦å¤–ï¼Œæ–°çš„ SDNï¼ˆè½¯ä»¶å®šä¹‰çš„ç½‘ç»œï¼‰åªæœ‰ VLAN çš„æ¦‚å¿µã€‚
* ä¸åŒ VLAN ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡è·¯ç”±è®¾å¤‡

=== WAN

ä¸ LAN ç›¸å¯¹åº”ï¼ŒWAN stands for wide area network. A wide area network acts like a single network but spans across multiple physical locations.

NOTE: WAN technologies usually require that you contract a link across the Internet with your ISP. This ISP handles sending your data from one side to the other. So, it could be like all of your computers are in the same physical location.

WAN åè®®ï¼š

* https://en.wikipedia.org/wiki/Frame_Relay[Frame Relay]
* https://en.wikipedia.org/wiki/High-Level_Data_Link_Control[High-Level Data Link Control]
* https://en.wikipedia.org/wiki/Asynchronous_transfer_mode[Asynchronous transfer mode]

=== é“¾è·¯èšåˆ/LACP

é“¾è·¯èšåˆå°±æ˜¯æŠŠå¤šä¸ªé“¾è·¯èšåˆåœ¨ä¸€èµ·ï¼Œå¤šä¸ªç½‘ç»œæ¥å£æŠ½è±¡å‡ºä¸€ä¸ªé€»è¾‘çš„ç½‘ç»œæ¥å£ï¼Œé“¾è·¯èšåˆçš„ç›®çš„æ˜¯å¢åŠ é“¾è·¯çš„å¸¦å®½ï¼Œä¾‹å¦‚ 4 æ¡ 100 MB çš„é“¾è·¯èšåˆåå¸¦å®½æ˜¯ 400 MBã€‚é™¤äº†å¢åŠ å¸¦å®½å¤–ï¼Œé“¾è·¯èšåˆè¿˜å¯ä»¥å¢åŠ å®¹é”™ï¼Œä¾‹å¦‚å½“ä¸€æ¡é“¾è·¯ä¸å¯ç”¨ä¸ä¼šå½±å“æ•´ä½“èšåˆé“¾è·¯çš„å¯ç”¨æ€§ã€‚èšåˆçš„é“¾è·¯æ€»æ•°é€šå¸¸æ˜¯ 2 çš„ N æ¬¡æ–¹ï¼ˆ2ï¼Œ4ï¼Œ8ï¼‰ã€‚

ä¸åŒå‚å•†é“¾è·¯èšåˆæŠ€æœ¯å„å¼‚ï¼ŒF5 BIG-IP é‡‡ç”¨ `trunk` ä»£è¡¨ä¸€ç»„ç½‘ç»œæ¥å£çš„æŠ½è±¡ï¼ŒåŸºäº `trunk`ï¼Œåœ¨ F5 BIG-IP ä¸­æœ€å¤šå¯èšåˆ 8 æ¡é“¾è·¯ã€‚F5 BIG-IP `trunk` ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ MAC åœ°å€ï¼Œè¯¥åœ°å€ç”¨æ¥å’Œ pee è¿›è¡Œé€šä¿¡ã€‚

image:img/link-aggragation.png[]

LACP(Link Aggregation Control Protocol) é“¾è·¯èšåˆæ§åˆ¶åè®®æ˜¯ IEEE æ ‡å‡† 802.3ad å®šä¹‰ï¼Œç”¨æ¥æ£€æµ‹é“¾è·¯çš„é”™è¯¯ï¼Œé‡ä¼ ç­‰æœºåˆ¶ï¼Œä»¥ç¡®ä¿èšåˆçš„é“¾è·¯å¯é ï¼Œå®¹é”™ã€‚

ä¸åŒç½‘è·¯å‚å•† LACP è¡Œä¸ºå¯é™ªï¼Œä¾‹å¦‚ï¼ŒLinux Bonding å°±æ˜¯ä¸€ç§è½¯ä»¶ LACP å®ç°ï¼Œå¯ä»¥çµæ´»é…ç½®è´Ÿè½½åˆ†å‘æ–¹å¼ç­‰ã€‚F5 BIG-IP ç³»ç»Ÿä¸­ LACP æ˜¯ä¸€ä¸ªå¯é€‰é…ç½®ï¼Œå¯ä»¥è‡ªå®šåˆ¶ LACP è¡Œä¸ºï¼Œå¦‚å„ä¸ªé“¾è·¯æ•°æ®ä¼ è¾“æƒé‡ç­‰ï¼Œè¿˜å¯ä»¥é…ç½®ä¸€äº›æ§åˆ¶ç­–ç•¥ã€‚

== ç½‘ç»œå±‚

=== IPv4 æ•°æ®æŠ¥æ–‡ç»“æ„

IPv4 æ•°æ®æŠ¥æ–‡æ˜¯ç”±ä¸€ç³»åˆ—é«˜åº¦ç»“æ„åŒ–çš„å­—æ®µä¸¥æ ¼å®šä¹‰ï¼ŒIP æ•°æ®ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†æ˜¯ header å’Œ payloadã€‚

image:img/ip-datagrams.png[]

* *Version* - ç¬¬ä¸€ä¸ªå­—æ®µé•¿åº¦ä¸º 4 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä»£è¡¨ç€ IP åè®®çš„ç‰ˆæœ¬ã€‚å¸¸è§çš„ IPåè®®ç‰ˆæœ¬æ˜¯ 4ï¼Œå³ IPv4ã€‚
* *Header Length* - Header Length å­—æ®µé•¿åº¦ä¸º 4 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä»£è¡¨ç€æ•´ä¸ª header çš„é•¿åº¦ã€‚å¦‚æœæ˜¯ IPv4ï¼Œåˆ™ Header çš„é•¿åº¦æ°¸è¿œéƒ½æ˜¯ 20ï¼Œäº‹å®ä¸Šï¼Œ20 ä¸ªå­—èŠ‚æ˜¯ IP header çš„æœ€å°é•¿åº¦ï¼Œä½ ä¸èƒ½åœ¨å°äº 20 è‡ªå·±çš„ç©ºé—´é‡Œåˆé€‚çš„æè¿°ä¸€ä¸ª IP Headerã€‚
* *Service Type* - Service Type å­—æ®µé•¿åº¦ä¸º 8 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œç”¨æ¥æŒ‡å®š QoS æŠ€æœ¯çš„è¯¦ç»†æƒ…å†µã€‚QoS çš„ä½œç”¨æ˜¯å…è®¸è·¯ç”±å™¨ä½œå‡ºå†³ç­–ï¼Œåœ¨ä¸€ç³»åˆ— IP æ•°æ®æŠ¥æ–‡ä¸­ï¼Œé€‰æ‹©å‡ºæœ€ä¸ºé‡è¦çš„ä¸€ä¸ªæ•°æ®æŠ¥æ–‡ã€‚
* *Total Length* - Total Length å­—æ®µé•¿åº¦ä¸º 16 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œç”¨æ¥è¡¨ç¤º IP æ•°æ®æŠ¥æ–‡çš„æ•´ä½“é•¿åº¦ã€‚å•ä¸ªæ•°æ®æŠ¥æ–‡çš„æœ€å¤§é•¿åº¦ä¸º 16 ä¸ªäºŒè¿›åˆ¶ä½éƒ½ä¸º 1ï¼Œå³ä¸º 65,535ã€‚
* *Identification* - Identification å­—æ®µé•¿åº¦ä¸º 16 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œç”¨æ¥å°†æ¶ˆæ¯åˆ†ç»„åœ¨ä¸€èµ·ï¼Œå½“è¦å‘é€çš„æ•°æ®å¤§äºå•ä¸ªæ•°æ®æŠ¥æ–‡å…è®¸çš„æœ€å¤§å€¼æ—¶ï¼Œåˆ™ IP å±‚éœ€è¦å°†åŸå§‹çš„å¤§çš„æ•°æ®åŒ…åˆ†å‰²æˆå‡ ä¸ªå°çš„æ•°æ®åŒ…ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ Identification å­—æ®µç”¨æ¥è¢«æ¥æ”¶ç«¯æ ‡è¯†åˆ†å‰²åçš„
æ•°æ®åŒ…å±äºåŒä¸€ä¸ªæ•°æ®åŒ…ã€‚
* *Flag* - Flag å­—æ®µç”¨æ¥æ ‡è¯†æ•°æ®æŠ¥æ–‡æ˜¯å¦å…è®¸åˆ†æ®µï¼Œæˆ–è€…æ ‡è¯†æ•°æ®æŠ¥æ–‡å·²ç»åˆ†æ®µã€‚
* *Fragmentation* - æ˜¯å°†ä¸€ä¸ªå¤§çš„ IP æ•°æ®æŠ¥æ–‡åˆ†å‰²æˆå¤šä¸ªå°çš„æ•°æ®æŠ¥æ–‡çš„è¿›ç¨‹ã€‚
* *TTL* - TTL å­—æ®µçš„é•¿åº¦ä¸º 8 ä¸ªäºŒè¿›åˆ¶ä½ï¼ŒæŒ‡å®šä¸€ä¸ªæ•°æ®æŠ¥æ–‡åœ¨ç»è¿‡å¤šå°‘ä¸ªè·¯ç”±è·³è½¬åä¸¢å¼ƒã€‚
* *Protocol* - Protocol å­—æ®µçš„é•¿åº¦ä¸º 8 ä¸ªäºŒè¿›åˆ¶ä½ï¼ŒåŒ…å«æ•°æ®æ ‡è¯†é‚£ä¸ªä¼ è¾“å±‚çš„åè®®è¢«ä½¿ç”¨ï¼Œæœ€å¸¸è§çš„ä¼ è¾“å±‚åè®®æ˜¯ TCP æˆ– UDPã€‚
* *Header Checksum* - Header checksum å­—æ®µç”¨æ¥å¯¹æ•´ä¸ª IP æ•°æ®æŠ¥æ–‡ headerè¿›è¡Œæ ¡éªŒï¼Œå®ƒå’Œ Ethernet Checksum å­—æ®µç±»ä¼¼ï¼Œé€šå¸¸ç”±äº TTL å­—æ®µç»è¿‡ä»»æ„ä¸€ä¸ªè·¯ç”±å™¨æ—¶éƒ½ä¼šè¢«ä¿®æ”¹ï¼ŒHeader Checksum å­—æ®µç›¸åº”çš„ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚
* *Source IP Address* - é•¿åº¦ä¸º 32 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä»£è¡¨ç€æº IP åœ°å€ã€‚
* *Destination IP Address* - é•¿åº¦ä¸º 32 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä»£è¡¨ç€ç›®çš„åœ° IP åœ°å€ã€‚
* *Option* - å¯é€‰çš„å­—æ®µï¼Œç”¨æ¥è®¾å®šä¸€äº›ç‰¹å®šå­—ç¬¦ï¼Œé€šå¸¸ç”¨äºæµ‹è¯•ç›®çš„ã€‚
* *Padding* - ç›¸å½“äºä¸€ä¸ªå ä½ç¬¦å­—æ®µï¼Œç”±äº Option å­—æ®µæ—¶å¯é€‰çš„ä¸€ä¸ªå˜é‡ï¼Œé•¿åº¦ä¸å®šï¼Œè¯¥å­—æ®µåªæ˜¯ä¸€äº› 0 ä¸²ï¼Œç”¨æ¥ç¡®ä¿ Header çš„æ•´ä½“é•¿åº¦ã€‚

=== IPv4 åœ°å€

image:img/ipv4address-netmask.png[ipv4address-netmask.png]

* IPv4 åœ°å€é•¿åº¦ä¸º 32 ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œç”± 4 ç»„åè¿›åˆ¶æ•°ç»„æˆï¼Œ4 ç»„åè¿›åˆ¶æ•°ä¹‹é—´é€šè¿‡åœ†ç‚¹è¿æ¥
* IPv4 åœ°å€æœ‰ä¸¤éƒ¨ç»„æˆï¼šç½‘ç»œéƒ¨åˆ†(Network)å’Œä¸»æœºéƒ¨åˆ†(Host)ï¼ŒåŒä¸€å­ç½‘çš„æ‰€æœ‰ä¸»æœºå¯ä»¥ä¸ç»è¿‡è·¯ç”±è€Œè¿é€šå½¼æ­¤ï¼ŒåŒä¸€å­ç½‘ä¸­ä¸»æœºéƒ¨åˆ†å”¯ä¸€ã€‚
* å­ç½‘æ©ç ç”¨æ¥åŒºåˆ†ç½‘ç»œéƒ¨åˆ†å’Œä¸»æœºéƒ¨åˆ†ï¼Œå¦‚ä¸Šå›¾ï¼Œ10.66.192.36 å­ç½‘æ©ç ä¸º 255.255.0.0ï¼Œå³å‰ç¼€æ˜¯ 16ï¼Œåˆ™ä¸º 10.66 ç½‘æ®µã€‚
* å¹¿æ’­åœ°å€ï¼šå½“ä¸»æœºéƒ¨åˆ†æ‰€æœ‰ä¸ºä½ç½®ä¸º1æ˜¯å°±ä¸ºå¹¿æ’­åœ°å€ï¼Œå¦‚ä¸Šä¸¤ä¸ªåœ°å€çš„å¹¿æ’­åœ°å€åˆ†åˆ«ä¸º 192.168.1.255ï¼Œ10.66.255.255.
* IPv4 åœ°å€èŒƒå›´ 0.0.0.0 - 255.255.255.255ã€‚

[source, text]
.*ç¤ºä¾‹ï¼šIBM IP åœ°å€ï¼Œ9 æ˜¯ç½‘ç»œåœ°å€ï¼Œ100.100.100 æ˜¯ä¸»æœºåœ°å€*
----
9.100.100.100
----

==== äºŒè¿›åˆ¶å’Œåè¿›åˆ¶è½¬æ¢

image:img/bits2decimal.png[]

==== IPv4 åœ°å€åˆ†ç±» 

ä¸ºäº†æ›´å¥½çš„ç®¡ç†äº’è”ç½‘ç½‘ç»œï¼ŒIPv4 åœ°å€è¢«åˆ†ä¸ºäº”ä¸ªç±»å‹ï¼šAã€Bã€Cã€Dã€Eï¼Œåœ°å€åˆ†ç±»æ˜¯ä»ä¸¤ä¸ªç»´åº¦è¿›è¡Œï¼ˆæˆ–ä¾èµ–ä¸¤ä¸ªåŸåˆ™ï¼‰ï¼š

* ä»¥ç¬¬ä¸€ä¸ªåè¿›åˆ¶æ•°å­—çš„èŒƒå›´ä½œä¸ºåŸºå‡†åˆ’åˆ†ï¼š
** 0 - 127 ä¸º A ç±»åœ°å€
** 128 - 191 ä¸º B ç±»åœ°å€
** 192 - 223 ä¸º C ç±»åœ°å€
** 224 - 239 ä¸º D ç±»åœ°å€
** 240 - 255 ä¸º E ç±»åœ°å€
* ä»¥ç½‘ç»œéƒ¨åˆ†å’Œä¸»æœºéƒ¨åˆ†ä½œä¸ºåŸºå‡†çš„åˆ’åˆ†ï¼š
** A ç±»åœ°å€åªæœ‰ç¬¬ä¸€ç»„ä¸ºç½‘ç»œåœ°å€ï¼Œåé¢ä¸‰ç»„ä¸ºä¸»æœºåœ°å€
** B ç±»åœ°å€å‰ä¸¤ç»„ä¸ºç½‘ç»œåœ°å€ï¼Œåä¸¤ç»„ä¸ºä¸»æœºåœ°å€
** C ç±»åœ°å€å‰ä¸‰ç»„ä¸ºç½‘ç»œåœ°å€ï¼Œåä¸€ç»„ä¸ºä¸»æœºåœ°å€ 

å¯¹æ¯” IPv4 åœ°å€çš„äºŒè¿›åˆ¶è¡¨è¿°å’Œåè¿›åˆ¶è¡¨è¿°å¯ä»¥å¸®åŠ©ç†è§£ IPv4 åœ°å€åˆ†ç±»ï¼š

image:img/ipv4-classing.png[]

.*IPv4 åœ°å€åˆ†ç±»*
|===
|ç±»å‹ |æè¿° |èŒƒå›´ |æœ€å¤§ä¸»æœºæ•°

|A
|ç¬¬ä¸€ä½åè¿›åˆ¶æ•°ç”¨æ¥åšç½‘ç»œåœ°å€ï¼Œåé¢ä¸‰ä½åè¿›åˆ¶æ•°ç”¨æ¥åšä¸»æœºåœ°å€ï¼›ä»¥äºŒè¿›åˆ¶è¡¨è¿°ï¼Œç¬¬ä¸€ä½ä»¥ 0 å¼€å¤´ï¼Œå³äºŒè¿›åˆ¶èŒƒå›´ä¸º 00000000 - 01111111
|0.0.0.0 - 127.255.255.255
|16 M

|B
|å‰ä¸¤ä½åè¿›åˆ¶æ•°ç”¨æ¥åšç½‘ç»œåœ°å€ï¼Œåé¢äºŒä½åè¿›åˆ¶æ•°ç”¨æ¥åšä¸»æœºåœ°å€ï¼›ä»¥äºŒè¿›åˆ¶è¡¨è¿°ï¼Œç¬¬ä¸€ä½ä»¥ 10 å¼€å¤´ï¼Œå³äºŒè¿›åˆ¶èŒƒå›´ä¸º 10000000 - 10111111
|128.0.0.0 - 191.255.255.255
|64000

|C
|å‰ä¸‰ä½åè¿›åˆ¶æ•°ç”¨æ¥åšç½‘ç»œåœ°å€ï¼Œåé¢ä¸€ä½åè¿›åˆ¶æ•°ç”¨æ¥åšä¸»æœºåœ°å€ï¼›ä»¥äºŒè¿›åˆ¶è¡¨è¿°ï¼Œç¬¬ä¸€ä½ä»¥ 110 å¼€å¤´ï¼Œå³äºŒè¿›åˆ¶èŒƒå›´ 11000000 -  11011111
|192.0.0.0 - 223.255.255.255
|254

|Class D
|ä»¥äºŒè¿›åˆ¶è¡¨è¿°ï¼Œç¬¬ä¸€ä½ä»¥ 1110 å¼€å¤´ï¼Œç”¨äºå¤šæ’­é€šä¿¡ï¼Œå³ä¸€ä¸ª IPæ•°æ®æŠ¥æ–‡å¯ä»¥å‘é€åˆ° å¤šä¸ªåœ°å€
|224.0.0.0 - 239.255.255.255
|

|Class E
|ä»¥äºŒè¿›åˆ¶è¡¨è¿°ï¼Œç¬¬ä¸€ä½ä»¥ 1111 å¼€å¤´ï¼Œé¢„ä¿ç•™åˆ†ç±»ï¼Œä¾›ä»¥åä½¿ç”¨
|240.0.0.0 - 255.255.255.255
|
|===

==== ä¸èƒ½åˆ†é…ç»™ç½‘ç»œè®¾å¤‡åœ°å€

ä¸æ˜¯æ‰€æœ‰çš„ IP åœ°å€å¯ä»¥åˆ†é…ç»™ç½‘ç»œè®¾å¤‡ï¼Œå¦‚ä¸‹ä¸€äº›åœ°å€å±é¢„ç•™åœ°å€ï¼Œä¸èƒ½åˆ†é…ç»™ç½‘ç»œè®¾å¤‡ï¼š

* *0.0.0.0* : ä»£è¡¨æ‰€æœ‰ç½‘ç»œ
* *127.0.0.0 - 127.255.255.255* : loopback æœ¬åœ°æµ‹è¯•åœ°å€
* *224.0.0.0 - 239.255.255.255* : ç±»å‹ D å¤šæ’­é€šä¿¡é¢„ç•™åœ°å€
* *240.0.0.0 - 255.255.255.254* : ç±»å‹ E é¢„ç•™åœ°å€æ®µï¼Œæœªæ¥ä½¿ç”¨
* *255.255.255.255* : ä»£è¡¨æ‰€æœ‰ä¸»æœº
* ç½‘ç»œåœ°å€å’Œå¹¿æ’­åœ°å€
** ä¸€ä¸ªç½‘ç»œä¸­çš„ç¬¬ä¸€ä¸ªåœ°å€ç§°ä¸ºç½‘ç»œåœ°å€ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªç½‘ç»œï¼Œè¿™ä¸ªä¸ªåœ°å€æ˜¯ç½‘ç»œé¢„ç•™åœ°å€
** ä¸€ä¸ªç½‘ç»œä¸­æœ€åä¸€ä¸ªåœ°å€ç§°ä¸ºå¹¿æ’­åœ°å€ï¼Œæ˜¯ä¸€ä¸ªåœ°å€æ˜¯å¹¿æ’­åœ°å€ï¼Œç”¨äºå‘è¯¥ç½‘ç»œä¸­æ‰€æœ‰ä¸»æœºå‘é€æ•°æ®çš„ç‰¹æ®Šåœ°å€
** ä¾‹å¦‚ 10.1.10.0/24 ç½‘ç»œï¼Œ10.1.10.0 æ˜¯ç½‘ç»œé¢„ç•™åœ°å€ï¼Œ10.1.10.255 æ˜¯å¤šæ’­åœ°å€ã€‚

å‚ç…§ link:https://zh.wikipedia.org/wiki/åˆ†ç±»ç½‘ç»œ[ğŸ”—]äº†è§£æ›´å¤šå…³äºç½‘ç»œåˆ†ç±»ã€‚

==== ä¸å¯è·¯ç”±çš„åœ°å€

ä¸å¯è·¯ç”±çš„åœ°å€ç©ºé—´æ˜¯ä¸€äº› IP èŒƒå›´ï¼Œå¯ä»¥è¢«ä»»ä½•äººä½¿ç”¨ï¼Œä½†æ˜¯ä¸èƒ½è·¯ç”±ã€‚ä¸æ˜¯æ¯å°æ¯å°è¿æ¥åˆ° Internet çš„è®¡ç®—æœºéƒ½éœ€è¦èƒ½å¤Ÿä¸å…¶ä»–è¿æ¥åˆ° Internet çš„è®¡ç®—æœºè¿›è¡Œé€šä¿¡ï¼Œä¸å¯è·¯ç”±çš„åœ°å€ä¸ºè¿™ä¸€éœ€æ±‚è€Œå®šï¼Œæ­¤ç±»èŠ‚ç‚¹æ„æˆçš„ç½‘ç»œä»–ä»¬å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œä½†æ²¡æœ‰ç½‘å…³è·¯ç”±å™¨ä¼šå°
è¯•å°†æµé‡è½¬å‘åˆ°æ­¤ç±»ç½‘ç»œã€‚

å¯¹åº” IPv4åœ°å€èŒƒå›´ï¼Œä¸å¯è·¯ç”±çš„åœ°å€ç©ºé—´ä¸»è¦æœ‰ä¸‰ä¸ªèŒƒå›´ï¼š

.*ä¸å¯è·¯ç”±çš„IPv4åœ°å€*
|===
|æ‰€å±åˆ†ç±» |ç½‘ç»œ |åœ°å€èŒƒå›´
|A
|10.0.0.0/8
|10.0.0.0 - 10.255.255.255.255
|B
|172.16.0.0/12
|172.16.0.0 - 172.31.255.255
|C
|192.168.0.0/16
|192.168.0.0 - 192.168.255.255
|===

NOTE: è¯¦ç»†å‚ç…§ http://www.ietf.org/ã€‚

=== å­ç½‘åˆ’åˆ†

â€œæœ‰ç±»ç¼–å€â€çš„åœ°å€åˆ’åˆ†è¿‡äºæ­»æ¿ï¼Œåˆ’åˆ†çš„é¢—ç²’åº¦å¤ªå¤§ï¼Œä¼šæœ‰å¤§é‡çš„ä¸»æœºå·ä¸èƒ½è¢«å……åˆ†åˆ©ç”¨ï¼Œä»è€Œé€ æˆäº†å¤§é‡çš„IPåœ°å€èµ„æºæµªè´¹ã€‚å› æ­¤å¯ä»¥åˆ©ç”¨å­ç½‘åˆ’åˆ†æ¥å‡å°‘åœ°å€æµªè´¹ï¼Œå°†ä¸€ä¸ªå¤§çš„æœ‰ç±»ç½‘ç»œï¼Œåˆ’åˆ†æˆè‹¥å¹²ä¸ªå°çš„å­ç½‘ï¼Œä½¿å¾—IPåœ°å€çš„ä½¿ç”¨æ›´ä¸ºç§‘å­¦ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å®Œæˆå­ç½‘åˆ’åˆ†ã€‚

å¦‚æœä¸€ä¸ª IPv4 åœ°å€ å±äº A ç±»æˆ– Bç±»åœ°å€ï¼Œåˆ™å¯èƒ½å­˜åœ¨çš„æœ€å¤§ä¸»æœºè¾ƒå¤šï¼Œè¿™å°±éœ€è¦å­ç½‘æ¥è¿›ä¸€æ­¥åˆ†ç»„æˆè¾ƒå°çš„ç½‘ç»œï¼Œè¿™å°±å«åšå­ç½‘ã€‚

==== å­ç½‘æ©ç 

å­ç½‘æ©ç é•¿åº¦ä¹Ÿä¸º 32 ä½äºŒè¿›åˆ¶æ•°ï¼Œé€šå¸¸ç”± 4 ç»„åè¿›åˆ¶æ•°ç»„æˆï¼Œ4 ç»„åè¿›åˆ¶æ•°ä¹‹é—´é€šè¿‡åœ†ç‚¹è¿æ¥ï¼ŒäºŒè¿›åˆ¶è¡¨è¿°ï¼Œå­ç½‘æ©ç ç”±è¿ç»­çš„ 1 å’Œ è¿ç»­çš„ 0 æ„æˆï¼Œé€šå¸¸å­ç½‘æ©ç ç”±åè¿›åˆ¶è¡¨è¿°ï¼Œä¾‹å¦‚ä¸‹è¡¨ä¸ºä¸€äº›å­ç½‘æ©ç äºŒè¿›åˆ¶å’Œåè¿›åˆ¶ç¤ºä¾‹ï¼š

.*å­ç½‘æ©ç *
|===
|äºŒè¿›åˆ¶ |åè¿›åˆ¶

|11111111.11111111.11111111.00000000
|255.255.255.0

|11111111.11111111.00000000.00000000
|255.255.0.0

|11111111.00000000.00000000.00000000
|255.0.0.0

|11111111.11111111.11111110.00000000
|255.255.254.0

|11111111.11111111.11111100.00000000
|255.255.252.0

|11111111.11111111.11111000.00000000
|255.255.248.0

|11111111.11111111.11110000.00000000
|255.255.240
|===

*å­ç½‘æ©ç ç¤ºä¾‹*

image:img/ip-subnetmask.png[]

==== CIDR(classless inter-domain routing)

CIDR æ˜¯æè¿° IP åœ°å€çš„ä¸€ç§æ›´åŠ çµæ´»çš„æ–¹æ³•ï¼Œä»¥æ–œæ  + æ•°å­—æ¥è¡¨ç¤ºæ©ç é•¿åº¦ï¼Œè¿™æ ·å¯¹å­ç½‘çš„åˆ’åˆ†æ›´åŠ æ˜“è¯»ã€‚

https://ipaddressguide.com/cidr

.*CIRD*
|===
|äºŒè¿›åˆ¶ |åè¿›åˆ¶ | CIDR

|11111111.11111111.11111111.00000000
|255.255.255.0
|/24

|11111111.11111111.00000000.00000000
|255.255.0.0
|/16

|11111111.00000000.00000000.00000000
|255.0.0.0
|/8

|11111111.11111111.11111110.00000000
|255.255.254.0
|/23

|11111111.11111111.11111100.00000000
|255.255.252.0
|/22

|11111111.11111111.11111000.00000000
|255.255.248.0
|/21

|11111111.11111111.11110000.00000000
|255.255.240
/20
|===

.*CIRD /30 ç¤ºä¾‹*
|===
|CIDR |Netmask |First IP |Last IP

|10.1.10.0/30
|255.255.255.252
|10.1.10.0
|10.1.10.3

|10.1.10.4/30
|255.255.255.252
|10.1.10.4
|10.1.10.7

|10.1.10.8/30
|255.255.255.252
|10.1.10.8
|10.1.10.11

|10.1.10.12/30
|255.255.255.252
|10.1.10.12
|10.1.10.15

|10.1.10.16/30
|255.255.255.252
|10.1.10.16
|10.1.10.19

|10.1.10.20/30
|255.255.255.252
|10.1.10.20
|10.1.10.23

|10.1.10.24/30
|255.255.255.252
|10.1.10.24
|10.1.10.27

|10.1.10.28/30
|255.255.255.252
|10.1.10.28
|10.1.10.31

|10.1.10.32/30
|255.255.255.252
|10.1.10.32
|10.1.10.35

|10.1.10.36/30
|255.255.255.252
|10.1.10.36
|10.1.10.39

|10.1.10.40/30
|255.255.255.252
|10.1.10.40
|10.1.10.43

|10.1.10.44/30
|255.255.255.252
|10.1.10.44
|10.1.10.47

|10.1.10.48/30
|255.255.255.252
|10.1.10.48
|10.1.10.51

|10.1.10.52/30
|255.255.255.252
|10.1.10.52
|10.1.10.55

|10.1.10.56/30
|255.255.255.252
|10.1.10.56
|10.1.10.59

|10.1.10.60/30
|255.255.255.252
|10.1.10.60
|10.1.10.63

|10.1.10.64/30
|255.255.255.252
|10.1.10.64
|10.1.10.67

|10.1.10.68/30
|255.255.255.252
|10.1.10.68
|10.1.10.71

|10.1.10.72/30
|255.255.255.252
|10.1.10.72
|10.1.10.75

|10.1.10.76/30
|255.255.255.252
|10.1.10.76
|10.1.10.79

|10.1.10.80/30
|255.255.255.252
|10.1.10.80
|10.1.10.83

|10.1.10.84/30
|255.255.255.252
|10.1.10.84
|10.1.10.87

|10.1.10.128/30
|255.255.255.252
|10.1.10.128
|10.1.10.131

|10.1.10.240/30
|255.255.255.252
|10.1.10.240
|10.1.10.243

|10.1.10.244/30
|255.255.255.252
|10.1.10.244
|10.1.10.247

|10.1.10.248/30
|255.255.255.252
|10.1.10.248
|10.1.10.251

|10.1.10.252/30
|255.255.255.252
|10.1.10.252
|10.1.10.255
|===

.*CIRD /27 ç¤ºä¾‹*
|===
|CIDR |Netmask |First IP |Last IP

|10.1.10.0/27
|255.255.255.224
|10.1.10.0
|10.1.10.31

|10.1.10.32/27
|255.255.255.224
|10.1.10.32
|10.1.10.63

|10.1.10.64/27
|255.255.255.224
|10.1.10.64
|10.1.10.95

|10.1.10.96/27
|255.255.255.224
|10.1.10.96
|10.1.10.127

|10.1.10.128/27
|255.255.255.224
|10.1.10.128
|10.1.10.159

|10.1.10.160/27
|255.255.255.224
|10.1.10.160
|10.1.10.191

|10.1.10.192/27
|255.255.255.224
|10.1.10.192
|10.1.10.223

|10.1.10.224/27
|255.255.255.224
|10.1.10.224
|10.1.10.255
|===

=== ICMP

ICMP(Internet Control Message Protocol)æ˜¯IPåè®®çš„è¾…åŠ©ååè®®ï¼Œç”¨æ¥åœ¨ç½‘ç»œè®¾å¤‡é—´ä¼ é€’å„ç§å·®é”™å’Œæ§åˆ¶ä¿¡æ¯ï¼Œå¯¹äºæ”¶é›†å„ç§ç½‘ç»œä¿¡æ¯ã€è¯Šæ–­å’Œæ’é™¤å„ç§ç½‘ç»œæ•…éšœç­‰æ–¹é¢èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚

.*ICMP packet Struct:*
image:img/icmp-struct.png[]

* *Type* - Type field is eight bits long which specifies what type of message is being delivered.
* *Code* - Code field indicates a more specific reason for the message than just the type.
* *Checksum* - Checksum is 16 bit length, that works like every other checksum field in other frame, like Ethernet frame, IP datagram and TCP segment.
* *Rest of header* - A 32 bit field with an uninspired name, this field is optionally used by some of the specific types and codes to send more data.
* *Data payload* - Data payload for an ICMP packet exists entirely so that the recipient of the message knows which of their transmissions caused the error being reported.

.*Type/Code å¯¹ç…§è¡¨*
|===
|Type |Code |æè¿°
|0
|0
|Echo Reply

|3
|0
|ç½‘ç»œä¸å¯è¾¾

|3
|1
|ä¸»æœºä¸å¯è¾¾

|3
|2
|åè®®ä¸å¯è¾¾

|3
|3
|ç«¯å£ä¸å¯è¾¾

|5
|0
|é‡å®šå‘

|8
|0
|Echo Request
|===

=== ARP

* ARP(Address Resolution Protocol) åè®®ç”¨æ¥é€šè¿‡ç‰¹å®šçš„ IP åœ°å€å‘ç°è¯¥ IP åœ°å€å¯¹åº”çš„ç¡¬ä»¶è®¾å¤‡çš„ MAC åœ°å€ã€‚
* é€šå¸¸ç½‘ç»œè®¾å¤‡éƒ½æœ‰ä¸€ä¸ª ARP è¡¨ï¼ŒARP è¡¨ä¸­åŒ…å«ç€ä¸€ç³»åˆ— IP åœ°å€ä¸ MAC åœ°å€å¯¹åº”çš„æ¡ç›®ã€‚ARP è¡¨ä¸­æ¡ç›®é€šå¸¸ ä¼šåœ¨è¾ƒçŸ­çš„æ—¶é—´åè¿‡æœŸï¼Œä»¥ç¡®ä¿ç½‘ç»œè®¾å¤‡åŠæ—¶æ„ŸçŸ¥åˆ°ç½‘ç»œçš„å˜æ›´ã€‚

==== tcpdump æŠ“å» ARP åŒ…

å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é€šä¿¡åœºæ™¯ï¼Œæœ¬éƒ¨åˆ†é€šå¸¸ `arp` åç§°å’Œ `tcpdump` å‘½ä»¤æŠ“å– ARP åŒ…ï¼Œå¹¶æŸ¥çœ‹ IP å’Œ MAC æ˜ å°„åˆ—è¡¨ã€‚

* å®¢æˆ·ç«¯ä¸»æœº client.example.com, IP ä¸º 192.168.33.101
* æœåŠ¡ç«¯ä¸»æœº server.example.com, IP ä¸º 192.168.33.201

[source, bash]
.*1. å®¢æˆ·ç«¯åˆ é™¤æœåŠ¡å™¨ç«¯è®°å½•*
----
sudo arp -d server.example.com
----

[source, bash]
.*2. å®¢æˆ·ç«¯æ‰§è¡Œ ping æœåŠ¡å™¨ç«¯å‘½ä»¤ï¼Œä¼šè§¦å‘å®¢æˆ·ç«¯ å‘æœåŠ¡å™¨ç«¯å‘é€ ARP åŒ…*
----
ping 192.168.33.201 -c3
----

[source, bash]
.*3. å®¢æˆ·ç«¯æŸ¥çœ‹ ARP è¡¨*
----
$ arp -e -i eth1
Address                  HWtype  HWaddress           Flags Mask            Iface
192.168.33.1             ether   0a:00:27:00:00:05   C                     eth1
server.example.com       ether   08:00:27:c3:0f:80   C                     eth1
----

NOTE: å¦‚ä¸Šè¯´æ˜æœåŠ¡å™¨ç«¯ MAC åœ°å€ä¸º `08:00:27:c3:0f:80`ã€‚

[source, bash]
.*4. æœåŠ¡å™¨ç«¯æŠ“åŒ…*
----
$ sudo tcpdump -vvv -nn -w arp.cap -i eth1 arp
$ tcpdump -r arp.cap 
reading from file arp.cap, link-type EN10MB (Ethernet)
02:09:34.895590 ARP, Request who-has server.example.com tell 192.168.33.101, length 46
02:09:34.895609 ARP, Reply server.example.com is-at 08:00:27:c3:0f:80 (oui Unknown), length 28
----

NOTE: æŠ“åŒ…ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒARP è¯·æ±‚åŒ…ä¸­å†…å®¹æ¯”è¾ƒç›´æ¥ï¼Œè¯¢é—® `server.example.com` çš„ MAC åœ°å€ï¼Œå¹¶è¦æ±‚å‘Šè¯‰å®¢æˆ·ç«¯ `192.168.33.101`ï¼›æœåŠ¡ç«¯çš„å›å¤ä¹Ÿæ¯”è¾ƒç›´æ¥ï¼Œå‘Šè¯‰äº†å®¢æˆ·ç«¯ï¼Œ`server.example.com` çš„ MAC åœ°å€ä¸º `08:00:27:c3:0f:80`

[source, bash]
.*5. æœåŠ¡å™¨ç«¯æŸ¥çœ‹ MAC åœ°å€ï¼ŒéªŒè¯ä¸ä¸Šé¢ç¬¬ 3 æ­¥ä¸­å®¢æˆ·ç«¯ ARP è¡¨ä¸­ä»¥åŠç¬¬ 4 æ­¥æŠ“åŒ…ä¸­è·å–çš„ MAC åœ°å€æ˜¯å¦ç›¸åŒ*
----
$ ip addr show eth1 | grep ether
    link/ether 08:00:27:c3:0f:80 brd ff:ff:ff:ff:ff:ff
----

*6. è¯¦ç»†åˆ†æ ARP è¯·æ±‚åŒ…*

image:img/arp-request.png[]

* Ethernet å¸§çš„ç›®çš„åœ°å€æ˜¯ä¸€ä¸ªå¹¿æ’­åœ°å€ `ff:ff:ff:ff:ff:ff`
* Ethernet å¸§çš„ç±»å‹ä¸º ARPï¼Œå³ Ethernet å¸§çš„æ•°æ® Payload ä¸º ARP è¯·æ±‚åŒ…
* ARP è¯·æ±‚ç¡¬ä»¶åè®®ä¸º Ethernetï¼Œç±»å‹ä¸º IPv4
* ARP è¯·æ±‚å‘é€è€…çš„ IP `192.168.33.101`ï¼Œç›®çš„è€…çš„ IP `192.168.33.201`

=== è·¯ç”±

==== è·¯ç”±å™¨

è·¯ç”±å™¨æ˜¯ç½‘ç»œå±‚è®¾å¤‡ï¼ˆä¸‰å±‚ç½‘ç»œè®¾å¤‡ï¼‰ï¼Œå®ƒæ ¹æ®æ•°æ®åŒ…çš„ç›®çš„åœ°å€è½¬å‘ç›¸åº”çš„æ•°æ®åŒ…ï¼Œå°†è¿™ä¸€æ•°æ®åŒ…çš„è½¬å‘è¿‡ç¨‹ç§°ä¸ºè·¯ç”±ã€‚ä¸€ä¸ªè·¯ç”±å™¨è®¾å¤‡è‡³å°‘æœ‰ä¸¤ä¸ªç½‘ç»œæ¥å£ï¼Œå› ä¸ºè·¯ç”±å™¨å·¥ä½œæœºåˆ¶è‡³å°‘éœ€è¦è¿æ¥è¿ä¸ªç½‘ç»œã€‚

==== è·¯ç”±çš„åŸºæœ¬è¿‡ç¨‹

ä¸‹å›¾æè¿°äº†ä½äºä¸åŒç½‘ç»œçš„ PC é€šè¿‡è·¯ç”±å™¨è¿›è¡Œé€šä¿¡ã€‚æ•°æ®åŒ…ç»è¿‡è·¯ç”±å™¨è½¬å‘åˆ°ç›®çš„ PC çš„è¿‡ç¨‹å°±æ˜¯è·¯ç”±çš„åŸºæœ¬è¿‡ç¨‹ï¼Œå…·ä½“åŒ…æ‹¬å››ä¸ªæ­¥éª¤ï¼š

image:img/route_work_process.png[]
 
1. è·¯ç”±å™¨é€šè¿‡å®ƒçš„ä¸€ä¸ªç½‘ç»œæ¥å£æ¥æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…
2. è·¯ç”±å™¨æ£€æµ‹æ•°æ®åŒ…ä¸­ç›®çš„åœ°çš„ IP åœ°å€ï¼ˆå¯¹æºæ•°æ®é“¾è·¯å±‚ä»¥å¤ªç½‘å¸§çš„å¤´å’Œå°¾å»æ‰ï¼Œåªä¿ç•™ IP æ•°æ®æŠ¥æ–‡ï¼Œä» IP æ•°æ®æŠ¥æ–‡çš„å¤´ä¸­è·å–ç›®çš„åœ° IP åœ°å€ï¼‰
3. è·¯ç”±å™¨ä»è·¯ç”±è¡¨ä¸­æŸ¥è¯¢ç›®çš„åœ°çš„ IP åœ°å€
4. è·¯ç”±å™¨é€šè¿‡å®ƒçš„ä¸€ä¸ªç½‘ç»œæ¥å£å°†æ•°æ®åŒ…è½¬å‘å‡ºå»ï¼ˆä¿®æ”¹ 2 æ­¥éª¤ä¸­çš„ IP æ•°æ®æŠ¥æ–‡ï¼Œå¯¹ IP æ•°æ®æŠ¥æ–‡å¤´ä¸­çš„ TTL å­—æ®µå‡ä¸€ï¼Œé‡æ–°è®¡ç®— Header Checksum å­—æ®µï¼Œç„¶åå°è£…ä¸€ä¸ªæ–°çš„å¤ªç½‘å¸§ï¼Œæ·»åŠ å¤´å’Œå°¾ï¼‰

NOTE: å¦‚æœæ•°æ®åŒ…ä¼ è¾“è·¨å¤šä¸ªç½‘ç»œï¼Œåˆ™æŸ¥è¯¢è·¯ç”±è¡¨æˆ–æ‰¾å‡ºæœ€è¿‘çš„ä¸€ä¸ªç½‘ç»œå°†æ•°æ®åŒ…è½¬å‘å‡ºå»ï¼ŒåŒæ—¶æ¯ç»è¿‡ä¸€æ¬¡è·¯ç”±ï¼ŒIP æ•°æ®æŠ¥æ–‡çš„ TTL å­—æ®µéƒ½ä¼šå‡å° 1ã€‚

==== è·¯ç”±è¡¨

è·¯ç”±è¡¨ç»“æ„æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸æœ‰å››ä¸ªåˆ—ï¼š

1. Destination - ç›®çš„åœ°ç½‘ç»œï¼Œè·¯ç”±å™¨ä¸Šå·²çŸ¥çš„æ‰€æœ‰ç½‘ç»œéƒ½ä¼šå­˜åœ¨ä¸€è¡Œï¼Œä»£è¡¨çš„æ˜¯ç›®çš„åœ°çš„ç½‘ç»œï¼ŒåŒ…æ‹¬ç½‘ç»œåœ°å€å’Œå­ç½‘æ©ç ã€‚
2. Next Hop - æ˜¯å»å¾€ç›®çš„ç½‘ç»œæœ€è¿‘çš„è·¯ç”±å™¨çš„ IP åœ°å€ï¼›å¦‚æœå»å¾€ç›®çš„ç½‘ç»œä¸éœ€è¦ç»è¿‡ç½‘ç»œè·³è½¬ï¼Œæˆ–è€…è¯´ç›®çš„åœ°å’Œè·¯ç”±å™¨åœ¨åŒä¸€ä¸ªç½‘ç»œï¼Œåˆ™è¯¥å­—æ®µæ˜¯ç›®çš„åœ°çš„ IP åœ°å€ã€‚
3. Total Hops - è¿™æ˜¯äº†è§£è·¯ç”±ä»¥åŠè·¯ç”±è¡¨å¦‚ä½•å·¥ä½œçš„å…³é”®éƒ¨åˆ†ï¼Œåœ¨ä»»ä½•å¤æ‚çš„ç½‘ç»œï¼ˆå¦‚Internetï¼‰ä¸Šï¼Œä»ä¸€ä¸ªç‚¹åˆ°å¦ä¸€ä¸ªç‚¹éƒ½æœ‰å¾ˆå¤šä¸åŒçš„è·¯å¾„ã€‚
4. Interface - è·¯ç”±å™¨çš„ç½‘ç»œæ¥å£ï¼Œè¯¥æ¥å£ç”¨äºå°†æ•°æ®åŒ…ä»è·¯ç”±å™¨è½¬å‘å‡ºå»

[source, bash]
.*Linux ä¸Š route å‘½ä»¤æŸ¥çœ‹è·¯ç”±ä¿¡æ¯*
----
$ route -nv
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.1.10.2       0.0.0.0         UG    0      0        0 external
0.0.0.0         10.1.1.1        0.0.0.0         UG    9      0        0 mgmt
10.1.1.0        0.0.0.0         255.255.255.0   U     0      0        0 mgmt
10.1.10.0       0.0.0.0         255.255.255.0   U     0      0        0 external
10.1.20.0       0.0.0.0         255.255.255.0   U     0      0        0 internal
127.1.1.0       0.0.0.0         255.255.255.0   U     0      0        0 tmm
127.7.0.0       127.1.1.253     255.255.0.0     UG    0      0        0 tmm
127.20.0.0      0.0.0.0         255.255.0.0     U     0      0        0 tmm_bp
----

[source, bash]
.*Linux ä¸Š ip route æŸ¥çœ‹è·¯ç”±ä¿¡æ¯*
----
$ ip route list
default via 10.1.10.2 dev external 
default via 10.1.1.1 dev mgmt  metric 9  mtu 1500
10.1.1.0/24 dev mgmt  proto kernel  scope link  src 10.1.1.245 
10.1.10.0/24 dev external  proto kernel  scope link  src 10.1.10.240 
10.1.20.0/24 dev internal  proto kernel  scope link  src 10.1.20.240 
127.1.1.0/24 dev tmm  proto kernel  scope link  src 127.1.1.254 
127.7.0.0/16 via 127.1.1.253 dev tmm 
127.20.0.0/16 dev tmm_bp  proto kernel  scope link  src 127.20.0.254 
----

==== è·¯ç”±åè®®

è·¯ç”±åè®®ä¸»è¦ç›®çš„æœ‰ä¸¤ä¸ªï¼š

1. ç½‘ç»œå‘ç°
2. è·¯ç”±è¡¨æ›´æ–°

è·¯ç”±åè®®å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š

1. IGP(Interior Gateway Protocol å†…éƒ¨ç½‘å…³åè®®) - IGP é€šå¸¸æ˜¯åœ¨ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿï¼ˆAutonomous system, ASï¼Œä¸€ä¸ªï¼Œæœ‰æ—¶æ˜¯å¤šä¸ªå®ä½“ç®¡è¾–ä¸‹çš„æ‰€æœ‰ IP ç½‘ç»œå’Œè·¯ç”±å™¨çš„å…¨ä½“ï¼Œä¾‹å¦‚ä¸€ä¸ªä¼ä¸š/ç»„ç»‡çš„å†…ç½‘ï¼‰å†…è·¯ç”±å™¨å…±äº«ä¿¡æ¯
2. EGP(Exterior Gateway Protocol å¤–éƒ¨ç½‘ç®¡åè®®) - EGP æ˜¯è‡ªåˆ¶ç³»ç»Ÿä¹‹é—´è·¯ç”±å™¨å…±äº«ä¿¡æ¯ã€‚

IGP åè®®å¯ä»¥è¿›ä¸€æ­¥åˆ†ä¸ºä¸¤ç±»ï¼š

1.  é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ï¼ˆLink State Routing Protocolï¼‰
2.  è·ç¦»çŸ¢é‡è·¯ç”±åè®®ï¼ˆDistance-Vector Protocolï¼‰ã€‚

.*IGP è·¯ç”±åè®®*
[cols="5a,5a"]
|===
|è·ç¦»çŸ¢é‡è·¯ç”±åè®® | é“¾è·¯çŠ¶æ€è·¯ç”±åè®®

|
image:img/routing-instance-vector-protocol.png[]
|
image:img/routing-link-state-protocol.png[]

|è·ç¦»çŸ¢é‡è·¯ç”±åè®®æ˜¯ä¸€ä¸ªæ—§çš„æ ‡å‡†ã€‚ä½¿ç”¨è·ç¦»çŸ¢é‡è·¯ç”±åè®®çš„è·¯ç”±å™¨è·å–å…¶è·¯ç”±è¡¨ï¼Œè¯¥è·¯ç”±è¡¨åŒ…æ‹¬å®ƒå·²çŸ¥çš„æ¯ä¸ªç½‘ç»œçš„åˆ—è¡¨ï¼Œä»¥åŠè¿™äº›ç½‘ç»œåœ¨è·³æ•°æ–¹é¢çš„è·ç¦»ã€‚ ç„¶åè·¯ç”±å™¨å°†æ­¤è·¯ç”±è¡¨å‘é€ç»™æ¯ä¸ªç›¸é‚»è·¯ç”±å™¨ï¼Œå³æ˜¯ç›´æ¥ä¸å…¶ç›¸è¿çš„æ¯ä¸ªè·¯ç”±å™¨ã€‚åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œåˆ—è¡¨ç§°ä¸ºå‘é‡ï¼Œè¿™å°±æ˜¯è·ç¦»çŸ¢é‡åè®®çš„åå­—ç”±æ¥ã€‚ å€ŸåŠ©è·ç¦»çŸ¢é‡è·¯ç”±åè®®ï¼Œè·¯ç”±å™¨å®é™…ä¸Šå¯¹è‡ªæ²»ç³»ç»Ÿçš„æ€»ä½“çŠ¶æ€äº†è§£ä¸å¤šï¼Œä»–ä»¬åªæ˜¯äº†è§£ä¸€äº›ä¸å…¶ç›´æ¥ç›¸é‚»çš„è·¯ç”±å™¨çš„ä¿¡æ¯ã€‚
|é“¾è·¯çŠ¶æ€è·¯ç”±åè®®é‡‡ç”¨æ›´åŠ å¤æ‚çš„æ–¹å¼æ¥ç¡®å®šç½‘ç»œçš„æœ€ä½³è·¯å¾„ã€‚é“¾æ¥çŠ¶æ€åè®®ä¹‹æ‰€ä»¥å¾—åï¼Œæ˜¯å› ä¸ºæ¯ä¸ªè·¯ç”±å™¨éƒ½ä¼šé€šå‘Šå…¶æ¯ä¸ªæ¥å£çš„é“¾æ¥çŠ¶æ€ã€‚è¿™äº›æ¥å£å¯ä»¥è¿æ¥åˆ°å…¶ä»–è·¯ç”±å™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿æ¥åˆ°ç½‘ç»œã€‚ æœ‰å…³æ¯ä¸ªè·¯ç”±å™¨çš„ä¿¡æ¯å°†ä¼ æ’­åˆ°è‡ªæ²»ç³»ç»Ÿä¸Šçš„æ¯ä¸ªå…¶ä»–è·¯ç”±å™¨ã€‚è¿™æ„å‘³ç€ç³»ç»Ÿä¸Šçš„æ¯ä¸ªè·¯ç”±å™¨éƒ½çŸ¥é“æœ‰å…³ç³»ç»Ÿä¸­å…¶ä»–æ¯ä¸ªè·¯ç”±å™¨çš„æ¯ä¸ªç»†èŠ‚ã€‚
|=== 

NOTE: IANA(Internet Assigned Numbers Authority) æ˜¯ä¸€ä¸ªéç›ˆåˆ©çš„ç»„ç»‡ï¼Œå‰é¢å·²ç»çŸ¥é“å®ƒè´Ÿè´£ IP åœ°å€çš„åˆ†é…ï¼Œé™¤äº†è´Ÿè´£ IP åœ°å€çš„ åˆ†é…ï¼Œè¯¥ç»„ç»‡è¿˜è´Ÿè´£ ASN(Autonomous System Number,è‡ªæ²»ç³»ç»Ÿç¼–å·)çš„åˆ†é…ï¼ŒASN æ˜¯åˆ†é…ç»™å„ä¸ªè‡ªæ²»ç³»ç»Ÿçš„ç¼–å·ï¼Œå°±åƒ IP åœ°å€ï¼ŒASN ä¹Ÿæ˜¯ä¸€ä¸ª 32 ä½äºŒè¿›åˆ¶æ•°ï¼Œä½†å’Œ IP åœ°å€ä¸åŒçš„æ˜¯ ASN æ˜¯ä¸€ä¸ªåè¿›åˆ¶çš„æ•°ï¼Œè€Œä¸æ˜¯æ¯å…«ä½åˆ†æˆä¸€ç»„ã€‚ 

==== åŠ¨æ€è·¯ç”±åè®®

ç°ä»£è·¯ç”±å™¨è®¾å¤‡é€šå¸¸é€šè¿‡åŠ¨æ€è·¯ç”±å™¨å…±äº«è¿œç¨‹ç½‘ç»œçš„çŠ¶æ€å’Œå¯è¾¾æ€§ï¼Œå¦‚ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åŠ¨æ€è·¯ç”±åè®®

* https://en.wikipedia.org/wiki/Routing_Information_Protocol[EIP(Routing Information Protocol)]
* https://en.wikipedia.org/wiki/Enhanced_Interior_Gateway_Routing_Protocol[EIGRP(Enhanced Interior Gateway Routing Protocol)]
* https://en.wikipedia.org/wiki/Open_Shortest_Path_First[OSPF(Open Shortest Path First)]
* https://en.wikipedia.org/wiki/Border_Gateway_Protocol[BGP(Border Gateway Protocol)]

åŠ¨æ€è·¯ç”±åè®®çš„ä¼˜ç‚¹æ˜¯ï¼š

* åŠ¨æ€æ›´æ–°è·¯ç”±è¡¨
* ä¸ä»…ä»…é’ˆå¯¹ä¸åŒçš„ç½‘ç»œå¯ä»¥é€‰æ‹©å‡ºä¸€ä¸ªæœ€ä½³è·¯å¾„ï¼Œè€Œä¸”åœ¨åˆå§‹æœ€ä½³è·¯å¾„ä¸å¯ç”¨ï¼ˆç½‘ç»œæ‹“æ‰‘å˜åŒ–ï¼‰åå¯ä»¥é‡æ–°é€‰æ‹©å‡ºä¸€ä¸ªæœ€ä½³è·¯å¾„
* ä¸åŒè·¯ç”±å™¨ä¹‹é—´åŠ¨æ€å…±äº«è·¯ç”±ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦ç½‘ç»œç®¡ç†å‘˜äººä¸ºå‚ä¸

=== Fragmentation

å¦‚ä¸‹å›¾ï¼Œåº”ç”¨å±‚å‘é€ä¸€ä¸ªæ¶ˆæ¯åœ¨ç½‘ç»œæ¨¡å‹ä¸­æ¯ä¸€å±‚å°è£…è¿‡ç¨‹ï¼Œåº•å±‚åŒ…çš„ payload æ˜¯ä¸´è¿‘ä¸Šä¸€å±‚åŒ…ï¼Œ

image:img/ip-datagrams-encapsulation.png[]

1. æ•°æ®é“¾è·¯å±‚ Ethernet å¸§çš„ Payload æ˜¯å…¶ä¸Šä¸€å±‚ç½‘ç»œå±‚ IP æ•°æ®æŠ¥æ–‡
2. ç½‘ç»œå±‚ IP æ•°æ®æŠ¥æ–‡çš„ Payload æ˜¯å…¶ä¸Šä¸€å±‚ä¼ è¾“å±‚ TCP æŠ¥æ–‡æˆ– UDP æŠ¥æ–‡
3. ä¼ è¾“å±‚ TCP/UDP æŠ¥æ–‡çš„ Payload æ˜¯å…¶ä¸Šä¸€å±‚åº”ç”¨å±‚çš„ Message

å¦‚æœ IP Datagram çš„å¤§å°å¤§äºå½“å‰ç½‘ç»œå…è®¸çš„ MTU(Maximum Transmission Unit) æ—¶ï¼Œåˆ™ IP Datagram è¢«é¦–å…ˆåˆ†å‰²æˆå¤šä¸ª Packetï¼Œç„¶ååœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš *Fragmentation*ã€‚*Fragmentation* å¯ä»¥å‘ç”Ÿåœ¨åˆå§‹çš„ä¸»æœºï¼Œæˆ–åœ¨è·¯ç”±è¿‡ç¨‹ä¸­ã€‚

*Fragmentation* å¯èƒ½ä¼šé€ æˆä¸€ä¸ªé‡ä¼ çš„å‡ºç°ï¼Œä¾‹å¦‚å¦‚æœä¸€ä¸ª Packet çš„ä¸¢å¤±ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤šä¸ª IP Datagrams çš„é‡ä¼ ã€‚

NOTE: ä»¥å¤ªç½‘ä¸Šå…è®¸çš„æœ€å¤§ MTU é»˜è®¤å€¼ä¸º 1500 bytesã€‚

=== IPv6 åœ°å€

image:img/ipv6-addr.png[ipv6-addr.png]

* *IPv6 åœ°å€:* IPv6 åœ°å€æ˜¯ä¸€ä¸ªç”± 32 ä¸ªåå…­è¿›åˆ¶ï¼ˆ128 ä¸ªäºŒè¿›åˆ¶ï¼‰çš„æ•°å­—ç»„æˆï¼Œä¸” 32 ä¸ªåå…­è¿›åˆ¶ä½åˆ†ä¸º 8 ç»„ï¼Œæ¯ç»„ 4 ä½ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼Œå®šä¹‰äº†å¦‚ä¸‹è§„åˆ™ï¼š
** æ¯ 4 ä½å°ç»„ä¸­çš„å‰ç¼€ 0 å¯ä»¥çœç•¥ï¼Œä¾‹å¦‚ `2001:0db8:0000:0010:0000:0000:0000:0001` ç®€å†™ä¸º `2001:db8:0:10:0:0:0:1`
** ä¸€ç»„æˆ–å¤šç»„è¿ç»­ 0 å¿…é¡»ä»¥ä¸€ä¸ª :: å—æ¥åˆå¹¶ï¼Œä¾‹å¦‚ `2001:db8:0:10:0:0:0:1` éœ€å†™ä¸º `2001:db8:0:10::1`
** æ‰€æœ‰å¯èƒ½å‡ºç°å­—æ¯çš„åå…­è¿›åˆ¶ä½å¿…é¡»ä½¿ç”¨å°å†™å­—æ¯ a åˆ° f
** å¦‚æœåœ¨ IPv6 åœ°å€åé¢åŒ…æ‹¬ TCP æˆ– UDP ç½‘ç»œç«¯å£ï¼Œåˆ™éœ€å°† IPv6 åœ°å€æ‹¬åœ¨æ–¹æ‹¬å·ä¸­ï¼Œä¾‹å¦‚ `[2001:db8:0:10::1]:80`
* *IPv6 åœ°å€æœ‰ä¸¤éƒ¨ç»„æˆ:* `ç½‘ç»œå‰ç¼€`å’Œ`æ¥å£ ID`ã€‚ä¸ IPv4 ä¸åŒçš„æ˜¯ï¼ŒIPv6 å…·æœ‰ä¸€ä¸ªæ ‡å‡†çš„å­ç½‘æ©ç */64*ï¼Œç”¨äºå‡ ä¹æ‰€æœ‰çš„æ™®é€šåœ°å€ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œåœ°å€çš„ä¸€åŠæ˜¯`ç½‘ç»œå‰ç¼€`ï¼Œå¦ä¸€åŠæ˜¯`æ¥å£ ID`ã€‚è¿™æ„å‘³ç€å•ä¸ªå­ç½‘å¯ä»¥>æ ¹æ®éœ€è¦å®¹çº³ä»»æ„æ•°é‡çš„ä¸»æœºã€‚
* *å­ç½‘åˆ†é…:* é€šå¸¸ï¼Œç½‘ç»œæä¾›å•†å°†ä¸ºç»„ç»‡åˆ†é…ä¸€ä¸ªè¾ƒçŸ­çš„å‰ç¼€ï¼Œå¦‚*/48*ã€‚è¿™ä¼šä¿ç•™å…¶ä½™ç½‘ç»œéƒ¨åˆ†ä»¥ç”¨äºé€šè¿‡è¿™ä¸€åˆ†é…çš„å‰ç¼€æ¥æŒ‡å®šå­ç½‘ã€‚å¤„ç†å·²åˆ†é…çš„48ä½ï¼Œå°†ä¿ç•™16ä½ä»¥ç”¨äºå­ç½‘ï¼ˆæœ€å¤š 65536 ä¸ªå­ç½‘ï¼‰ã€‚åŒä¸€å­ç½‘ä¸Šçš„ä»»ä½•
ä¸¤ä¸ªå­ç½‘æ¥å£éƒ½ä¸èƒ½å…·æœ‰ç›¸åŒ`æ¥å£ ID`ï¼Œ`æ¥å£ ID` å¯æ ‡è¯†å­ç½‘ä¸Šçš„ç‰¹å®šæ¥å£ã€‚

.*IPv6 åœ°å€ç¤ºä¾‹ï¼š*
image:img/ipv6-shortern-excercise.png[]

.*IPv6 é€šç”¨åœ°å€è¡¨*
|===
|åœ°å€/ç½‘ç»œ |ç”¨é€” |æè¿°

|::1/128
|localhost
|ç­‰æ•ˆäº IPv4 ä¸­çš„ `127.0.0.1/8`, åœ¨ lookback interface ä¸Šè®¾ç½®ã€‚

|::
|æœªæŒ‡å®šçš„åœ°å€
|ç­‰æ•ˆäº IPv4 ä¸­çš„ `0.0.0.0`ï¼Œå¯¹äºç½‘ç»œæœåŠ¡ï¼Œè¿™å¯èƒ½è¡¨ç¤ºå…¶æ­£åœ¨ä¾¦å¬æ‰€æœ‰å·²é…ç½®çš„ IP åœ°å€ã€‚

|::/0
|IPv6 ç½‘ç»œé»˜è®¤è·¯ç”±
|è·¯ç”±è¡¨ä¸­çš„é»˜è®¤è·¯ç”±ä¸æ­¤ç½‘ç»œåŒ¹é…ï¼›æ­¤ç½‘ç»œçš„è·¯ç”±å™¨æ˜¯åœ¨æ²¡æœ‰æ›´å¥½è·¯ç”±çš„æƒ…å†µä¸‹å‘é€æ‰€æœ‰æµé‡çš„ä½ç½®ã€‚

|2000::/3
|å…¨å±€å•æ’­åœ°å€
|â€œæ™®é€šâ€çš„ IPv6 åœ°å€ç›®å‰ç”± IANA ä»è¯¥ç©ºé—´è¿›è¡Œåˆ†é…ã€‚è¿™ç­‰åŒäºèŒƒå›´ä» `2000::/16` åˆ° `3fff::/16` çš„æ‰€æœ‰ç½‘ç»œã€‚

|fd00::/8
|å”¯ä¸€æœ¬åœ°åœ°å€ (RFC 4193)
|IPv6 æ²¡æœ‰ RFC 1918 ä¸“ç”¨åœ°å€ç©ºé—´çš„ç›´æ¥ç­‰æ•ˆå¯¹è±¡ï¼Œå°½ç®¡è¿™å¾ˆæ¥è¿‘ã€‚ç«™ç‚¹å¯ä»¥ä½¿ç”¨è¿™äº›ä»¥åœ¨ç»„ç»‡ä¸­è‡ªåŠ©åˆ†é…å¯è·¯ç”±çš„ä¸“ç”¨ IP åœ°å€ç©ºé—´ï¼Œä½†æ˜¯è¿™äº›ç½‘ç»œä¸èƒ½åœ¨å…¨å±€ Internet ä¸Šä½¿ç”¨ã€‚ç«™ç‚¹å¿…é¡»éšæœºä»è¯¥ç©ºé—´ä¸­é€‰æ‹©ä¸€ä¸ª /48ï¼Œä½†
æ˜¯å®ƒå¯ä»¥æ­£å¸¸å°†åˆ†é…ç©ºé—´åˆ’åˆ†ä¸º /64 ç½‘ç»œ

|fe80::/64
|æœ¬åœ°é“¾æ¥åœ°å€
|æ¯ä¸ª IPv6 æ¥å£è‡ªåŠ¨é…ç½®ä¸€ä¸ªæœ¬åœ°é“¾æ¥åœ°å€ï¼Œè¯¥åœ°å€ä»…åœ¨è¯¥ç½‘ç»œä¸­çš„æœ¬åœ°é“¾æ¥ä¸­æœ‰æ•ˆã€‚Link-local unicast addresses allow for local network segment communications and are configured based upon a host's MAC address.

|ff00::/8
|å¤šæ’­
|ç­‰æ•ˆäº IPv4 ä¸­çš„ `224.0.0.0/4`ï¼Œå¤šæ’­ç”¨äºåŒæ—¶ä¼ æ’­åˆ°å¤šä¸ªä¸»æœºï¼Œå¹¶ä¸”åœ¨ IPv6 ä¸­ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºå…¶æ²¡æœ‰å¹¿æ’­åœ°å€ã€‚
|===

=== IPv6 æ•°æ®æŠ¥æ–‡ç»“æ„

IPv6 æ•°æ®æŠ¥æ–‡åŒæ ·æ˜¯ç”±ä¸€ç³»åˆ—é«˜åº¦ç»“æ„åŒ–çš„å­—æ®µä¸¥æ ¼å®šä¹‰ï¼ŒIPv6 æ•°æ®æŠ¥æ–‡åŒæ ·ä¸»è¦ä¸»è¦éƒ¨åˆ†æ˜¯ header å’Œ payloadã€‚

image:img/ipv6-headers.png[]

* *Version* - A 4-bit field that defines what version of IP is in use.
* *Traffic Class* - An 8-bit field that defines the type of traffic contained within the IP datagram and allows for different classes of traffic to receive different priorities.
* *Flow Labe* - A 20-bit field that's used in conjunction with the traffic class field for routers to make decisions about the quality of service level for a specific datagram.
* *Payload Length* - A 16-bit field that defines how long the data payload section of the datagram is.
* *Next header* - The next header field defines what kind of header is immediately after this current one.
* *Hop limit* - An 8-bit field that's identical in purpose to the TTL field in an IPv4 header.
* *Source address* - 128 bits length
* *Destination address* - 128 bits length

=== IPv6 and IPv4 Harmony

*IPv6 tunnels* - IPv6 tunnels are conceptually pretty simple. They consist of IPv6 tunnels servers on either end of a connection. These IPv6 tunnel servers take incoming IPv6 traffic and encapsulate it within traditional IPv4 datagrams.

*IPv6 tunnel broker* - Companies that provide IPv6 tunneling endpoints for you, so you don't have to introduce additional equipment to your network.

*Links:*

* https://en.wikipedia.org/wiki/6in4[6in4]
* https://en.wikipedia.org/wiki/Tunnel_Setup_Protocol[TSP(Tunnel Setup Protocol)]
* https://en.wikipedia.org/wiki/Anything_In_Anything[Anything In Anything]

== ä¼ è¾“å±‚

è®¡ç®—æœºç½‘ç»œé€šä¿¡ä¸­æœ‰ä¸¤ä¸ªå¸¸è§çš„åè¯ï¼Œå³ç«¯åˆ°ç«¯(End to End)é€šä¿¡å’Œç‚¹åˆ°ç‚¹(Point to Point)é€šä¿¡ï¼Œä¸‹å›¾ä¸ºå¸¸è§çš„ç½‘ç»œé€šä¿¡åœºæ™¯ï¼Œ

image:img/end-to-end-net.png[]

å®¢æˆ·ç«¯ PC å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯ Serverï¼Œè€ŒPC å’Œ Server  ä½äºä¸åŒçš„ç½‘ç»œï¼ŒPC è¯·æ±‚åˆ°è¾¾ Server éœ€è¦ç»è¿‡è·¯ç”±å™¨ R1 å’Œ è·¯ç”±å™¨ R2ï¼Œé‚£ä¹ˆ åœ¨è¿™ä¸ªåœºæ™¯ä¸­å‘ç”Ÿçš„ç‚¹å¯¹ç‚¹é€šä¿¡åŒ…æ‹¬ï¼š

* PC -> R1
* R1 -> R2
* R2 -> Server

ç«¯åˆ°ç«¯çš„é€šä¿¡åªæœ‰ä¸€ä¸ªï¼Œå³ PC -> Serverã€‚

å¦‚å‰é¢çš„å†…å®¹æè¿°ï¼Œæ•°æ®é“¾è·¯å±‚å¯ç¡®ä¿ç‚¹å¯¹ç‚¹çš„ç½‘ç»œä¼ è¾“å¯é ï¼Œç½‘ç»œå±‚å¯è®©æ•°æ®åŒ…åœ¨ä¸åŒçš„ç½‘ç»œä¹‹é—´è½¬å‘ï¼Œè€Œç½‘ç»œæ¨¡å‹ä¸­çš„ä¼ è¾“å±‚è´Ÿè´£çš„æ˜¯*ç«¯åˆ°ç«¯çš„å¯é ç½‘ç»œé€šä¿¡*ã€‚ä¸ºäº†å®ç°ç«¯åˆ°ç«¯çš„å¯é ç½‘ç»œé€šä¿¡ï¼Œä¼ è¾“å±‚æä¾›äº†ä¸€äº›é‡è¦çš„æ–¹æ³•å’ŒåŠŸèƒ½ï¼Œå…·ä½“åŒ…æ‹¬ï¼š

* å¤šè·¯å¤ç”¨å‘é€(Multiplexing Traffic)
* å¤šè·¯åˆ†è§£æ¥æ”¶(Demultiplexing Traffic)
* å»ºç«‹é•¿è¿è¡Œè¿æ¥
* é€šè¿‡é”™è¯¯æ£€æŸ¥å’Œæ•°æ®éªŒè¯æ¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§

=== å¤šè·¯å¤ç”¨å‘é€ & å¤šè·¯åˆ†è§£æ¥æ”¶

.*å¤šè·¯å¤ç”¨å‘é€ & å¤šè·¯åˆ†è§£æ¥æ”¶*
[cols="5a,5a"] 
|===
|å¤šè·¯å¤ç”¨å‘é€(Multiplexing Traffic) |å¤šè·¯åˆ†è§£æ¥æ”¶(Demultiplexing Traffic)

|
image:img/transport-multiplexer.png[]
|
image:img/transport-demultiplexer.png[]

|æ¶ˆæ¯å‘é€ç«¯
|æ¶ˆæ¯æ¥æ”¶ç«¯

|å‘é€ç«¯å¯èƒ½æœ‰å¤šä¸ªè¿›ç¨‹éœ€è¦å‘é€æ•°æ®ï¼Œä½†æ˜¯åœ¨ä»»æ„ä¸€ä¸ªæ—¶é—´åªæœ‰ä¸€ä¸ªä¼ è¾“åè®®ï¼Œè¿™ç§å¤šå¯¹ä¸€çš„åœºæ™¯å°±éœ€è¦å¤šè·¯å¤ç”¨å‘é€ï¼Œåè®®æ¥å—æ¶ˆæ¯æ¥è‡ªä¸åŒçš„è¿›ç¨‹ï¼Œå¹¶ä¸”æ›´åŠ æ¶ˆæ¯å¤´ä¸Šçš„ç«¯å£å·ä¸åŒæ¥åŒºåˆ†ï¼Œå½“å®Œæˆæ¶ˆæ¯å¤´æ·»åŠ åï¼Œä¼ è¾“å±‚å¯ä»¥å°†ä¼ è¾“å±‚åŒ…ä¼ é€’ç»™ç½‘ç»œå±‚ã€‚
|ä¸å‘é€æµ‹æ­£å¥½ç›¸åï¼Œæ¥æ”¶æµ‹åœ¨æ¥æ”¶åˆ°ç½‘ç»œå±‚çš„æ•°æ®åŒ…åï¼Œé¢å¯¹çš„æ˜¯ä¸€ä¸ªä¸€å¯¹å¤šçš„åœºæ™¯ï¼Œè¿™å°±éœ€è¦å¤šè·¯åˆ†è§£æ¥æ”¶ã€‚åœ¨ç»è¿‡é”™è¯¯éªŒè¯å’Œå»é™¤æ¶ˆæ¯å¤´åï¼Œä¼ è¾“å±‚ä¼šé€šè¿‡ç«¯å£å·å°†æ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„è¿›ç¨‹æœåŠ¡ 
|===

NOTE: ä¼ è¾“å±‚å¤šè·¯å¤ç”¨å‘é€å’Œå¤šè·¯åˆ†è§£æ¥æ”¶éƒ½æ˜¯åŸºäºç«¯å£å·æ¥å®Œæˆçš„ï¼Œä¼ è¾“å±‚çš„ç«¯å£å·æ˜¯ä¸€ä¸ª 16 ä½å­—èŠ‚é•¿åº¦çš„æ•°å­—ï¼Œç”¨æ¥åœ¨åœ¨è®¡ç®—æœºç½‘ç»œä¸­ä¸åŒä¸»æœºä¸Š çš„ è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚
 
=== TCP Segment ç»“æ„

ä¸€ä¸ª TCP Segment æ˜¯æœ‰ TCP å¤´å’Œæ•°æ®éƒ¨åˆ†æ„æˆã€‚

image:img/tcp-segment.png[]

* *Destination port* - ç›®çš„åœ°ç«¯å£ï¼Œæ˜¯ç›®çš„æœåŠ¡æ‰€ç›‘å¬çš„ç«¯å£ï¼Œæ˜¯æœ€ç»ˆæ¥æ”¶TCP Segment çš„æœåŠ¡çš„ç«¯å£ã€‚
* *Source port* - æºç«¯å£ï¼Œæ˜¯ä¸€ä¸ªè¾ƒå¤§çš„æ•°å­—ï¼Œå‘é€ TCP Segment çš„å®¢æˆ·ç«¯ä»éšæœºç«¯å£ä¸­éšæœºé€‰æ‹©
* *Sequence number* - 32 ä½å­—èŠ‚é•¿åº¦ï¼Œç”¨æ¥è·Ÿè¸ª TCP Segment åœ¨ä¼ è¾“åºåˆ—ä¸­é¢„æœŸçš„ä½ç½®ã€‚
* *Acknowledgment number* - 32 ä½å­—èŠ‚é•¿åº¦ï¼Œç”¨æ¥ç¡®å®šä¸‹ä¸€ä¸ªæœŸæœ›çš„ TCP Segmentã€‚
* *Header Length* - é•¿åº¦ä¸º 4 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå«æ•°æ®åç§»å­—æ®µï¼Œå®ƒå®šä¹‰äº†åœ¨ä¸€ä¸ª TCP Segment ä¸­ TCP å¤´çš„é•¿åº¦ï¼Œè¿™ä¹Ÿä½¿æ¥æ”¶ç«¯çš„ç½‘ç»œè®¾å¤‡çŸ¥é“çœŸæ­£æ•°æ® è´Ÿè½½å¼€å§‹çš„ä½ç½®ã€‚
* *Control flags* - TCP Segment æ§åˆ¶æ ‡ç­¾ã€‚
* *TCP window* - 16 å­—èŠ‚çš„æ•°å­—ï¼ŒæŒ‡å®šåœ¨éœ€è¦ç¡®è®¤å‰å¯èƒ½å‘é€çš„åºåˆ—å·èŒƒå›´ã€‚
* *Checksum* - é•¿åº¦ä¸º 16 ä¸ªå­—èŠ‚ï¼Œå’Œ IPã€Ethernet ä¸­çš„ Checksum å­—æ®µç±»ä¼¼ï¼Œå½“æ¥æ”¶è€…æ¥æ”¶åˆ°è¿™ä¸ª TCP Segment åï¼ŒChecksum ä¼šè¿›è¡Œä¸€æ¬¡è®¡ç®—ï¼Œè®¡ç®—æ•´ä¸ª TCP Segment çš„é•¿åº¦ï¼Œå¹¶å’Œæ”¹å­—æ®µå®šä¹‰çš„é•¿åº¦è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç¡®ä¿ä¼ è¾“çš„è¿‡ç¨‹ä¸­æ²¡æœ‰æ•°æ®çš„ä¸¢å¤±æˆ–æŸåã€‚
* *Urgent* - è¯¥å­—æ®µé€šå¸¸ä¸ TCP æ§åˆ¶æ ‡ç­¾ä¸­çš„æŸä¸ªæ ‡ç­¾è”åˆä½¿ç”¨ï¼Œæ¥è¯´æ˜æŸä¸ª Segment æ¯”å…¶ä»– Segment é‡è¦ï¼Œæˆ–æœ‰ç‰¹å®šå«ä¹‰ã€‚
* *Options* - è¯¥å­—æ®µé€šå¸¸æ¯”è¾ƒå°‘ç”¨ï¼Œä½†æœ‰æ—¶ä¼šç”¨äºæ›´å¤æ‚çš„æµæ§åˆ¶åè®®ã€‚
* *Padding* - é›¶åºåˆ—ï¼Œä»¥ç¡®ä¿æ•°æ®æœ‰æ•ˆè´Ÿè½½éƒ¨åˆ†ä»é¢„æœŸä½ç½®å¼€å§‹ã€‚

=== TCP æ§åˆ¶æ ‡ç­¾

.*6 ç§ TCP æ§åˆ¶æ ‡ç­¾*
|===
|åç§° |æè¿°

|URG(urgent)
|å¦‚æœæ­¤æ ‡ç­¾å€¼ä¸º 1ï¼Œåˆ™è¡¨ç¤ºå½“å‰ TCP Segment ç‰¹åˆ«é‡è¦ï¼Œè¯¥æ ‡ç­¾é€šå¸¸ ä¸ TCP å¤´ä¸­çš„ *Urgent* å­—æ®µä¸€èµ·ä½¿ç”¨ï¼Œ *Urgent* å­—æ®µæœ‰æ›´å¤šä¿¡æ¯ã€‚

|ACK(acknowledge)
|å¦‚æœæ­¤æ ‡ç­¾å€¼ä¸º 1ï¼Œåˆ™è¡¨ç¤º *Acknowledgment number* å­—æ®µåº”è¯¥è¢«æ£€æŸ¥ã€‚

|PSH(push)
|ä¼ è¾“è®¾å¤‡æƒ³ è®©æ¥æ”¶ç«¯è®¾å¤‡å°½å¿«å°†ç¼“å†²ä¸­çš„æ•°æ®æ¨é€åˆ°åº”ç”¨ã€‚

|RST(reset)
|TCP è¿æ¥ä¸­çš„ä¸€æ–¹æ— æ³•ä»ä¸€ç³»åˆ—ä¸¢å¤±æˆ–æ ¼å¼é”™è¯¯çš„æ®µä¸­æ­£ç¡®æ¢å¤ã€‚

|SYN(synchronize)
|åˆæ¬¡å»ºç«‹ä¸€ä¸ª TCP è¿æ¥æ—¶ä½¿ç”¨ï¼Œè®©æ¥æ”¶ç«¯çŸ¥é“éœ€è¦æ£€æŸ¥ *Sequence number* å­—æ®µã€‚ 

|FIN(finish)
|æç¤ºä¼ è¾“è®¡ç®—æœºç«¯æ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œè¿æ¥å¯ä»¥å…³é—­ã€‚
|===

=== ä¸‰æ¬¡æ¡æ‰‹

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTCP è¿æ¥çš„å»ºç«‹è‡³å°‘éœ€è¦äº¤æ¢ä¸‰ä¸ª TCP Segmentï¼Œä¸‰æ¬¡æ¡æ‰‹æ˜¯å¯¹ TCP è¿æ¥å»ºç«‹çš„ä¸€ä¸ªæŠ½è±¡ã€‚

image:img/tcp-3-hands-handshake.png[]

[source, text]
----
// Step One
A å‘é€ä¸€ä¸ª TCP Segment åˆ° Bï¼Œä¸»è¦åŒ…æ‹¬ä¸€ä¸ª SYN æ ‡ç­¾ï¼Œå‘Šè¯‰ B å®¢æˆ·ç«¯ A çš„åˆå§‹åºåˆ—å·ä¸º Jã€‚ï¼ˆè®©æˆ‘ä»¬å¼€å§‹å»ºç«‹è¿æ¥å§ï¼Œæˆ‘çš„åºåˆ—å·ä¸º Jï¼Œè¿™æ ·æˆ‘ä»¬ä¼šçŸ¥é“æˆ‘ä»¬äº¤æµå¼€å§‹çš„ä½ç½®ï¼‰
A sends a TCP segment to B with SYN flag set (`Let's establish a connection and look at my sequence number field, so we know where this conversation starts.`)

// Step Two
B å›å¤ä¸€ä¸ª TCP Segment åˆ° Aï¼ŒåŒ…æ‹¬ä¸¤ä¸ªæ ‡ç­¾ SYN å’Œ ACKï¼Œå‘Šè¯‰ A æœåŠ¡å™¨ç«¯ï¼ˆBï¼‰çš„åˆå§‹åºåˆ—å·ä¸º Kï¼ŒåŒæ—¶ç¡®è®¤ A æœåŠ¡å™¨ï¼ˆBï¼‰ç¡®è®¤å®¢æˆ·ç«¯ A çš„åºåˆ—å·ï¼ˆACK çš„å€¼ä¸º J + 1ï¼‰
B then responds with a TCP segment, where both the SYN and ACK flags are set(`Sure, let's establish a connection and I acknowledge your sequence number.`)

// Step Three
A å›å¤ä¸€ä¸ª TCP Segment åˆ° Bï¼Œä¸»è¦åŒ…æ‹¬ä¸€ä¸ª ACK æ ‡ç­¾ï¼Œå‘Šè¯‰æœåŠ¡å™¨ç«¯ B å®¢æˆ·ç«¯ A ç¡®è®¤æœåŠ¡ç«¯çš„åºåˆ—å·ï¼ˆACK çš„å€¼ä¸º K + 1ï¼‰ã€‚ 
A responds again with just the ACK flag set* (`I acknowledge your acknowledgement. Let's start sending data.`)
----

ä¸€æ¬¡æ¡æ‰‹æ˜¯ä¸¤ä¸ªè®¾å¤‡ç¡®ä¿ä»–ä»¬æ‰€ä½¿ç”¨åŒä¸€ä¸ªåè®®ï¼Œå¹¶ä¸”èƒ½å¤Ÿå½¼æ­¤ç›¸äº’ç†è§£ã€‚

TCP è¿æ¥æ˜¯ä¸€ä¸ªå¤šè·¯å¤ç”¨çš„æ¨¡å¼ï¼Œæ¯ä¸€ä¸ª TCP Segment çš„å‘é€éƒ½ä¼šæœ‰ä¸€ä¸ª TCP Segment çš„å›å¤ï¼ˆACK æ ‡ç­¾ï¼‰ï¼Œè¿™æ ·å‘é€ç«¯å°±çŸ¥é“æ¥æ”¶ç«¯æ¥æ”¶åˆ°ç›¸åº”çš„ç‰‡æ®µã€‚

=== å››æ¬¡æ¡æ‰‹

TCP å»ºç«‹ä¸€ä¸ªè¿æ¥éœ€è¦ä¸‰æ¬¡ TCP Segment äº¤æ¢ï¼Œè€Œç»ˆæ­¢ä¸€ä¸ªè¿æ¥éœ€è¦å››æ¬¡ TCP Segment äº¤æ¢ï¼Œå››æ¬¡æ¡æ‰‹æ˜¯å¯¹ TCP è¿æ¥ç»ˆæ­¢çš„ä¸€ä¸ªæŠ½è±¡ã€‚

TCP è¿æ¥å¯ä»¥ä»å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ä»»ä½•ä¸€æ–¹å‘èµ·ï¼Œå‘èµ·å…³é—­è¿æ¥çš„ä¸€æ¬¡é€šå¸¸é€šè¿‡è°ƒè¿ close() æ–¹æ³•ï¼Œæˆ‘ä»¬å°†è¿™ä¸€åŠ¨ä½œç§°ä¸º*ä¸»åŠ¨å…³é—­ï¼ˆActive Closeï¼‰*ï¼Œç›¸åº”çš„å¦ä¸€ç«¯åˆ™ç§°ä¸º*è¢«åŠ¨å…³é—­ï¼ˆPassive Closeï¼‰*ï¼Œä¸‹å›¾æ¼”ç¤ºçš„æ˜¯ä»æœåŠ¡å™¨ç«¯ B å‘èµ·çš„ä¸»è¦å…³é—­è¿‡ç¨‹ï¼š

image:img/tcp-4wayshandshake.png[]

1. B å‘é€ FIN æ ‡ç­¾åˆ° Aï¼ˆFIN Mï¼‰
2. A ç¡®è®¤ B å¹¶å›å¤ä¸€ä¸ª ACK æ ‡ç­¾(ACK M + 1)
3. A å‘é€ FIN æ ‡ç­¾åˆ° Bï¼ˆFIN Nï¼‰
4. B ç¡®è®¤ A å¹¶å›å¤ä¸€ä¸ª ACK æ ‡ç­¾(ACK N + 1)

=== TCP å¥—æ¥å­—çŠ¶æ€

ä¸€ä¸ª TCP å¥—æ¥å­—æ˜¯ä¸€ä¸ªæ½œåœ¨ TCP è¿æ¥ä¸€ç«¯çš„å®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–ã€‚TCP å¥—æ¥å­—æœ‰å¤šä¸ªçŠ¶æ€ã€‚

A socket is the instantiation of an endpoint in a potential TCP connection.

.*TCP å¥—æ¥å­—çŠ¶æ€*
|===
|åç§° |æè¿°

|LISTEN
|ä¸€ä¸ª TCP å¥—æ¥å­—å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥æ¥æ”¶è¿›å…¥çš„è¿æ¥ï¼Œè¿™ä¸ªçŠ¶æ€åªä¼šåœ¨æœåŠ¡å™¨ç«¯ã€‚

|SYN_SENT
|å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ª SYN æ ‡ç­¾çš„è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯ï¼Œä¸”è¿æ¥å»ºç«‹è¿˜æ²¡æœ‰å®Œæˆï¼Œè¿™ä¸ªçŠ¶æ€åªä¼šåœ¨å®¢æˆ·ç«¯ã€‚

|SYN_RECEIVED
|å‰åºå¤„äº LISTEN çŠ¶æ€ï¼Œæ¥æ”¶åˆ° SYN æ ‡ç­¾çš„è¯·æ±‚ï¼Œå¹¶ä¸”ç»™å®¢æˆ·ç«¯å›å¤äº† SYN å’Œ ACKï¼Œä½†æ˜¯è¿æ¥è¿˜æ²¡æœ‰å»ºç«‹ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ ACK è¯·æ±‚ã€‚è¿™ä¸ªçŠ¶æ€åªä¼šåœ¨æœåŠ¡å™¨ç«¯ã€‚

|ESTABLISHED
|TCP è¿æ¥å»ºç«‹åçš„çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥è‡ªç”±ç›¸äº’å‘é€æ•°æ®ï¼Œè¿™ä¸ªçŠ¶æ€å³å¯ä»¥æ˜¯å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨æœåŠ¡å™¨ç«¯ã€‚

|FIN_WAIT
|ä¸€ä¸ª FIN æ ‡ç­¾çš„è¯·æ±‚å‘é€ï¼ŒåŒæ—¶æ²¡æœ‰æ¥æ”¶åˆ°å¦ä¸€ä¾§å›å¤çš„ ACKã€‚

|CLOSE_WAIT
|ä¼ è¾“å±‚ TCP è¿æ¥å·²ç»å…³é—­, ä½†åº”ç”¨å±‚è¿˜æ²¡æœ‰é‡Šæ”¾ç›¸åº”çš„å¥—æ¥å­—ã€‚

|CLOSED
|TCP è¿æ¥å®Œå…¨å…³é—­ï¼Œæ²¡æœ‰ä»»ä½•è¿›ä¸€æ­¥é€šä¿¡çš„å¯èƒ½æ€§ã€‚

|===

=== UDP(ç”¨æˆ·æ•°æ®æŠ¥åè®®)

ä¸åƒ TCPï¼ŒUDP ä¸ä¾èµ–ä¸€ä¸ªè¿æ¥ï¼Œæ²¡æœ‰ç±»ä¼¼ TCP ä¸­ ACK çš„ç†å¿µï¼ŒUDP ä¸­åªéœ€è¦è®¾å®šä¸€ä¸ªç›®çš„åœ°ç«¯å£ã€‚

=== ç³»ç»Ÿç«¯å£å’Œä¸´æ—¶ç«¯å£

ä¼ è¾“å±‚æ˜¯æ ¹æ®ç«¯å£å·æ¥ç¡®ä¿ç«¯åˆ°ç«¯çš„é€šä¿¡ï¼Œä¼ è¾“å±‚çš„åè®®ä¸ç®¡æ˜¯ TCP è¿˜æ˜¯ UDPï¼Œéƒ½ä¸ç«¯å£å·å…³è”ï¼Œç«¯å£å·æ˜¯ä¸€ä¸ª 16 ä¸ªå­—èŠ‚é•¿åº¦çš„æ•°å­—ï¼ˆèŒƒå›´ä¸º 0 - 65535ï¼‰ã€‚ç«¯å£å·åˆåˆ†ä¸ºç³»ç»Ÿç«¯å£å’Œä¸´æ—¶ç«¯å£ã€‚

.*IANA å®šä¹‰çš„ç«¯å£èŒƒå›´*
|===
|èŒƒå›´ |æè¿°

|0
|ç«¯å£ 0 ä¸ä¼šä½¿ç”¨åœ¨ç½‘ç»œè¿æ¥ä¸­ï¼Œä½†æœ‰æ—¶å€™å¦‚æœåŒä¸€ä¸ªä¸»æœºä¸Šåˆå¤šä¸ªç¨‹åºï¼Œé‚£ä¹ˆä½¿ç”¨ 0 å¯ä»¥éšæœºé€‰æ‹©ä¸€ä¸ªç«¯å£ã€‚

|1 - 1023
|ç³»ç»Ÿç«¯å£èŒƒå›´ï¼Œæˆ–è¢«ç§°ä¸ºä¼—æ‰€å‘¨çŸ¥ç«¯å£å·ï¼Œè¿™äº›ç«¯å£é€šå¸¸è¢«ä¸€äº›å¤§å®¶ç†ŸçŸ¥çš„æœåŠ¡æ‰€æœ‰ï¼Œä¾‹å¦‚ 80 ä¸º HTTP ç«¯å£ï¼Œ21 æ˜¯ FTP ç­‰ã€‚è¿™äº›ç«¯å£å— IANA æ§åˆ¶ã€‚

|1024 - 49151
|å·²æ³¨å†Œç«¯å£ï¼Œè¿™äº›ç«¯å£ä¸å— IANA æ§åˆ¶ï¼Œä¸è¿‡ç”± IANA ç™»è®°ï¼Œå¹¶æä¾›ä»–ä»¬ä½¿ç”¨æƒ…å†µæ¸…å•ï¼Œä»¥æ–¹ä¾¿æ•´ä¸ªç¾¤ä½“ã€‚è¿™äº›ç«¯å£ä¸­ä¸€äº›é€šè¿‡å¯èƒ½è¢«ç†Ÿæ‚‰ï¼Œ3306 æ˜¯ Mysql çš„ç«¯å£ï¼Œ8080 ä¸º Tomcat/JBoss ç«¯å£ã€‚

|49152 - 65535
|è¿™äº›ç«¯å£è¢«ç§°ä¸ºç§æœ‰æˆ–ä¸´æ—¶ç«¯å£ï¼Œä¸´æ—¶ç«¯å£ä¸èƒ½é€šè¿‡ INANA æ³¨å†Œï¼Œè¿™äº›ç«¯å£ç”¨åœ¨ TCP è¿æ¥çš„å®¢æˆ·ç«¯éšæœºé€‰ç”¨ï¼ˆSource Portï¼‰ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯/æœåŠ¡å™¨ç«¯é€šä¿¡çš„ç¨‹åºï¼ŒæœåŠ¡å™¨ç«¯é€šå¸¸ç›‘å¬ä¸ä¸€ä¸ªå·²æ³¨å†Œçš„ç«¯å£ï¼Œå®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªè¿æ¥æ—¶ä¼šåˆ†é…ä¸€ä¸ªä¸´æ—¶ç«¯å£ã€‚
|===

=== é˜²ç«å¢™

ä¸€ä¸ªé˜²ç«å¢™æ˜¯ä¸€ä¸ªç½‘ç»œè®¾å¤‡ï¼Œç”¨æ¥é˜»å¡æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„ç½‘ç»œè´Ÿè½½ã€‚é˜²ç«å¢™é€šå¸¸å¯ä»¥åœ¨ä¸åŒçš„ç½‘ç»œå±‚è¿è¡Œï¼š

* ä¼ è¾“å±‚ - é€šå¸¸é€šè¿‡é…ç½®é˜»å¡ç‰¹å®šçš„ç«¯å£ä¸Šçš„ç½‘ç»œè´Ÿè½½ï¼ŒåŒæ—¶å…è®¸ä¸€äº›ç«¯å£ä¸Šçš„ç½‘ç»œè´Ÿè½½
* åº”ç”¨å±‚ - æ£€æµ‹åº”ç”¨å±‚æ•°æ®è´Ÿè½½ï¼Œä¾‹å¦‚ç‰¹å®šèŒƒå›´ IPåœ°å€ç­‰ã€‚

== åº”ç”¨å±‚

=== åº”ç”¨å±‚åè®®

* HTTP - For web traffic
* FTP  - For ftp traffic

=== HTTP

åœ¨ TCP/IP ä½“ç³»ç»“æ„ä¸­ï¼ŒHTTP å±äºåº”ç”¨å±‚åè®®ï¼Œä½äº TCP/IP åè®®çš„é¡¶å±‚ã€‚å› æ­¤ï¼Œå®ƒåœ¨è®¾ è®¡å’Œä½¿ç”¨ä¸­è¦ä»¥ TCP/IP åè®®æ—ä¸­çš„å…¶ä»–åè®®ä¸ºåŸºç¡€ã€‚ä¾‹å¦‚ï¼Œå®ƒè¦é€šè¿‡ DNS è¿›è¡ŒåŸŸåå’Œ IP åœ° å€çš„è½¬æ¢ï¼Œè¦å»ºç«‹ TCP è¿æ¥æ‰èƒ½è¿›è¡Œæ–‡æ¡£ä¼ è¾“ã€‚

æ˜¾ç„¶ï¼ŒHTTP ä¹Ÿæ˜¯å®¢æˆ·/æœåŠ¡å™¨ç»“æ„ã€‚è¿™é‡Œï¼Œå®¢æˆ·æ˜¯æµè§ˆå™¨(Browser),æœåŠ¡å™¨æ˜¯ Web æœ åŠ¡å™¨ã€‚æµè§ˆ Web æ—¶ï¼Œæµè§ˆå™¨é€šè¿‡ HTTP åè®®äº Web æœåŠ¡å™¨äº¤æ¢ä¿¡æ¯ã€‚æ¯å½“åœ¨ Web ä¸Šä»ä¸€ä¸ª èµ„æºè½¬åˆ°å¦ä¸€ä¸ªèµ„æºæ—¶ï¼Œæµè§ˆå™¨ç”¨ HTTP è®¿é—® Web æœåŠ¡å™¨ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æƒ³è¦è·å¾—çš„èµ„æºä¿¡æ¯ã€‚

æµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šè¿‡ HTTP äº¤æ¢ Web æ–‡æ¡£æ—¶ï¼Œå®é™…å¯ä»¥äº¤æ¢ä¸åŒçš„æ–‡æ¡£ç±»å‹ã€‚è¿™äº›æ–‡æ¡£ ç±»å‹çš„æ ¼å¼ç”±å¤šç”¨é€” Internet é‚®ä»¶æ‰©å±• MIME(Mutipurpose Internet Mail Extensions)å®šä¹‰ã€‚MIME æ˜¯ä¸“é—¨æè¿°é€šè¿‡ Internet ä¼ è¾“å¤šåª’ä½“æ•°æ®çš„æŠ€æœ¯æ ‡å‡†ã€‚

HTTP æ”¯æŒå®¢æˆ·(ä¸€èˆ¬æ˜¯æµè§ˆå™¨)ä¸æœåŠ¡å™¨é—´çš„é€šä¿¡ï¼Œç›¸äº’ä¼ é€æ•°æ®ã€‚ä¸€ä¸ªæœåŠ¡å™¨å¯ä»¥ ä¸ºåˆ†å¸ƒåœ¨ä¸–ç•Œå„åœ°çš„è®¸å¤šå®¢æˆ·æœåŠ¡ã€‚HTTP å®šä¹‰çš„äº‹åŠ¡å¤„ç†ç”±ä»¥ä¸‹å››æ­¥ç»„æˆ:

* å®¢æˆ·ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥
* å®¢æˆ·å‘æœåŠ¡å™¨æå‡ºè¯·æ±‚
* å¦‚æœè¯·æ±‚è¢«æ¥å—ï¼Œåˆ™æœåŠ¡å™¨é€å›å“åº”ï¼Œåœ¨å“åº”ä¸­åŒ…å«çŠ¶æ€ç å’Œæ‰€éœ€çš„æ–‡ä»¶
* å®¢æˆ·ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥

HTTP ä¸å¿…é¡»æŒç»­è¿æ¥çš„ FTP ç­‰ä¸åŒï¼Œå®ƒæ˜¯æ— çŠ¶æ€çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨æ¯è¿› è¡Œä¸€æ¬¡ HTTP æ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä½†éšå³åˆæ–­å¼€æ­¤æ¬¡è¿æ¥ã€‚è®¿é—® Web ç«™ç‚¹æ—¶ï¼Œæµè§ˆå™¨ä¸ æœåŠ¡å…¶ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä»¥ä¾¿å°†æœåŠ¡å™¨ä¸Šçš„ HTML æ–‡ä»¶ä¸‹è½½åˆ°æµè§ˆå™¨ä¸Šã€‚åœ¨ HTTP 1.0 ç‰ˆæœ¬ä¸­ï¼Œ æµè§ˆå™¨æ”¶åˆ°æ–‡ä»¶åï¼Œå³æ–­å¼€æ­¤æ¬¡è¿æ¥ï¼Œå¦‚æœæµè§ˆå™¨å‘ç°è¿˜éœ€è¦æŸäº›æ–‡ä»¶(ä¾‹å¦‚ä¸‹è½½å›¾å½¢)æ—¶ï¼Œ å¿…é¡»é‡æ–°å»ºç«‹è¿æ¥ã€‚è€Œåœ¨ HTTP 1.1 ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥é‡‡ç”¨ä¸€äº›æœºåˆ¶ä½¿å®¢æˆ·ç«¯å’Œæµè§ˆå™¨ä¸æ–­å¼€æœ€ åˆå»ºç«‹çš„è¿æ¥ï¼Œè€Œä½¿ç”¨æœ€åˆçš„è¿æ¥è¯·æ±‚åç»­çš„å†…å®¹ã€‚

ä¸€æ¬¡ HTTP æ“ä½œé€šå¸¸è¢«ç§°ä¸ºä¸€æ¬¡äº‹åŠ¡(Transection)ã€‚HTTP é‡‡ç”¨ TCP è¿æ¥ï¼Œè€Œä¸”è¯¥è¿æ¥ ä»…åœ¨æ­¤æ¬¡äº‹åŠ¡ä¸­ä¿æŒï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½ä¸ä¼šè®°å¿†ä¸Šæ¬¡çš„è¿æ¥çŠ¶æ€ã€‚

HTTP ä¹‹æ‰€ä»¥é‡‡ç”¨è¿™ç§æ— çŠ¶æ€æœºåˆ¶ï¼Œå®Œå…¨æ˜¯ä¸ºäº†æé«˜æœåŠ¡å™¨çš„å·¥ä½œæ•ˆç‡ã€‚åœ¨ Web ä¸­ç‚¹å‡» ä¸€ä¸ªè¶…é“¾æ¥æ—¶ï¼Œæµè§ˆå™¨æœ‰å¯èƒ½ä»å½“å‰ç«™ç‚¹è½¬åˆ°å¦ä¸€ä¸ªç«™ç‚¹ã€‚å› æ­¤ï¼Œæ— è®ºä½•æ—¶å•å‡»è¶…é“¾æ¥æ—¶ï¼Œ æœåŠ¡å™¨éƒ½å‡å®šç”¨æˆ·è¦é€€å‡ºæµè§ˆï¼Œå› è€Œæ–­å¼€è¿æ¥ã€‚å¦‚æœè¦ç»§ç»­æµè§ˆï¼Œå°±å†æ¬¡å»ºç«‹è¿æ¥ã€‚å¦‚æœç”¨æˆ·ç¡®å®è¦é€€å‡ºï¼ŒæœåŠ¡æœŸå°±ä¸éœ€è¦æ‰§è¡Œä»»åŠ¡ï¼Œå› ä¸ºè¿æ¥å·²ç»æ–­å¼€ã€‚

å½“ç„¶ HTTP çš„æ— çŠ¶æ€ä¹Ÿæœ‰ç¼ºç‚¹ã€‚ç”±äºæ²¡æœ‰çŠ¶æ€ï¼Œåè®®å¯¹äº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚å¦‚æœå ç»­äº‹åŠ¡å¤„ç†éœ€è¦å‰é¢å¤„ç†çš„æœ‰å…³ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™äº›ä¿¡æ¯å¿…é¡»åœ¨åè®®å¤–é¢ä¿å­˜ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€ æ‰€éœ€è¦çš„å‰é¢ä¿¡æ¯å¿…é¡»é‡ç°ï¼ŒåŠ¿å¿…å¯¼è‡´æ¯æ¬¡è¿æ¥è¦ä¼ é€è¾ƒå¤šçš„ä¿¡æ¯ã€‚åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼ŒçŠ¶æ€ çš„ä¿¡æ¯é€šå¸¸ä¼šé‡‡ç”¨å®¢æˆ·ç«¯ Cookie å’ŒæœåŠ¡å™¨ç«¯çš„ Session ID æ¥é…åˆä¿æŒç”¨æˆ·çš„è¿æ¥çŠ¶æ€ã€‚

=== FTP



=== SMTP



=== DHCP

* DHCP stands for Dynamic Host Configuration Protocol, which is an application layer protocol that automates the configuration process of hosts on a network. With DHCP, a machine can query a DHCP server when the computer connects to the network and receive all the network configuration in one go.
* DHCP is an application layer protocol, which means it relies on the transport, network, data link and physical layers to operate.
* The process by which a client configured to use DHCP attempts to get network configuration information is known as DHCP discovery.

*DHCP discovery process - 4 steps:*

image:img/DHCP-process.jpg[]

1. *DHCP Discovery* - DHCP clients sends a `DHCP discover message(DHCPDISCOVER)` out onto the network, the DHCPDISCOVER message is encapsulated in a UDP datagram with a destination port of 67 and a source port of 68, this is then encapsulated inside of an IP datagram with a destination IP of 255.255.255.255, and a source IP of 0.0.0.0.
2. *DHCP Offer* - DHCP server examine its own configuration and make a decision on what, if any, IP address to offer to the client, the response would be sent as a DHCPOFFER message with a destination port of 68, a source port of 67, a destination broadcast IP of 255.255.255.255, and its actual IP as the source.
3. *DHCP Request* - DHCP client respond to the DHCPOFFER message with a DHCPREQUEST message, which essentially says, yes, I would like to have an IP that you offer to me. Since the IP hasn't been assigned yet, this is again sent from an IP of 0.0.0.0 and to the broadcast IP of 255.255.255.255.
4. *DHCP ACK* - DHCP server receives the DHCPREQUEST message and responds with a DHCPACK or DHCP acknowledgement message, which is again sent to a broadcast IP of 255.255.255.255, and with a source IP corresponding to the actual IP of the DHCP server.

=== NAT(Network Address Translation)

å­—é¢ä¸Šç†è§£ï¼ŒNAT(Network Address Translation) å°±æ˜¯å°†ä¸€ä¸ª IP åœ°å€ç¿»è¯‘/è½¬æ¢æˆå¦ä¸€ä¸ª IP åœ°å€ã€‚

NAT is a technology that allows a gateway usually a router or a firewall to rewrite the source IP of an outgoing IP datagram, while retaining the original IP in order to rewrite it into the response.

image:img/ip-address-masquerading-nat.png[]

NOTE: IP masquerading is an important security concept. The most basic concept at play here, is that no one can establish a connection to your computer if they don't know what IP address it has. By using NAT in the way we've just described, we could actually have hundreds of computers on network A, all of their IPs being translated by the router to its own. To the outside world, the entire address space of network A is protected and invisible. This is known as one to many NAT, and you'll see it in use on lots of LANs today.

==== NAT and the Transport Layer

* Port preservation is a technique where the source port chosen by a client, is the same port used by the router.
* Port forwarding is a technique where a specific destination ports can be configured to always be delivered to specific nodes.

==== RIR(regional internet registries)

.*The IANA assigned address blocks to the five regional internet registries or RIRs*
|===
|åç§° |æè¿°

|AFRINIC
|serves the continent of Africa.

|ARIN
|serves the United States, Canada and parts of the Caribbean.

|APNIC
|responses ost of Asia, Australia and New Zealand and Pacific Island nations.

|LACNIC
|covers Central and South America and any parts of the Caribbean not covered by ARIN.

|RIPE
|serves Europe, Russia and the Middle East and portions of Central Asia.
|===

https://en.wikipedia.org/wiki/IPv4_address_exhaustion[IPv4 address exhaustion]

==== NAT and non-routable address space

* Non-routable address space was defined in RFC1918 and consists of several different IP ranges that anyone can use.
* And unlimited number of networks can use non-routable address space internally because internet routers won't forward traffic to it. This means there's never any global collision of IP addresses when people use those address spaces.
* Non-routable address space is largely usable today because of technologies like NAT.

=== VPN(Virtual Private Networks)

* Virtual Private Networks or VPNs, are a technology that allows for the extension of a private or local network, to a host that might not work on that same local network.
* VPNs are a tunneling protocol. Which means, they provision access to something not locally available.

.*VPN Tunnel Example:*
image:img/vpn-tunel-example.png[]

* VPNs, usually requires strict authentication procedures in order to ensure that they can only be connected to by computers and users authorized to do so. In fact, VPNs were one of the first technologies where two-factor authentication became common.
* Two-factor authentication is a technique where more than just a username and password are required to authenticate. Usually, a short-lived numerical token is generated by the user through a specialized piece of hardware or software.

==== VPN æ„å»ºç‚¹å¯¹ç‚¹è¿æ¥

VPNs can also be used to establish site-to-site connectivity. It's just that the router, or sometimes a specialized VPN device on one network, establishes the VPN tunnel to the router or VPN device on another network. This way, two physically separated offices might be able to act as one network and access network resources across the tunnel.

image:img/vpn-p2p-connectivity.png[]

=== Proxy Services

* A proxy service is a server that actson behalf of a client in order to access another service. Proxies sit between clients and other servers, providing some additional benefit, anonymity, security, content filtering, increased performance, a couple other things.
* Proxies doesn't refer to any specific implementation. Proxies exist at almost every layer of our networking model.

==== Reverse proxy

A reverse proxy is a service that might appear to be a single server to external clients, but actually represents many servers living behind it.

.*ç°ä»£ Web åº”ç”¨æ¶æ„ä½¿ç”¨ Reverse proxyï¼š*
image:img/proxy-reverse.png[]

NOTE: Reverse proxy can also used in encrypting and decrypting web data.


=== Application Layer and the OSI Model

* The session layer is that it's responsible for things like facilitating the communication between actual applications and the transport layer
* The presentation layer is responsible for making sure that the unencapsulated application layer data is actually able to be understood by the application in question.

image:img/osi-model-application.png[]

== TCP/IP äº”å±‚æ¨¡å‹ç¤ºä¾‹

=== åœºæ™¯æè¿°

image:img/five-models-scenario.png[]

As depicted in above figure:

1. Network A contains address space 10.1.1.0/24, and computer A is part of Network A and has been assigned an IP address of 10.1.1.100
2. Network B contains address space 192.168.1.0/24, and computer B is part of Network B and has been assigned an *IP address* of 192.168.1.100, web server on computer B is running and listening on port 80
3. Router sits between network A and network B, with an interface configured with an IP of 10.1.1.1 on network A, and an interface at 192.168.1.1 on network B
4. An end user sitting at computer A opens up a web browser and enters 192.168.1.100 into the address bar to access the content in computer B's web server

=== é€šä¿¡è¿‡ç¨‹

1. The web browser communicates with the local networking stack(part of OS), and know that it's going to establish a TCP connection to 192.168.1.100, port 80 on another network.
2. Computer A looks at its ARP table to determine what MAC address of it's gateway 10.1.1.1 is, but it doesn't find any corresponding entry.
3. Router receives ARP message, check that currently it assigned the IP address of 10.1.1.1. So it responds to computer A to let it know about its own *MAC address* of 00:11:22:33:44:55.
4. Computer A receives this response and now knows the hardware address of its gateway, and ready to start constructing the outbound packet.
5. *Application layer*'s web browser trigger to open a socket, and get a ephemeral port 50000 from computer A OS
6. In the *Transport layer*, the networking stack starts to build a `TCP segment`, with appropriate fields in the header, including a source port of 50000, destination port of 80, sequence number field filled with a appropriate sequence number, the `SYN` flag is set, checksum for the segment is calculated and written to the checksum field.
7. The `TCP segment` passed along to the *Network layer* and start to encapsulate a `IP Datagram`, fill IP header with the source IP, the destination IP, a *TTL* of 64, fill the `TCP segment` as the data payload of the `IP datagram`, a checksum is calculated and put in checksum field.
8. The `IP datagram` passed alone to the *Data link layer* and start to construct a `Ethernet frame`, fill `00:11:22:33:44:55` as destination MAC addresses and computer A's MAC addresses as source MAC addresses, insert `IP datagram` as he data payload of the Ethernet frame, enter a calculated checksum to reference field.
9. The `Ethernet frame` is ready to be sent across the *physical layer*, the `network interface` connected to computer A sends this binary data as modulations of the voltage of an electrical current running across a `CAT6 cable` that's connected between it and a network switch.
10. This switch receives the frame and inspects the destination MAC address. The switch knows which of its interfaces this MAC address is attached to, and forwards the frame across only the cable connected to this interface.
11. Router receives the frame and recognizes its own hardware address as the destination. Router knows that this frame is intended for itself. So it now takes the entirety of the frame and performa *checksum check* against it. Router compares this checksum with the one in the Ethernet frame header and sees that they match.
12. Router strips away the `Ethernet frame`, leaving it with just the `IP datagram`. Again, it performs a checksum calculation against the entire datagram. And again, it finds that it matches. It then inspects the destination IP address and performs a lookup of this destination in its *routing table*, the look up results is that the router sees that the destination address 192.168.1.100 is on a locally connected network.
13. Continue in Router, the TTL be decrement, a new checksum be re-calculated, and creates a new `IP datagram`. Similar with Step 8, this new IP datagram is again encapsulated by a new `Ethernet frame`, which the source and destination MAC address of router and and computer B
14. The new Ethernet frame` is ready to be sent, and computer B receives the frame.
15. Computer B identifies its own MAC address as the destination, and knows that it's intended for itself. computer B then strips away the Ethernet frame, leaving it with the IP datagram. It performs a `checksum check` and recognizes that the data has been delivered intact. It then examines the destination IP address and recognizes that as its own.
16. Computer B strips away the IP datagram, leaving it with just the `TCP segment`. Again, the checksum for this layer is examined, and everything checks out.
17. Computer B examines the destination port, which is *TCP port* 80. The networking stack on computer B checks to ensure that there's an open socket on port 80, which there is. It's in the listen state, and held open by a running Apache web server.
18. Computer B then sees that this packet has the `SYN` flag and knows that this is a TCP connection request.
19. Repeat the steps from 6 - 16, and form a `TCP segment` with flag `SYN-ACK`, and other field be filled correctly.
20. Computer A receives frame and awared the `SYN-ACK` flag and knows that the Computer B are ready to establish connection.
21. Repeat the steps from 6 - 16, and form a `TCP segment` with flag `ACK`, and other field be filled correctly.
22. Computer B receives frame and awared the `ACK` flag from computer A, knows that the Computer A are acknowledged. And finally finish the socket instantiation, and set the state to `ESTABLISHED`.
 
